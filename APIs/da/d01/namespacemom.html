<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom Module Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,'Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/d01/namespacemom.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This is the main routine for MOM.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control structure for this module.  <a href="../../d8/dfa/structmom_1_1mom__control__struct.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a4c8332b095c6d295084089aa6b3b678a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a4c8332b095c6d295084089aa6b3b678a">step_mom</a> (fluxes, state, Time_start, time_interval, CS)</td></tr>
<tr class="memdesc:a4c8332b095c6d295084089aa6b3b678a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine orchestrates the time stepping of MOM. The adiabatic dynamics are stepped by calls to one of the step_MOM_dyn_...routines. The action of lateral processes on tracers occur in calls to advect_tracer and tracer_hordiff. Vertical mixing and possibly remapping occur inside of diabatic.  <a href="#a4c8332b095c6d295084089aa6b3b678a">More...</a><br /></td></tr>
<tr class="separator:a4c8332b095c6d295084089aa6b3b678a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afebdc0103ad9cbe0ed4a54e522dc4104"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#afebdc0103ad9cbe0ed4a54e522dc4104">initialize_mom</a> (Time, param_file, dirs, CS, Time_in)</td></tr>
<tr class="memdesc:afebdc0103ad9cbe0ed4a54e522dc4104"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine initializes MOM.  <a href="#afebdc0103ad9cbe0ed4a54e522dc4104">More...</a><br /></td></tr>
<tr class="separator:afebdc0103ad9cbe0ed4a54e522dc4104"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dd32ae97ee7dd3cbb8e14e4cf11f191"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a0dd32ae97ee7dd3cbb8e14e4cf11f191">finish_mom_initialization</a> (Time, dirs, CS, fluxes)</td></tr>
<tr class="memdesc:a0dd32ae97ee7dd3cbb8e14e4cf11f191"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine finishes initializing MOM and writes out the initial conditions.  <a href="#a0dd32ae97ee7dd3cbb8e14e4cf11f191">More...</a><br /></td></tr>
<tr class="separator:a0dd32ae97ee7dd3cbb8e14e4cf11f191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cfc2cd88d60f051fe90e68c2f16b46b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a6cfc2cd88d60f051fe90e68c2f16b46b">unittests</a></td></tr>
<tr class="memdesc:a6cfc2cd88d60f051fe90e68c2f16b46b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This s/r calls unit tests for other modules. These are NOT normally invoked and so we provide the module use statments here rather than in the module header. This is an exception to our usual coding standards. Note that if a unit test returns true, a FATAL error is triggered.  <a href="#a6cfc2cd88d60f051fe90e68c2f16b46b">More...</a><br /></td></tr>
<tr class="separator:a6cfc2cd88d60f051fe90e68c2f16b46b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a353e4f34478972f6c4115a9446e04c09"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a353e4f34478972f6c4115a9446e04c09">register_diags</a> (Time, G, GV, CS, ADp)</td></tr>
<tr class="memdesc:a353e4f34478972f6c4115a9446e04c09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register the diagnostics.  <a href="#a353e4f34478972f6c4115a9446e04c09">More...</a><br /></td></tr>
<tr class="separator:a353e4f34478972f6c4115a9446e04c09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e0ad1ce70f803df140c0ef9f78f2040"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a9e0ad1ce70f803df140c0ef9f78f2040">register_diags_ts_tendency</a> (Time, G, CS)</td></tr>
<tr class="memdesc:a9e0ad1ce70f803df140c0ef9f78f2040"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize diagnostics for temp/heat and saln/salt tendencies.  <a href="#a9e0ad1ce70f803df140c0ef9f78f2040">More...</a><br /></td></tr>
<tr class="separator:a9e0ad1ce70f803df140c0ef9f78f2040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86a5617dd90efc4f487373d485f670f0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a86a5617dd90efc4f487373d485f670f0">register_diags_ts_vardec</a> (Time, HI, GV, param_file, CS)</td></tr>
<tr class="memdesc:a86a5617dd90efc4f487373d485f670f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize diagnostics for the variance decay of temp/salt across regridding/remapping.  <a href="#a86a5617dd90efc4f487373d485f670f0">More...</a><br /></td></tr>
<tr class="separator:a86a5617dd90efc4f487373d485f670f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab57e47834591c651339770f7e51efe57"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#ab57e47834591c651339770f7e51efe57">mom_timing_init</a> (CS)</td></tr>
<tr class="memdesc:ab57e47834591c651339770f7e51efe57"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine sets up clock IDs for timing various subroutines.  <a href="#ab57e47834591c651339770f7e51efe57">More...</a><br /></td></tr>
<tr class="separator:ab57e47834591c651339770f7e51efe57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a160d32130791ebf4147e5e9d60b242bc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a160d32130791ebf4147e5e9d60b242bc">post_diags_ts_tendency</a> (G, GV, CS, dt)</td></tr>
<tr class="memdesc:a160d32130791ebf4147e5e9d60b242bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Post diagnostics for temp/heat and saln/salt tendencies.  <a href="#a160d32130791ebf4147e5e9d60b242bc">More...</a><br /></td></tr>
<tr class="separator:a160d32130791ebf4147e5e9d60b242bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade4c1552728b358f6ce4114943079214"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#ade4c1552728b358f6ce4114943079214">post_diags_ts_vardec</a> (G, CS, dt)</td></tr>
<tr class="memdesc:ade4c1552728b358f6ce4114943079214"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate and post variance decay diagnostics for temp/salt.  <a href="#ade4c1552728b358f6ce4114943079214">More...</a><br /></td></tr>
<tr class="separator:ade4c1552728b358f6ce4114943079214"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36275a94577312ab6200b1f5ff158805"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a36275a94577312ab6200b1f5ff158805">write_static_fields</a> (G, diag)</td></tr>
<tr class="memdesc:a36275a94577312ab6200b1f5ff158805"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offers the static fields in the ocean grid type for output via the diag_manager.  <a href="#a36275a94577312ab6200b1f5ff158805">More...</a><br /></td></tr>
<tr class="separator:a36275a94577312ab6200b1f5ff158805"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab33a9c6ab1106414d95ecdd17da5a06"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#aab33a9c6ab1106414d95ecdd17da5a06">set_restart_fields</a> (GV, param_file, CS)</td></tr>
<tr class="memdesc:aab33a9c6ab1106414d95ecdd17da5a06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the fields that are needed for bitwise identical restarting the time stepping scheme. In addition to those specified here directly, there may be fields related to the forcing or to the barotropic solver that are needed; these are specified in sub- routines that are called from this one.  <a href="#aab33a9c6ab1106414d95ecdd17da5a06">More...</a><br /></td></tr>
<tr class="separator:aab33a9c6ab1106414d95ecdd17da5a06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a132920be40adc59cc70083eaa0111431"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a132920be40adc59cc70083eaa0111431">calculate_surface_state</a> (state, u, v, h, ssh, G, GV, CS, p_atm)</td></tr>
<tr class="memdesc:a132920be40adc59cc70083eaa0111431"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine sets the surface (return) properties of the ocean model by setting the appropriate pointers in state. Unused fields are set to NULL.  <a href="#a132920be40adc59cc70083eaa0111431">More...</a><br /></td></tr>
<tr class="separator:a132920be40adc59cc70083eaa0111431"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6dad976fb4be1c7ba7fc1aff809616b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#ae6dad976fb4be1c7ba7fc1aff809616b">mom_end</a> (CS)</td></tr>
<tr class="memdesc:ae6dad976fb4be1c7ba7fc1aff809616b"><td class="mdescLeft">&#160;</td><td class="mdescRight">End of model.  <a href="#ae6dad976fb4be1c7ba7fc1aff809616b">More...</a><br /></td></tr>
<tr class="separator:ae6dad976fb4be1c7ba7fc1aff809616b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2e9f4b71ee77ba5bcb3f03a863948db3"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a2e9f4b71ee77ba5bcb3f03a863948db3">id_clock_ocean</a></td></tr>
<tr class="separator:a2e9f4b71ee77ba5bcb3f03a863948db3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1cf2d523679b925a5e5baa9d974968c"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#ae1cf2d523679b925a5e5baa9d974968c">id_clock_dynamics</a></td></tr>
<tr class="separator:ae1cf2d523679b925a5e5baa9d974968c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a052256dfa3e56390f62ef3a826d62617"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a052256dfa3e56390f62ef3a826d62617">id_clock_thermo</a></td></tr>
<tr class="separator:a052256dfa3e56390f62ef3a826d62617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fa4debacd02de6fcd066066c232adf3"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a0fa4debacd02de6fcd066066c232adf3">id_clock_tracer</a></td></tr>
<tr class="separator:a0fa4debacd02de6fcd066066c232adf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50edf00aa5998073d2db0360949253ba"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a50edf00aa5998073d2db0360949253ba">id_clock_diabatic</a></td></tr>
<tr class="separator:a50edf00aa5998073d2db0360949253ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa512b2d8dd73b02634e772701be07a87"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#aa512b2d8dd73b02634e772701be07a87">id_clock_continuity</a></td></tr>
<tr class="separator:aa512b2d8dd73b02634e772701be07a87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f5feb87a0cb40d9fcee00456e982b8a"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a8f5feb87a0cb40d9fcee00456e982b8a">id_clock_thick_diff</a></td></tr>
<tr class="separator:a8f5feb87a0cb40d9fcee00456e982b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41b67fabfc13e52cf3a5d1c337c780eb"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a41b67fabfc13e52cf3a5d1c337c780eb">id_clock_ml_restrat</a></td></tr>
<tr class="separator:a41b67fabfc13e52cf3a5d1c337c780eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa773fddb51f99098d75304eb271270d4"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#aa773fddb51f99098d75304eb271270d4">id_clock_diagnostics</a></td></tr>
<tr class="separator:aa773fddb51f99098d75304eb271270d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09f2ac3470372b9ee233f4cc5a7a0da1"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a09f2ac3470372b9ee233f4cc5a7a0da1">id_clock_z_diag</a></td></tr>
<tr class="separator:a09f2ac3470372b9ee233f4cc5a7a0da1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cf03c18244d0630616e925bab1841a2"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a7cf03c18244d0630616e925bab1841a2">id_clock_init</a></td></tr>
<tr class="separator:a7cf03c18244d0630616e925bab1841a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4180eb85bab39df7cbb72bb8e5b19fd4"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a4180eb85bab39df7cbb72bb8e5b19fd4">id_clock_mom_init</a></td></tr>
<tr class="separator:a4180eb85bab39df7cbb72bb8e5b19fd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7af2f783166f32739569e4ed6ed6a98f"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a7af2f783166f32739569e4ed6ed6a98f">id_clock_pass</a></td></tr>
<tr class="separator:a7af2f783166f32739569e4ed6ed6a98f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4d20612cad32d412dae492fedc2e971"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#ac4d20612cad32d412dae492fedc2e971">id_clock_pass_init</a></td></tr>
<tr class="separator:ac4d20612cad32d412dae492fedc2e971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a722ed13d0e6d76852e680054a0e3c964"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a722ed13d0e6d76852e680054a0e3c964">id_clock_ale</a></td></tr>
<tr class="separator:a722ed13d0e6d76852e680054a0e3c964"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a283a5d32d799a3cd11113a05dcae2d56"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d01/namespacemom.html#a283a5d32d799a3cd11113a05dcae2d56">id_clock_other</a></td></tr>
<tr class="separator:a283a5d32d799a3cd11113a05dcae2d56"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the main routine for MOM. </p>
<p>Modular Ocean Model (MOM) Version 6.0 (MOM6)</p>
<dl class="section author"><dt>Authors</dt><dd>Alistair Adcroft, Robert Hallberg, and Stephen Griffies</dd></dl>
<p>Additional contributions from:</p><ul>
<li>Whit Anderson</li>
<li>Brian Arbic</li>
<li>Will Cooke</li>
<li>Anand Gnanadesikan</li>
<li>Matthew Harrison</li>
<li>Mehmet Ilicak</li>
<li>Laura Jackson</li>
<li>Jasmine John</li>
<li>John Krasting</li>
<li>Zhi Liang</li>
<li>Bonnie Samuels</li>
<li>Harper Simmons</li>
<li>Laurent White</li>
<li>Niki Zadeh</li>
</ul>
<p>MOM ice-shelf code was developed by</p><ul>
<li>Daniel Goldberg</li>
<li>Robert Hallberg</li>
<li>Chris Little</li>
<li>Olga Sergienko</li>
</ul>
<h1><a class="anchor" id="section_overview"></a>
Overview of MOM</h1>
<p>This program (MOM) simulates the ocean by numerically solving the hydrostatic primitive equations in generalized Lagrangian vertical coordinates, typically tracking stretched pressure (p*) surfaces or following isopycnals in the ocean's interior, and general orthogonal horizontal coordinates. Unlike earlier versions of MOM, in MOM6 these equations are horizontally discretized on an Arakawa C-grid. (It remains to be seen whether a B-grid dynamic core will be revived in MOM6 at a later date; for now applications requiring a B-grid discretization should use MOM5.1.) MOM6 offers a range of options for the physical parameterizations, from those most appropriate to highly idealized models for geophysical fluid dynamics studies to a rich suite of processes appropriate for realistic ocean simulations. The thermodynamic options typically use conservative temperature and preformed salinity as conservative state variables and a full nonlinear equation of state, but there are also idealized adiabatic configurations of the model that use fixed density layers. Version 6.0 of MOM continues in the long tradition of a commitment to climate-quality ocean simulations embodied in previous versions of MOM, even as it draws extensively on the lessons learned in the development of the Generalized Ocean Layered Dynamics (GOLD) ocean model, which was also primarily developed at NOAA/GFDL. MOM has also benefited tremendously from the FMS infrastructure, which it utilizes and shares with other component models developed at NOAA/GFDL.</p>
<p>When run is isopycnal-coordinate mode, the uppermost few layers are often used to describe a bulk mixed layer, including the effects of penetrating shortwave radiation. Either a split- explicit time stepping scheme or a non-split scheme may be used for the dynamics, while the time stepping may be split (and use different numbers of steps to cover the same interval) for the forcing, the thermodynamics, and for the dynamics. Most of the numerics are second order accurate in space. MOM can run with an absurdly thin minimum layer thickness. A variety of non-isopycnal vertical coordinate options are under development, but all exploit the advantages of a Lagrangian vertical coordinate, as discussed in detail by Adcroft and Hallberg (Ocean Modelling, 2006).</p>
<p>Details of the numerics and physical parameterizations are provided in the appropriate source files. All of the available options are selected at run-time by parsing the input files, usually MOM_input and MOM_override, and the options choices are then documented for each run in MOM_param_docs.</p>
<p>MOM6 integrates the equations forward in time in three distinct phases. In one phase, the dynamic equations for the velocities and layer thicknesses are advanced, capturing the propagation of external and internal inertia-gravity waves, Rossby waves, and other strictly adiabatic processes, including lateral stresses, vertical viscosity and momentum forcing, and interface height diffusion (commonly called Gent-McWilliams diffusion in depth- coordinate models). In the second phase, all tracers are advected and diffused along the layers. The third phase applies diabatic processes, vertical mixing of water properties, and perhaps vertical remapping to cause the layers to track the desired vertical coordinate.</p>
<p>The present file (<a class="el" href="../../d8/da7/MOM_8F90.html">MOM.F90</a>) orchestrates the main time stepping loops. One time integration option for the dynamics uses a split explicit time stepping scheme to rapidly step the barotropic pressure and velocity fields. The barotropic velocities are averaged over the baroclinic time step before they are used to advect thickness and determine the baroclinic accelerations. As described in Hallberg and Adcroft (2009), a barotropic correction is applied to the time-mean layer velocities to ensure that the sum of the layer transports agrees with the time-mean barotropic transport, thereby ensuring that the estimates of the free surface from the sum of the layer thicknesses agrees with the final free surface height as calculated by the barotropic solver. The barotropic and baroclinic velocities are kept consistent by recalculating the barotropic velocities from the baroclinic transports each time step. This scheme is described in Hallberg, 1997, J. Comp. Phys. 135, 54-65 and in Hallberg and Adcroft, 2009, Ocean Modelling, 29, 15-26.</p>
<p>The other time integration options use non-split time stepping schemes based on the 3-step third order Runge-Kutta scheme described in Matsuno, 1966, J. Met. Soc. Japan, 44, 85-88, or on a two-step quasi-2nd order Runge-Kutta scheme. These are much slower than the split time-stepping scheme, but they are useful for providing a more robust solution for debugging cases where the more complicated split time-stepping scheme may be giving suspect solutions.</p>
<p>There are a range of closure options available. Horizontal velocities are subject to a combination of horizontal biharmonic and Laplacian friction (based on a stress tensor formalism) and a vertical Fickian viscosity (perhaps using the kinematic viscosity of water). The horizontal viscosities may be constant, spatially varying or may be dynamically calculated using Smagorinsky's approach. A diapycnal diffusion of density and thermodynamic quantities is also allowed, but not required, as is horizontal diffusion of interface heights (akin to the Gent-McWilliams closure of geopotential coordinate models). The diapycnal mixing may use a fixed diffusivity or it may use the shear Richardson number dependent closure, like that described in Jackson et al. (JPO, 2008). When there is diapycnal diffusion, it applies to momentum as well. As this is in addition to the vertical viscosity, the vertical Prandtl always exceeds 1. A refined bulk-mixed layer is often used to describe the planetary boundary layer in realistic ocean simulations.</p>
<p>MOM has a number of noteworthy debugging capabilities. Excessively large velocities are truncated and MOM will stop itself after a number of such instances to keep the model from crashing altogether. This is useful in diagnosing failures, or (by accepting some truncations) it may be useful for getting the model past the adjustment from an ill-balanced initial condition. In addition, all of the accelerations in the columns with excessively large velocities may be directed to a text file. Parallelization errors may be diagnosed using the DEBUG option, which causes extensive checksums to be written out along with comments indicating where in the algorithm the sums originate and what variable is being summed. The point where these checksums differ between runs is usually a good indication of where in the code the problem lies. All of the test cases provided with MOM are routinely tested to ensure that they give bitwise identical results regardless of the domain decomposition, or whether they use static or dynamic memory allocation.</p>
<h1><a class="anchor" id="section_structure"></a>
Structure of MOM</h1>
<p>About 115 other files of source code and 4 header files comprise the MOM code, although there are several hundred more files that make up the FMS infrastructure upon which MOM is built. Each of the MOM files contains comments documenting what it does, and most of the file names are fairly self-evident. In addition, all subroutines and data types are referenced via a module use, only statement, and the module names are consistent with the file names, so it is not too hard to find the source file for a subroutine.</p>
<p>The typical MOM directory tree is as follows:</p>
<pre class="fragment">        ../MOM
        |-- config_src
        |   |-- coupled_driver
        |   |-- dynamic
        |   `-- solo_driver
        |-- examples
        |   |-- CM2G
        |   |-- ...
        |   `-- torus_advection_test
        `-- src
            |-- core
            |-- diagnostics
            |-- equation_of_state
            |-- framework
            |-- ice_shelf
            |-- initialization
            |-- parameterizations
            |   |-- lateral
            |   `-- vertical
            |-- tracer
            `-- user</pre><p>Rather than describing each file here, each directory contents will be described to give a broad overview of the MOM code structure.</p>
<p>The directories under config_src contain files that are used for configuring the code, for instance for coupled or ocean-only runs. Only one or two of these directories are used in compiling any, particular run.</p>
<ul>
<li>config_src/coupled_driver: The files here are used to couple MOM as a component in a larger run driven by the FMS coupler. This includes code that converts various forcing fields into the code structures and flux and unit conventions used by MOM, and converts the MOM surface fields back to the forms used by other FMS components.</li>
<li>config_src/dynamic: The only file here is the version of MOM_memory.h that is used for dynamic memory configurations of MOM.</li>
<li><p class="startli">config_src/solo_driver: The files here are include the _main driver that is used when MOM is configured as an ocean-only model, as well as the files that specify the surface forcing in this configuration.</p>
<p class="startli">The directories under examples provide a large number of working configurations of MOM, along with reference solutions for several different compilers on GFDL's latest large computer. The versions of MOM_memory.h in these directories need not be used if dynamic memory allocation is desired, and the answers should be unchanged.</p>
<p class="startli">The directories under src contain most of the MOM files. These files are used in every configuration using MOM.</p>
</li>
<li>src/core: The files here constitute the MOM dynamic core. This directory also includes files with the types that describe the model's lateral grid and have defined types that are shared across various MOM modules to allow for more succinct and flexible subroutine argument lists.</li>
<li>src/diagnostics: The files here calculate various diagnostics that are anciliary to the model itself. While most of these diagnostics do not directly affect the model's solution, there are some, like the calculation of the deformation radius, that are used in some of the process parameterizations.</li>
<li>src/equation_of_state: These files describe the physical properties of sea-water, including both the equation of state and when it freezes.</li>
<li>src/framework: These files provide infrastructure utilities for MOM. Many are simply wrappers for capabilities provided by FMS, although others provide capabilities (like the file_parser) that are unique to MOM. When MOM is adapted to use a modeling infrastructure distinct from FMS, most of the required changes are in this directory.</li>
<li>src/initialization: These are the files that are used to initialize the MOM grid or provide the initial physical state for MOM. These files are not intended to be modified, but provide a means for calling user-specific initialization code like the examples in src/user.</li>
<li>src/parameterizations/lateral: These files implement a number of quasi-lateral (along-layer) process parameterizations, including lateral viscosities, parameterizations of eddy effects, and the calculation of tidal forcing.</li>
<li>src/parameterizations/vertical: These files implement a number of vertical mixing or diabatic processes, including the effects of vertical viscosity and code to parameterize the planetary boundary layer. There is a separate driver that orchestrates this portion of the algorithm, and there is a diversity of parameterizations to be found here.</li>
<li>src/tracer: These files handle the lateral transport and diffusion of tracers, or are the code to implement various passive tracer packages. Additional tracer packages are readily accomodated.</li>
<li>src/user: These are either stub routines that a user could use to change the model's initial conditions or forcing, or are examples that implement specific test cases. These files can easily be hand edited to create new analytically specified configurations.</li>
</ul>
<p>Most simulations can be set up by modifying only the files MOM_input, and possibly one or two of the files in src/user. In addition, the diag_table (MOM_diag_table) will commonly be modified to tailor the output to the needs of the question at hand. The FMS utility mkmf works with a file called path_names to build an appropriate makefile, and path_names should be edited to reflect the actual location of the desired source code.</p>
<p>There are 3 publicly visible subroutines in this file (<a class="el" href="../../d8/da7/MOM_8F90.html">MOM.F90</a>).</p><ul>
<li>step_MOM steps MOM over a specified interval of time.</li>
<li>MOM_initialize calls initialize and does other initialization that does not warrant user modification.</li>
<li><p class="startli">calculate_surface_state determines the surface (bulk mixed layer if traditional isoycnal vertical coordinate) properties of the current model state and packages pointers to these fields into an exported structure.</p>
<p class="startli">The remaining subroutines in this file (<a class="el" href="../../d8/da7/MOM_8F90.html">src/core/MOM.F90</a>) are:</p>
</li>
<li>find_total_transport determines the barotropic mass transport.</li>
<li>register_diags registers many diagnostic fields for the dynamic solver, or of the main model variables.</li>
<li>MOM_timing_init initializes various CPU time clocks.</li>
<li>write_static_fields writes out various time-invariant fields.</li>
<li>set_restart_fields is used to specify those fields that are written to and read from the restart file.</li>
</ul>
<p>Macros written all in capital letters are defined in MOM_memory.h.</p>
<h1><a class="anchor" id="section_gridlayout"></a>
MOM grid layout</h1>
<p>A small fragment of the grid is shown below:</p>
<pre class="fragment">    j+1  x ^ x ^ x

    j+1  &gt; o &gt; o &gt;

    j    x ^ x ^ x

    j    &gt; o &gt; o &gt;

    j-1  x ^ x ^ x

        i-1  i  i+1

           i  i+1</pre><p>Fields at each point</p><ul>
<li>x = q, CoriolisBu</li>
<li>^ = v, PFv, CAv, vh, diffv, tauy, vbt, vhtr</li>
<li>&gt; = u, PFu, CAu, uh, diffu, taux, ubt, uhtr</li>
<li>o = h, bathyT, eta, T, S, tr</li>
</ul>
<p>The boundaries always run through q grid points (x).</p>
<h1><a class="anchor" id="section_heat_budget"></a>
Diagnosing MOM heat budget</h1>
<p>Here are some example heat budgets for the ALE version of MOM6.</p>
<h2><a class="anchor" id="subsection_2d_heat_budget"></a>
Depth integrated heat budget</h2>
<p>Depth integrated heat budget diagnostic for MOM.</p>
<ul>
<li>OPOTTEMPTEND_2d = T_ADVECTION_XY_2d + OPOTTEMPPMDIFF_2d + HFDS + HFGEOU</li>
<li>T_ADVECTION_XY_2d = horizontal advection</li>
<li>OPOTTEMPPMDIFF_2d = neutral diffusion</li>
<li>HFDS = net surface boundary heat flux</li>
<li>HFGEOU = geothermal heat flux</li>
<li>HFDS = net surface boundary heat flux entering the ocean = rsntds + rlntds + hfls + hfss + heat_pme + hfsifrazil</li>
<li>More heat flux cross-checks<ul>
<li>hfds = net_heat_coupler + hfsifrazil + heat_pme</li>
<li>heat_pme = heat_content_surfwater = heat_content_massin + heat_content_massout = heat_content_fprec + heat_content_cond + heat_content_vprec<ul>
<li>hfrunoffds + hfevapds + hfrainds</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="subsection_3d_heat_budget"></a>
Depth integrated heat budget</h2>
<p>Here is an example 3d heat budget diagnostic for MOM.</p>
<ul>
<li>OPOTTEMPTEND = T_ADVECTION_XY + TH_TENDENCY_VERT_REMAP + OPOTTEMPDIFF + OPOTTEMPPMDIFF<ul>
<li>BOUNDARY_FORCING_HEAT_TENDENCY + FRAZIL_HEAT_TENDENCY</li>
</ul>
</li>
<li>OPOTTEMPTEND = net tendency of heat as diagnosed in <a class="el" href="../../d8/da7/MOM_8F90.html">MOM.F90</a></li>
<li>T_ADVECTION_XY = heating of a cell from lateral advection</li>
<li>TH_TENDENCY_VERT_REMAP = heating of a cell from vertical remapping</li>
<li>OPOTTEMPDIFF = heating of a cell from diabatic diffusion</li>
<li>OPOTTEMPPMDIFF = heating of a cell from neutral diffusion</li>
<li>BOUNDARY_FORCING_HEAT_TENDENCY = heating of cell from boundary fluxes</li>
<li>FRAZIL_HEAT_TENDENCY = heating of cell from frazil</li>
<li>TH_TENDENCY_VERT_REMAP has zero vertical sum, as it redistributes heat in vertical.</li>
<li>OPOTTEMPDIFF has zero vertical sum, as it redistributes heat in the vertical.</li>
<li>BOUNDARY_FORCING_HEAT_TENDENCY generally has 3d structure, with k &gt; 1 contributions from penetrative shortwave, and from other fluxes for the case when layers are tiny, in which case MOM6 partitions tendencies into k &gt; 1 layers.</li>
<li>FRAZIL_HEAT_TENDENCY generally has 3d structure, since MOM6 frazil calculation checks the full ocean column.</li>
<li>FRAZIL_HEAT_TENDENCY[k=] = HFSIFRAZIL = column integrated frazil heating.</li>
<li><p class="startli">HFDS = FRAZIL_HEAT_TENDENCY[k=] + BOUNDARY_FORCING_HEAT_TENDENCY[k=]</p>
<p class="startli">Here is an example 2d heat budget (depth summed) diagnostic for MOM.</p>
</li>
<li><p class="startli">OPOTTEMPTEND_2d = T_ADVECTION_XY_2d + OPOTTEMPPMDIFF_2d + HFDS</p>
<p class="startli">Here is an example 3d salt budget diagnostic for MOM.</p>
</li>
<li>OSALTTEND = S_ADVECTION_XY + SH_TENDENCY_VERT_REMAP + OSALTDIFF + OSALTPMDIFF<ul>
<li>BOUNDARY_FORCING_SALT_TENDENCY</li>
</ul>
</li>
<li>OSALTTEND = net tendency of salt as diagnosed in <a class="el" href="../../d8/da7/MOM_8F90.html">MOM.F90</a></li>
<li>S_ADVECTION_XY = salt convergence to cell from lateral advection</li>
<li>SH_TENDENCY_VERT_REMAP = salt convergence to cell from vertical remapping</li>
<li>OSALTDIFF = salt convergence to cell from diabatic diffusion</li>
<li>OSALTPMDIFF = salt convergence to cell from neutral diffusion</li>
<li>BOUNDARY_FORCING_SALT_TENDENCY = salt convergence to cell from boundary fluxes</li>
<li>SH_TENDENCY_VERT_REMAP has zero vertical sum, as it redistributes salt in vertical.</li>
<li>OSALTDIFF has zero vertical sum, as it redistributes salt in the vertical.</li>
<li>BOUNDARY_FORCING_SALT_TENDENCY generally has 3d structure, with k &gt; 1 contributions from the case when layers are tiny, in which case MOM6 partitions tendencies into k &gt; 1 layers.</li>
<li><p class="startli">SFDSI = BOUNDARY_FORCING_SALT_TENDENCY[k=]</p>
<p class="startli">Here is an example 2d salt budget (depth summed) diagnostic for MOM.</p>
</li>
<li>OSALTTEND_2d = S_ADVECTION_XY_2d + OSALTPMDIFF_2d + SFDSI (+ SALT_FLUX_RESTORE) </li>
</ul>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a132920be40adc59cc70083eaa0111431"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom::calculate_surface_state </td>
          <td>(</td>
          <td class="paramtype">type(surface), intent(inout)&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(in), target&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(in), target&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in), target&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>ssh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>p_atm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine sets the surface (return) properties of the ocean model by setting the appropriate pointers in state. Unused fields are set to NULL. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>ocean surface state</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>zonal velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>meridional velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>layer thickness (m or kg/m2)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ssh</td><td>time mean surface height (m)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>control structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">p_atm</td><td>atmospheric pressure (Pascal) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02810">2810</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../de/d8c/MOM__tracer__flow__control_8F90_source.html#l00539">mom_tracer_flow_control::call_tracer_surface_state()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00125">mom_error_handler::calltree_enter()</a>, and <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00146">mom_error_handler::calltree_leave()</a>.</p>

<p>Referenced by <a class="el" href="../../de/dbc/MOM__driver_8F90_source.html#l00001">mom_main()</a>, <a class="el" href="../../d1/d1a/ocean__model__MOM_8F90_source.html#l00686">ocean_model_mod::ocean_model_init_sfc()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                          <span class="keywordtype">intent(inout)</span> :: g<span class="comment">      !&lt; ocean grid structure</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                        <span class="keywordtype">intent(inout)</span> :: gv<span class="comment">     !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="keywordtype">type</span>(surface),                                  <span class="keywordtype">intent(inout)</span> :: state<span class="comment">  !&lt; ocean surface state</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">target</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: u<span class="comment">      !&lt; zonal velocity (m/s)</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">target</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: v<span class="comment">      !&lt; meridional velocity (m/s)</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">target</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span> :: h<span class="comment">      !&lt; layer thickness (m or kg/m2)</span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">target</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,       <span class="keywordtype">intent(inout)</span> :: ssh<span class="comment">    !&lt; time mean surface height (m)</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct),                       <span class="keywordtype">intent(inout)</span> :: cs<span class="comment">     !&lt; control structure</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:)</span>                       :: p_atm<span class="comment">  !&lt; atmospheric pressure (Pascal)</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  <span class="comment">! local</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  <span class="keywordtype">real</span> :: depth(szi_(g))    <span class="comment">! distance from the surface (meter)</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;  <span class="keywordtype">real</span> :: depth_ml          <span class="comment">! depth over which to average to</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                            <span class="comment">! determine mixed layer properties (meter)</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  <span class="keywordtype">real</span> :: dh                <span class="comment">! thickness of a layer within mixed layer (meter)</span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;  <span class="keywordtype">real</span> :: mass              <span class="comment">! mass per unit area of a layer (kg/m2)</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;  <span class="keywordtype">real</span> :: igr0</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, numberoferrors</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;  <span class="keywordtype">logical</span> :: localerror</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;  <span class="keywordtype">character(240)</span> :: msg</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;calculate_surface_state(), MOM.F90&quot;</span>)</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  is  = g%isc ; ie  = g%iec ; js  = g%jsc ; je  = g%jec ; nz = g%ke</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;  state%sea_lev =&gt; ssh</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(p_atm)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(p_atm)) <span class="keywordflow">then</span></div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    igr0 = 1.0 / (gv%Rho0 * g%g_Earth)</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;      ssh(i,j) = ssh(i,j) + p_atm(i,j) * igr0</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="keywordflow">  endif</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;  <span class="keywordflow">if</span> (cs%bulkmixedlayer) <span class="keywordflow">then</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    state%SST =&gt; cs%tv%T(:,:,1)</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    state%SSS =&gt; cs%tv%S(:,:,1)</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    <span class="keyword">nullify</span>(state%sfc_density)</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%Hml)) state%Hml =&gt; cs%tv%Hml</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;      <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%SST)) <span class="keywordflow">then</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;        <span class="keyword">allocate</span>(state%SST(isd:ied,jsd:jed)) ; state%SST(:,:) = 0.0</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%SSS)) <span class="keywordflow">then</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;        <span class="keyword">allocate</span>(state%SSS(isd:ied,jsd:jed)) ; state%SSS(:,:) = 0.0</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;      <span class="keyword">nullify</span>(state%sfc_density)</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;      <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%sfc_density)) <span class="keywordflow">then</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        <span class="keyword">allocate</span>(state%sfc_density(isd:ied,jsd:jed)) ; state%sfc_density(:,:) = 0.0</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;      <span class="keyword">nullify</span>(state%SST) ; <span class="keyword">nullify</span>(state%SSS)</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%Hml)) <span class="keyword">allocate</span>(state%Hml(isd:ied,jsd:jed))</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    depth_ml = cs%Hmix</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;  <span class="comment">!   Determine the mean properties of the uppermost depth_ml fluid.</span></div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,nz,CS,state,h,depth_ml,GV) private(depth,dh)</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;        depth(i) = 0.0</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;          state%SST(i,j) = 0.0 ; state%SSS(i,j) = 0.0</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;          state%sfc_density(i,j) = 0.0</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        <span class="keywordflow">if</span> (depth(i) + h(i,j,k)*gv%H_to_m &lt; depth_ml) <span class="keywordflow">then</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;          dh = h(i,j,k)*gv%H_to_m</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        <span class="keywordflow">elseif</span> (depth(i) &lt; depth_ml) <span class="keywordflow">then</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;          dh = depth_ml - depth(i)</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;          dh = 0.0</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;          state%SST(i,j) = state%SST(i,j) + dh * cs%tv%T(i,j,k)</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;          state%SSS(i,j) = state%SSS(i,j) + dh * cs%tv%S(i,j,k)</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;          state%sfc_density(i,j) = state%sfc_density(i,j) + dh * gv%Rlay(k)</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        depth(i) = depth(i) + dh</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  <span class="comment">! Calculate the average properties of the mixed layer depth.</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        <span class="keywordflow">if</span> (depth(i) &lt; gv%H_subroundoff*gv%H_to_m) &amp;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;            depth(i) = gv%H_subroundoff*gv%H_to_m</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;          state%SST(i,j) = state%SST(i,j) / depth(i)</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;          state%SSS(i,j) = state%SSS(i,j) / depth(i)</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;          state%sfc_density(i,j) = state%sfc_density(i,j) / depth(i)</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        state%Hml(i,j) = depth(i)</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="keywordflow">    enddo</span> <span class="comment">! end of j loop</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="keywordflow">  endif</span>                                             <span class="comment">! end BULKMIXEDLAYER</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;  state%u =&gt; u(:,:,1)</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  state%v =&gt; v(:,:,1)</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;  state%frazil =&gt; cs%tv%frazil</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  state%TempxPmE =&gt; cs%tv%TempxPmE</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;  state%internal_heat =&gt; cs%tv%internal_heat</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;  <span class="comment">! Allocate structures for ocean_mass, ocean_heat, and ocean_salt.  This could</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;  <span class="comment">! be wrapped in a run-time flag to disable it for economy, since the 3-d</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;  <span class="comment">! sums are not negligible.</span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%ocean_mass)) <span class="keywordflow">then</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="keyword">allocate</span>(state%ocean_mass(isd:ied,jsd:jed)) ; state%ocean_mass(:,:) = 0.0</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%ocean_heat)) <span class="keywordflow">then</span></div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;      <span class="keyword">allocate</span>(state%ocean_heat(isd:ied,jsd:jed)) ; state%ocean_heat(:,:) = 0.0</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%ocean_salt)) <span class="keywordflow">then</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;      <span class="keyword">allocate</span>(state%ocean_salt(isd:ied,jsd:jed)) ; state%ocean_salt(:,:) = 0.0</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment">!$OMP parallel default(none) shared(is,ie,js,je,nz,GV,h,state,CS) private(mass)</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(state%salt_deficit) .and. <span class="keyword">associated</span>(cs%tv%salt_deficit)) <span class="keywordflow">then</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      <span class="comment">! Convert from gSalt to kgSalt</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      state%salt_deficit(i,j) = 1000.0 * cs%tv%salt_deficit(i,j)</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(state%ocean_mass) .and. <span class="keyword">associated</span>(state%ocean_heat) .and. &amp;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <span class="keyword">associated</span>(state%ocean_salt)) <span class="keywordflow">then</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      state%ocean_mass(i,j) = 0.0</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;      state%ocean_heat(i,j) = 0.0 ; state%ocean_salt(i,j) = 0.0</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> k=1,nz; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      mass = gv%H_to_kg_m2*h(i,j,k)</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      state%ocean_mass(i,j) = state%ocean_mass(i,j) + mass</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      state%ocean_heat(i,j) = state%ocean_heat(i,j) + mass*cs%tv%T(i,j,k)</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      state%ocean_salt(i,j) = state%ocean_salt(i,j) + &amp;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                              mass * (1.0e-3*cs%tv%S(i,j,k))</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(state%ocean_mass)) <span class="keywordflow">then</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; state%ocean_mass(i,j) = 0.0 ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        state%ocean_mass(i,j) = state%ocean_mass(i,j) + gv%H_to_kg_m2*h(i,j,k)</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(state%ocean_heat)) <span class="keywordflow">then</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; state%ocean_heat(i,j) = 0.0 ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        mass = gv%H_to_kg_m2*h(i,j,k)</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        state%ocean_heat(i,j) = state%ocean_heat(i,j) + mass*cs%tv%T(i,j,k)</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(state%ocean_salt)) <span class="keywordflow">then</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; state%ocean_salt(i,j) = 0.0 ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        mass = gv%H_to_kg_m2*h(i,j,k)</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        state%ocean_salt(i,j) = state%ocean_salt(i,j) + &amp;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                                mass * (1.0e-3*cs%tv%S(i,j,k))</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="comment">!$OMP end parallel</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%visc%taux_shelf)) state%taux_shelf =&gt; cs%visc%taux_shelf</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%visc%tauy_shelf)) state%tauy_shelf =&gt; cs%visc%tauy_shelf</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tracer_flow_CSp)) <span class="keywordflow">then</span></div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(state%tr_fields)) <span class="keyword">allocate</span>(state%tr_fields)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="keyword">call </span>call_tracer_surface_state(state, h, g, cs%tracer_flow_CSp)</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;  <span class="keywordflow">if</span> (cs%check_bad_surface_vals) <span class="keywordflow">then</span></div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    numberoferrors=0 <span class="comment">! count number of errors</span></div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <span class="keywordflow">do</span> j=js,je; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        localerror = state%sea_lev(i,j)&lt;=-g%bathyT(i,j)       &amp;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                .or. state%sea_lev(i,j)&gt;= cs%bad_val_ssh_max  &amp;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                .or. state%sea_lev(i,j)&lt;=-cs%bad_val_ssh_max</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) localerror = localerror &amp;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                .or. state%SSS(i,j)&lt;0.                        &amp;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                .or. state%SSS(i,j)&gt;=cs%bad_val_sss_max       &amp;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                .or. state%SST(i,j)&lt; cs%bad_val_sst_min       &amp;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;                .or. state%SST(i,j)&gt;=cs%bad_val_sst_max</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="keywordflow">if</span> (localerror) <span class="keywordflow">then</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;          numberoferrors=numberoferrors+1</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;          <span class="keywordflow">if</span> (numberoferrors&lt;9) <span class="keywordflow">then</span> <span class="comment">! Only report details for the first few errors</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;            <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;              <span class="keyword">write</span>(msg(1:240),<span class="stringliteral">&#39;(2(a,i4,x),2(a,f8.3,x),8(a,es11.4,x))&#39;</span>) &amp;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                <span class="stringliteral">&#39;Extreme surface state detected: i=&#39;</span>,i,<span class="stringliteral">&#39;j=&#39;</span>,j, &amp;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                <span class="stringliteral">&#39;x=&#39;</span>,g%geoLonT(i,j),<span class="stringliteral">&#39;y=&#39;</span>,g%geoLatT(i,j), &amp;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                <span class="stringliteral">&#39;D=&#39;</span>,g%bathyT(i,j),                      &amp;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;                <span class="stringliteral">&#39;SSH=&#39;</span>,state%sea_lev(i,j),               &amp;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;                <span class="stringliteral">&#39;SST=&#39;</span>,state%SST(i,j),                   &amp;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                <span class="stringliteral">&#39;SSS=&#39;</span>,state%SSS(i,j),                   &amp;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                <span class="stringliteral">&#39;U-=&#39;</span>,state%u(i-1,j),                    &amp;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                <span class="stringliteral">&#39;U+=&#39;</span>,state%u(i,j),                      &amp;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                <span class="stringliteral">&#39;V-=&#39;</span>,state%v(i,j-1),                    &amp;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                <span class="stringliteral">&#39;V+=&#39;</span>,state%v(i,j)</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;              <span class="keyword">write</span>(msg(1:240),<span class="stringliteral">&#39;(2(a,i4,x),2(a,f8.3,x),6(a,es11.4))&#39;</span>) &amp;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                <span class="stringliteral">&#39;Extreme surface state detected: i=&#39;</span>,i,<span class="stringliteral">&#39;j=&#39;</span>,j, &amp;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                <span class="stringliteral">&#39;x=&#39;</span>,g%geoLonT(i,j),<span class="stringliteral">&#39;y=&#39;</span>,g%geoLatT(i,j), &amp;</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                <span class="stringliteral">&#39;D=&#39;</span>,g%bathyT(i,j),                      &amp;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;                <span class="stringliteral">&#39;SSH=&#39;</span>,state%sea_lev(i,j),               &amp;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;                <span class="stringliteral">&#39;U-=&#39;</span>,state%u(i-1,j),                    &amp;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;                <span class="stringliteral">&#39;U+=&#39;</span>,state%u(i,j),                      &amp;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                <span class="stringliteral">&#39;V-=&#39;</span>,state%v(i,j-1),                    &amp;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                <span class="stringliteral">&#39;V+=&#39;</span>,state%v(i,j)</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;            <span class="keyword">call </span>mom_error(warning, trim(msg), all_print=.true.)</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;          <span class="keywordflow">elseif</span> (numberoferrors==9) <span class="keywordflow">then</span> <span class="comment">! Indicate once that there are more errors</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;            <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&#39;There were more unreported extreme events!&#39;</span>, all_print=.true.)</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="keywordflow">          endif</span> <span class="comment">! numberOfErrors</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="keywordflow">        endif</span> <span class="comment">! localError</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="keywordflow">      endif</span> <span class="comment">! mask2dT</span></div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="keyword">    end</span>do; enddo</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <span class="keyword">call </span>sum_across_pes(numberoferrors)</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;    <span class="keywordflow">if</span> (numberoferrors&gt;0) <span class="keywordflow">then</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      <span class="keyword">write</span>(msg(1:240),<span class="stringliteral">&#39;(3(a,i9,x))&#39;</span>) <span class="stringliteral">&#39;There were a total of &#39;</span>,numberoferrors, &amp;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;          <span class="stringliteral">&#39;locations detected with extreme surface values!&#39;</span></div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      <span class="keyword">call </span>mom_error(fatal, trim(msg))</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;calculate_surface_state()&quot;</span>)</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a132920be40adc59cc70083eaa0111431_cgraph.svg" width="100%" height="432"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a132920be40adc59cc70083eaa0111431_icgraph.svg" width="464" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0dd32ae97ee7dd3cbb8e14e4cf11f191"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom::finish_mom_initialization </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(directories), intent(in)&#160;</td>
          <td class="paramname"><em>dirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(forcing), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine finishes initializing MOM and writes out the initial conditions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>model time, used in this routine</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dirs</td><td>structure with directory paths</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>pointer set in this routine to MOM control structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>pointers to forcing fields </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02072">2072</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00125">mom_error_handler::calltree_enter()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00146">mom_error_handler::calltree_leave()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00395">id_clock_init</a>, and <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00537">mom_io::var_desc()</a>.</p>

<p>Referenced by <a class="el" href="../../de/dbc/MOM__driver_8F90_source.html#l00001">mom_main()</a>, and <a class="el" href="../../d1/d1a/ocean__model__MOM_8F90_source.html#l00328">ocean_model_mod::update_ocean_model()</a>.</p>
<div class="fragment"><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordtype">type</span>(time_type),           <span class="keywordtype">intent(in)</span>    :: time<span class="comment">        !&lt; model time, used in this routine</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordtype">type</span>(directories),         <span class="keywordtype">intent(in)</span>    :: dirs<span class="comment">        !&lt; structure with directory paths</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct),  <span class="keywordtype">pointer</span>       :: cs<span class="comment">          !&lt; pointer set in this routine to MOM control structure</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  <span class="keywordtype">type</span>(forcing),             <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment">      !&lt; pointers to forcing fields</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">pointer</span> :: g =&gt; null()</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">pointer</span> :: gv =&gt; null()</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <span class="keywordtype">type</span>(mom_restart_cs), <span class="keywordtype">pointer</span> :: restart_csp_tmp =&gt; null()</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span> :: z_interface(:,:,:) <span class="comment">! Interface heights (meter)</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span> :: eta(:,:) <span class="comment">! Interface heights (meter)</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="keywordtype">type</span>(vardesc) :: vd</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_init)</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;finish_MOM_initialization()&quot;</span>)</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="comment">! Pointers for convenience</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  g =&gt; cs%G ; gv =&gt; cs%GV</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <span class="comment">! Write initial conditions</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  <span class="keywordflow">if</span> (cs%write_IC) <span class="keywordflow">then</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="keyword">allocate</span>(restart_csp_tmp)</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    restart_csp_tmp = cs%restart_CSp</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keyword">allocate</span>(z_interface(szi_(g),szj_(g),szk_(g)+1))</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keyword">call </span>find_eta(cs%h, cs%tv, g%g_Earth, g, gv, z_interface)</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;eta&quot;</span>,<span class="stringliteral">&quot;meter&quot;</span>,<span class="stringliteral">&quot;Interface heights&quot;</span>,z_grid=<span class="stringliteral">&#39;i&#39;</span>)</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <span class="keyword">call </span>register_restart_field(z_interface, vd, .true., restart_csp_tmp)</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keyword">call </span>save_restart(dirs%output_directory, time, g, &amp;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                      restart_csp_tmp, filename=cs%IC_file, gv=gv)</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    <span class="keyword">deallocate</span>(z_interface)</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="keyword">deallocate</span>(restart_csp_tmp)</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;finish_MOM_initialization()&quot;</span>)</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_init)</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a0dd32ae97ee7dd3cbb8e14e4cf11f191_cgraph.svg" width="100%" height="454"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a0dd32ae97ee7dd3cbb8e14e4cf11f191_icgraph.svg" width="376" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="afebdc0103ad9cbe0ed4a54e522dc4104"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom::initialize_mom </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(inout), target&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(out)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(directories), intent(out)&#160;</td>
          <td class="paramname"><em>dirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), optional&#160;</td>
          <td class="paramname"><em>Time_in</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine initializes MOM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">time</td><td>model time, set in this routine</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">param_file</td><td>structure indicating paramater file to parse</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dirs</td><td>structure with directory paths</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>pointer set in this routine to MOM control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_in</td><td>time passed to MOM_initialize_state when model is not being started from a restart file </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">1360</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d6/d34/MOM__diabatic__driver_8F90_source.html#l01658">mom_diabatic_driver::adiabatic_driver_init()</a>, <a class="el" href="../../d4/db9/MOM__ALE_8F90_source.html#l00257">mom_ale::ale_register_diags()</a>, <a class="el" href="../../d4/db9/MOM__ALE_8F90_source.html#l01313">mom_ale::ale_remap_init_conds()</a>, <a class="el" href="../../d4/db9/MOM__ALE_8F90_source.html#l01340">mom_ale::ale_updateverticalgridtype()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00125">mom_error_handler::calltree_enter()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00146">mom_error_handler::calltree_leave()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00156">mom_error_handler::calltree_waypoint()</a>, <a class="el" href="../../da/d2c/MOM__transcribe__grid_8F90_source.html#l00038">mom_transcribe_grid::copy_dyngrid_to_mom_grid()</a>, <a class="el" href="../../da/d2c/MOM__transcribe__grid_8F90_source.html#l00183">mom_transcribe_grid::copy_mom_grid_to_dyngrid()</a>, <a class="el" href="../../dc/dc9/MOM__dyn__horgrid_8F90_source.html#l00150">mom_dyn_horgrid::create_dyn_horgrid()</a>, <a class="el" href="../../dc/dc9/MOM__dyn__horgrid_8F90_source.html#l00304">mom_dyn_horgrid::destroy_dyn_horgrid()</a>, <a class="el" href="../../db/da5/MOM__diag__mediator_8F90_source.html#l01759">mom_diag_mediator::diag_masks_set()</a>, <a class="el" href="../../d7/d74/MOM__EOS_8F90_source.html#l00439">mom_eos::eos_init()</a>, <a class="el" href="../../dd/d3c/MOM__obsolete__params_8F90_source.html#l00021">mom_obsolete_params::find_obsolete_params()</a>, <a class="el" href="../../db/d87/MOM__get__input_8F90_source.html#l00055">mom_get_input::get_mom_input()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00395">id_clock_init</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00396">id_clock_mom_init</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00398">id_clock_pass_init</a>, <a class="el" href="../../de/deb/MOM__ALE__sponge_8F90_source.html#l00157">mom_ale_sponge::init_ale_sponge_diags()</a>, <a class="el" href="../../da/dd2/MOM__sponge_8F90_source.html#l00247">mom_sponge::init_sponge_diags()</a>, <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00160">mom_tracer_registry::lock_tracer_registry()</a>, <a class="el" href="../../d6/ddb/MOM__file__parser_8F90_source.html#l01185">mom_file_parser::log_version()</a>, <a class="el" href="../../dd/d45/MOM__MEKE_8F90_source.html#l01023">mom_meke::meke_alloc_register_restart()</a>, <a class="el" href="../../dd/d45/MOM__MEKE_8F90_source.html#l00769">mom_meke::meke_init()</a>, <a class="el" href="../../d9/d41/MOM__mixed__layer__restrat_8F90_source.html#l00742">mom_mixed_layer_restrat::mixedlayer_restrat_register_restarts()</a>, <a class="el" href="../../d8/d48/MOM__checksums_8F90_source.html#l01245">mom_checksums::mom_checksums_init()</a>, <a class="el" href="../../dd/d4c/MOM__grid_8F90_source.html#l00493">mom_grid::mom_grid_end()</a>, <a class="el" href="../../dd/d4c/MOM__grid_8F90_source.html#l00155">mom_grid::mom_grid_init()</a>, <a class="el" href="../../de/d3a/MOM__coord__initialization_8F90_source.html#l00036">mom_coord_initialization::mom_initialize_coord()</a>, <a class="el" href="../../d0/dc9/MOM__fixed__initialization_8F90_source.html#l00047">mom_fixed_initialization::mom_initialize_fixed()</a>, <a class="el" href="../../d6/da9/MOM__state__initialization_8F90_source.html#l00096">mom_state_initialization::mom_initialize_state()</a>, <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00814">mom_io::mom_io_init()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, <a class="el" href="../../d8/da4/MOM__neutral__diffusion_8F90_source.html#l00120">mom_neutral_diffusion::neutral_diffusion_diag_init()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02134">register_diags()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02344">register_diags_ts_tendency()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02443">register_diags_ts_vardec()</a>, <a class="el" href="../../d4/ded/MOM__obsolete__diagnostics_8F90_source.html#l00022">mom_obsolete_diagnostics::register_obsolete_diagnostics()</a>, <a class="el" href="../../d2/d47/MOM__restart_8F90_source.html#l01219">mom_restart::restart_init()</a>, <a class="el" href="../../db/da5/MOM__diag__mediator_8F90_source.html#l00197">mom_diag_mediator::set_axes_info()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02763">set_restart_fields()</a>, <a class="el" href="../../d8/d50/MOM__set__viscosity_8F90_source.html#l01536">mom_set_visc::set_visc_register_restarts()</a>, <a class="el" href="../../d2/d6f/MOM__thickness__diffuse_8F90_source.html#l01583">mom_thickness_diffuse::thickness_diffuse_init()</a>, <a class="el" href="../../de/d8c/MOM__tracer__flow__control_8F90_source.html#l00206">mom_tracer_flow_control::tracer_flow_control_init()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02116">unittests()</a>, <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00537">mom_io::var_desc()</a>, <a class="el" href="../../d9/d52/MOM__wave__speed_8F90_source.html#l01021">mom_wave_speed::wave_speed_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02646">write_static_fields()</a>.</p>

<p>Referenced by <a class="el" href="../../de/dbc/MOM__driver_8F90_source.html#l00001">mom_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>,   <span class="keywordtype">intent(inout)</span> :: time<span class="comment">        !&lt; model time, set in this routine</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="keywordtype">type</span>(param_file_type),     <span class="keywordtype">intent(out)</span>   :: param_file<span class="comment">  !&lt; structure indicating paramater file to parse</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordtype">type</span>(directories),         <span class="keywordtype">intent(out)</span>   :: dirs<span class="comment">        !&lt; structure with directory paths</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct),  <span class="keywordtype">pointer</span>       :: cs<span class="comment">          !&lt; pointer set in this routine to MOM control structure</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: time_in<span class="comment">     !&lt; time passed to MOM_initialize_state when</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">                                                          !! model is not being started from a restart file</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="comment">! local</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">pointer</span> :: g <span class="comment">! pointer to a structure with metrics and related</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">pointer</span> :: gv =&gt; null()</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type), <span class="keywordtype">pointer</span> :: dg =&gt; null()</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),       <span class="keywordtype">pointer</span> :: diag</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordtype">character(len=4)</span>, <span class="keywordtype">parameter</span> :: vers_num = <span class="stringliteral">&#39;v2.0&#39;</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed, nz</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordtype">integer</span> :: isdb, iedb, jsdb, jedb</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="keywordtype">real</span>    :: dtbt</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="keywordtype">real</span>    :: z_diag_int  <span class="comment">! minimum interval between calc depth-space diagnostics (sec)</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: e   <span class="comment">! interface heights (meter)</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span>   :: eta <span class="comment">! free surface height (m) or bottom press (Pa)</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordtype">type</span>(mom_restart_cs),  <span class="keywordtype">pointer</span>      :: restart_csp_tmp =&gt; null()</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordtype">integer</span> :: nkml, nkbl, verbosity, write_geom</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="keywordtype">real</span>    :: default_val       <span class="comment">! default value for a parameter</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keywordtype">logical</span> :: write_geom_files  <span class="comment">! If true, write out the grid geometry files.</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="keywordtype">logical</span> :: new_sim</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordtype">logical</span> :: use_geothermal    <span class="comment">! If true, apply geothermal heating.</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keywordtype">logical</span> :: use_eos           <span class="comment">! If true, density calculated from T &amp; S using an equation of state.</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordtype">logical</span> :: symmetric         <span class="comment">! If true, use symmetric memory allocation.</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordtype">logical</span> :: save_ic           <span class="comment">! If true, save the initial conditions.</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordtype">logical</span> :: do_unit_tests     <span class="comment">! If true, call unit tests.</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="keywordtype">logical</span> :: test_grid_copy = .false.</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="keywordtype">type</span>(time_type)                 :: start_time</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="keywordtype">type</span>(ocean_internal_state)      :: mom_internal_state</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;initialize_MOM called with an associated &quot;</span>// &amp;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                            <span class="stringliteral">&quot;control structure.&quot;</span>)</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keyword">allocate</span>(cs)</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="keywordflow">if</span> (test_grid_copy) <span class="keywordflow">then</span> ; <span class="keyword">allocate</span>(g)</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="keywordflow">else</span> ; g =&gt; cs%G ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  cs%Time =&gt; time</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  id_clock_init = cpu_clock_id(<span class="stringliteral">&#39;Ocean Initialization&#39;</span>, grain=clock_subcomponent)</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_init)</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  start_time = time ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(time_in)) start_time = time_in</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="keyword">call </span>get_mom_input(param_file, dirs)</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  verbosity = 2 ; <span class="keyword">call </span>read_param(param_file, <span class="stringliteral">&quot;VERBOSITY&quot;</span>, verbosity)</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keyword">call </span>mom_set_verbosity(verbosity)</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;initialize_MOM(), MOM.F90&quot;</span>)</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="keyword">call </span>find_obsolete_params(param_file)</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="preprocessor">#ifdef SYMMETRIC_MEMORY_</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="preprocessor"></span>  symmetric = .true.</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="preprocessor"></span>  symmetric = .false.</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef STATIC_MEMORY_</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="preprocessor"></span>  <span class="keyword">call </span>mom_domains_init(g%domain, param_file, symmetric=symmetric, &amp;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            static_memory=.true., nihalo=nihalo_, njhalo=njhalo_, &amp;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            niglobal=niglobal_, njglobal=njglobal_, niproc=niproc_, &amp;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            njproc=njproc_)</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor"></span>  <span class="keyword">call </span>mom_domains_init(g%domain, param_file, symmetric=symmetric)</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="preprocessor"></span>  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;domains initialized (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keyword">call </span>mom_checksums_init(param_file)</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="keyword">call </span>diag_mediator_infrastructure_init()</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keyword">call </span>mom_io_init(param_file)</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="keyword">call </span>mom_grid_init(g, param_file)</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keyword">call </span>verticalgridinit( param_file, cs%GV )</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  gv =&gt; cs%GV</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="comment">! Read relevant parameters and write them to the model log.</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keyword">call </span>log_version(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;VERBOSITY&quot;</span>, verbosity,  &amp;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                 <span class="stringliteral">&quot;Integer controlling level of messaging\n&quot;</span> // &amp;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                 <span class="stringliteral">&quot;\t0 = Only FATAL messages\n&quot;</span> // &amp;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                 <span class="stringliteral">&quot;\t2 = Only FATAL, WARNING, NOTE [default]\n&quot;</span> // &amp;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                 <span class="stringliteral">&quot;\t9 = All)&quot;</span>, default=2)</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;SPLIT&quot;</span>, cs%split, &amp;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                 <span class="stringliteral">&quot;Use the split time stepping if true.&quot;</span>, default=.true.)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="keywordflow">if</span> (cs%split) <span class="keywordflow">then</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;USE_LEGACY_SPLIT&quot;</span>, cs%legacy_split, &amp;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                 <span class="stringliteral">&quot;If true, use the full range of options available from \n&quot;</span>//&amp;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                 <span class="stringliteral">&quot;the older GOLD-derived split time stepping code.&quot;</span>, &amp;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                 default=.false.)</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    cs%use_RK2 = .false.</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;USE_RK2&quot;</span>, cs%use_RK2, &amp;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                 <span class="stringliteral">&quot;If true, use RK2 instead of RK3 in the unsplit time stepping.&quot;</span>, &amp;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                 default=.false.)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    cs%legacy_split = .false.</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;ENABLE_THERMODYNAMICS&quot;</span>, cs%use_temperature, &amp;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                 <span class="stringliteral">&quot;If true, Temperature and salinity are used as state \n&quot;</span>//&amp;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                 <span class="stringliteral">&quot;variables.&quot;</span>, default=.true.)</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;USE_EOS&quot;</span>, use_eos, &amp;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                 <span class="stringliteral">&quot;If true,  density is calculated from temperature and \n&quot;</span>//&amp;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                 <span class="stringliteral">&quot;salinity with an equation of state.  If USE_EOS is \n&quot;</span>//&amp;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                 <span class="stringliteral">&quot;true, ENABLE_THERMODYNAMICS must be true as well.&quot;</span>, &amp;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                 default=cs%use_temperature)</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DIABATIC_FIRST&quot;</span>, cs%diabatic_first, &amp;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                 <span class="stringliteral">&quot;If true, apply diabatic and thermodynamic processes, \n&quot;</span>//&amp;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                 <span class="stringliteral">&quot;including buoyancy forcing and mass gain or loss, \n&quot;</span>//&amp;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                 <span class="stringliteral">&quot;before stepping the dynamics forward.&quot;</span>, default=.false.)</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;ADIABATIC&quot;</span>, cs%adiabatic, &amp;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                 <span class="stringliteral">&quot;There are no diapycnal mass fluxes if ADIABATIC is \n&quot;</span>//&amp;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                 <span class="stringliteral">&quot;true. This assumes that KD = KDML = 0.0 and that \n&quot;</span>//&amp;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                 <span class="stringliteral">&quot;there is no buoyancy forcing, but makes the model \n&quot;</span>//&amp;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                 <span class="stringliteral">&quot;faster by eliminating subroutine calls.&quot;</span>, default=.false.)</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;BULKMIXEDLAYER&quot;</span>, cs%bulkmixedlayer, &amp;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                 <span class="stringliteral">&quot;If true, use a Kraus-Turner-like bulk mixed layer \n&quot;</span>//&amp;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                 <span class="stringliteral">&quot;with transitional buffer layers.  Layers 1 through  \n&quot;</span>//&amp;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                 <span class="stringliteral">&quot;NKML+NKBL have variable densities. There must be at \n&quot;</span>//&amp;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                 <span class="stringliteral">&quot;least NKML+NKBL+1 layers if BULKMIXEDLAYER is true. \n&quot;</span>//&amp;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                 <span class="stringliteral">&quot;The default is the same setting as ENABLE_THERMODYNAMICS.&quot;</span>, &amp;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                 default=cs%use_temperature)</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;USE_REGRIDDING&quot;</span>, &amp;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                 cs%use_ALE_algorithm , &amp;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                 <span class="stringliteral">&quot;If True, use the ALE algorithm (regridding/remapping).\n&quot;</span>//&amp;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                 <span class="stringliteral">&quot;If False, use the layered isopycnal algorithm.&quot;</span>, default=.false. )</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span> (cs%bulkmixedlayer) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                 <span class="stringliteral">&quot;MOM: BULKMIXEDLAYER can not currently be used with the ALE algorithm.&quot;</span>)</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordflow">if</span> (.not. cs%use_temperature) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                 <span class="stringliteral">&quot;MOM: At this time, USE_EOS should be True when using the ALE algorithm.&quot;</span>)</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DO_DYNAMICS&quot;</span>, cs%do_dynamics, &amp;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                 <span class="stringliteral">&quot;If False, skips the dynamics calls that update u &amp; v, as well as\n&quot;</span>//&amp;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                 <span class="stringliteral">&quot;the gravity wave adjustment to h. This is a fragile feature and\n&quot;</span>//&amp;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                 <span class="stringliteral">&quot;thus undocumented.&quot;</span>, default=.true., do_not_log=.true. )</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;THICKNESSDIFFUSE&quot;</span>, cs%thickness_diffuse, &amp;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                 <span class="stringliteral">&quot;If true, interface heights are diffused with a \n&quot;</span>//&amp;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                 <span class="stringliteral">&quot;coefficient of KHTH.&quot;</span>, default=.false.)</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;THICKNESSDIFFUSE_FIRST&quot;</span>, &amp;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                                     cs%thickness_diffuse_first, &amp;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                 <span class="stringliteral">&quot;If true, do thickness diffusion before dynamics.\n&quot;</span>//&amp;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                 <span class="stringliteral">&quot;This is only used if THICKNESSDIFFUSE is true.&quot;</span>, &amp;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                 default=.false.)</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DEBUG&quot;</span>, cs%debug, &amp;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                 <span class="stringliteral">&quot;If true, write out verbose debugging data.&quot;</span>, default=.false.)</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DEBUG_TRUNCATIONS&quot;</span>, cs%debug_truncations, &amp;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                 <span class="stringliteral">&quot;If true, calculate all diagnostics that are useful for \n&quot;</span>//&amp;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                 <span class="stringliteral">&quot;debugging truncations.&quot;</span>, default=.false.)</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DT&quot;</span>, cs%dt, &amp;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                 <span class="stringliteral">&quot;The (baroclinic) dynamics time step.  The time-step that \n&quot;</span>//&amp;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                 <span class="stringliteral">&quot;is actually used will be an integer fraction of the \n&quot;</span>//&amp;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                 <span class="stringliteral">&quot;forcing time-step (DT_FORCING in ocean-only mode or the \n&quot;</span>//&amp;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                 <span class="stringliteral">&quot;coupling timestep in coupled mode.)&quot;</span>, units=<span class="stringliteral">&quot;s&quot;</span>, &amp;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                 fail_if_missing=.true.)</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DT_THERM&quot;</span>, cs%dt_therm, &amp;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                 <span class="stringliteral">&quot;The thermodynamic and tracer advection time step. \n&quot;</span>//&amp;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                 <span class="stringliteral">&quot;Ideally DT_THERM should be an integer multiple of DT \n&quot;</span>//&amp;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                 <span class="stringliteral">&quot;and less than the forcing or coupling time-step, unless \n&quot;</span>//&amp;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                 <span class="stringliteral">&quot;THERMO_SPANS_COUPLING is true, in which case DT_THERM \n&quot;</span>//&amp;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                 <span class="stringliteral">&quot;can be an integer multiple of the coupling timestep.  By \n&quot;</span>//&amp;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                 <span class="stringliteral">&quot;default DT_THERM is set to DT.&quot;</span>, units=<span class="stringliteral">&quot;s&quot;</span>, default=cs%dt)</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;THERMO_SPANS_COUPLING&quot;</span>, cs%thermo_spans_coupling, &amp;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                 <span class="stringliteral">&quot;If true, the MOM will take thermodynamic and tracer \n&quot;</span>//&amp;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                 <span class="stringliteral">&quot;timesteps that can be longer than the coupling timestep. \n&quot;</span>//&amp;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                 <span class="stringliteral">&quot;The actual thermodynamic timestep that is used in this \n&quot;</span>//&amp;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                 <span class="stringliteral">&quot;case is the largest integer multiple of the coupling \n&quot;</span>//&amp;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                 <span class="stringliteral">&quot;timestep that is less than or equal to DT_THERM.&quot;</span>, default=.false.)</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keywordflow">if</span> (.not.cs%bulkmixedlayer) <span class="keywordflow">then</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;HMIX_SFC_PROP&quot;</span>, cs%Hmix, &amp;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                 <span class="stringliteral">&quot;If BULKMIXEDLAYER is false, HMIX_SFC_PROP is the depth \n&quot;</span>//&amp;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                 <span class="stringliteral">&quot;over which to average to find surface properties like \n&quot;</span>//&amp;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                 <span class="stringliteral">&quot;SST and SSS or density (but not surface velocities).&quot;</span>, &amp;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                 units=<span class="stringliteral">&quot;m&quot;</span>, default=1.0)</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;MIN_Z_DIAG_INTERVAL&quot;</span>, z_diag_int, &amp;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                 <span class="stringliteral">&quot;The minimum amount of time in seconds between \n&quot;</span>//&amp;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                 <span class="stringliteral">&quot;calculations of depth-space diagnostics. Making this \n&quot;</span>//&amp;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                 <span class="stringliteral">&quot;larger than DT_THERM reduces the  performance penalty \n&quot;</span>//&amp;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                 <span class="stringliteral">&quot;of regridding to depth online.&quot;</span>, units=<span class="stringliteral">&quot;s&quot;</span>, default=0.0)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;INTERPOLATE_P_SURF&quot;</span>, cs%interp_p_surf, &amp;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                 <span class="stringliteral">&quot;If true, linearly interpolate the surface pressure \n&quot;</span>//&amp;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                 <span class="stringliteral">&quot;over the coupling time step, using the specified value \n&quot;</span>//&amp;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                 <span class="stringliteral">&quot;at the end of the step.&quot;</span>, default=.false.)</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keywordflow">if</span> (cs%split) <span class="keywordflow">then</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DTBT&quot;</span>, dtbt, default=-0.98)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    default_val = cs%dt_therm ; <span class="keywordflow">if</span> (dtbt &gt; 0.0) default_val = -1.0</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    cs%dtbt_reset_period = -1.0</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DTBT_RESET_PERIOD&quot;</span>, cs%dtbt_reset_period, &amp;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                 <span class="stringliteral">&quot;The period between recalculations of DTBT (if DTBT &lt;= 0). \n&quot;</span>//&amp;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                 <span class="stringliteral">&quot;If DTBT_RESET_PERIOD is negative, DTBT is set based \n&quot;</span>//&amp;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                 <span class="stringliteral">&quot;only on information available at initialization.  If \n&quot;</span>//&amp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                 <span class="stringliteral">&quot;dynamic, DTBT will be set at least every forcing time \n&quot;</span>//&amp;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                 <span class="stringliteral">&quot;step, and if 0, every dynamics time step.  The default is \n&quot;</span>//&amp;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                 <span class="stringliteral">&quot;set by DT_THERM.  This is only used if SPLIT is true.&quot;</span>, &amp;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                 units=<span class="stringliteral">&quot;s&quot;</span>, default=default_val, do_not_read=(dtbt &gt; 0.0))</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="comment">! This is here in case these values are used inappropriately.</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  cs%use_frazil = .false. ; cs%bound_salinity = .false. ; cs%tv%P_Ref = 2.0e7</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;FRAZIL&quot;</span>, cs%use_frazil, &amp;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                 <span class="stringliteral">&quot;If true, water freezes if it gets too cold, and the \n&quot;</span>//&amp;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                 <span class="stringliteral">&quot;the accumulated heat deficit is returned in the \n&quot;</span>//&amp;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                 <span class="stringliteral">&quot;surface state.  FRAZIL is only used if \n&quot;</span>//&amp;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                 <span class="stringliteral">&quot;ENABLE_THERMODYNAMICS is true.&quot;</span>, default=.false.)</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DO_GEOTHERMAL&quot;</span>, use_geothermal, &amp;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                 <span class="stringliteral">&quot;If true, apply geothermal heating.&quot;</span>, default=.false.)</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;BOUND_SALINITY&quot;</span>, cs%bound_salinity, &amp;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                 <span class="stringliteral">&quot;If true, limit salinity to being positive. (The sea-ice \n&quot;</span>//&amp;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                 <span class="stringliteral">&quot;model may ask for more salt than is available and \n&quot;</span>//&amp;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                 <span class="stringliteral">&quot;drive the salinity negative otherwise.)&quot;</span>, default=.false.)</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;C_P&quot;</span>, cs%tv%C_p, &amp;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                 <span class="stringliteral">&quot;The heat capacity of sea water, approximated as a \n&quot;</span>//&amp;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                 <span class="stringliteral">&quot;constant. This is only used if ENABLE_THERMODYNAMICS is \n&quot;</span>//&amp;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                 <span class="stringliteral">&quot;true. The default value is from the TEOS-10 definition \n&quot;</span>//&amp;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                 <span class="stringliteral">&quot;of conservative temperature.&quot;</span>, units=<span class="stringliteral">&quot;J kg-1 K-1&quot;</span>, &amp;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                 default=3991.86795711963)</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keywordflow">if</span> (use_eos) <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;P_REF&quot;</span>, cs%tv%P_Ref, &amp;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                 <span class="stringliteral">&quot;The pressure that is used for calculating the coordinate \n&quot;</span>//&amp;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                 <span class="stringliteral">&quot;density.  (1 Pa = 1e4 dbar, so 2e7 is commonly used.) \n&quot;</span>//&amp;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                 <span class="stringliteral">&quot;This is only used if USE_EOS and ENABLE_THERMODYNAMICS \n&quot;</span>//&amp;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                 <span class="stringliteral">&quot;are true.&quot;</span>, units=<span class="stringliteral">&quot;Pa&quot;</span>, default=2.0e7)</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">if</span> (cs%bulkmixedlayer) <span class="keywordflow">then</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;NKML&quot;</span>, nkml, &amp;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                 <span class="stringliteral">&quot;The number of sublayers within the mixed layer if \n&quot;</span>//&amp;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                 <span class="stringliteral">&quot;BULKMIXEDLAYER is true.&quot;</span>, units=<span class="stringliteral">&quot;nondim&quot;</span>, default=2)</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;NKBL&quot;</span>, nkbl, &amp;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                 <span class="stringliteral">&quot;The number of layers that are used as variable density \n&quot;</span>//&amp;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                 <span class="stringliteral">&quot;buffer layers if BULKMIXEDLAYER is true.&quot;</span>, units=<span class="stringliteral">&quot;nondim&quot;</span>, &amp;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                 default=2)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;CHECK_BAD_SURFACE_VALS&quot;</span>, &amp;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                                     cs%check_bad_surface_vals, &amp;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                 <span class="stringliteral">&quot;If true, check the surface state for ridiculous values.&quot;</span>, &amp;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                 default=.false.)</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <span class="keywordflow">if</span> (cs%check_bad_surface_vals) <span class="keywordflow">then</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;BAD_VAL_SSH_MAX&quot;</span>, cs%bad_val_ssh_max, &amp;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                 <span class="stringliteral">&quot;The value of SSH above which a bad value message is \n&quot;</span>//&amp;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                 <span class="stringliteral">&quot;triggered, if CHECK_BAD_SURFACE_VALS is true.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, &amp;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                 default=20.0)</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;BAD_VAL_SSS_MAX&quot;</span>, cs%bad_val_sss_max, &amp;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                 <span class="stringliteral">&quot;The value of SSS above which a bad value message is \n&quot;</span>//&amp;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                 <span class="stringliteral">&quot;triggered, if CHECK_BAD_SURFACE_VALS is true.&quot;</span>, units=<span class="stringliteral">&quot;PPT&quot;</span>, &amp;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                 default=45.0)</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;BAD_VAL_SST_MAX&quot;</span>, cs%bad_val_sst_max, &amp;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                 <span class="stringliteral">&quot;The value of SST above which a bad value message is \n&quot;</span>//&amp;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                 <span class="stringliteral">&quot;triggered, if CHECK_BAD_SURFACE_VALS is true.&quot;</span>, &amp;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                 units=<span class="stringliteral">&quot;deg C&quot;</span>, default=45.0)</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;BAD_VAL_SST_MIN&quot;</span>, cs%bad_val_sst_min, &amp;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                 <span class="stringliteral">&quot;The value of SST below which a bad value message is \n&quot;</span>//&amp;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                 <span class="stringliteral">&quot;triggered, if CHECK_BAD_SURFACE_VALS is true.&quot;</span>, &amp;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                 units=<span class="stringliteral">&quot;deg C&quot;</span>, default=-2.1)</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;SAVE_INITIAL_CONDS&quot;</span>, save_ic, &amp;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                 <span class="stringliteral">&quot;If true, write the initial conditions to a file given \n&quot;</span>//&amp;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                 <span class="stringliteral">&quot;by IC_OUTPUT_FILE.&quot;</span>, default=.false.)</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;IC_OUTPUT_FILE&quot;</span>, cs%IC_file, &amp;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                 <span class="stringliteral">&quot;The file into which to write the initial conditions.&quot;</span>, &amp;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                 default=<span class="stringliteral">&quot;MOM_IC&quot;</span>)</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;WRITE_GEOM&quot;</span>, write_geom, &amp;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                 <span class="stringliteral">&quot;If =0, never write the geometry and vertical grid files.\n&quot;</span>//&amp;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                 <span class="stringliteral">&quot;If =1, write the geometry and vertical grid files only for\n&quot;</span>//&amp;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                 <span class="stringliteral">&quot;a new simulation. If =2, always write the geometry and\n&quot;</span>//&amp;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                 <span class="stringliteral">&quot;vertical grid files. Other values are invalid.&quot;</span>, default=1)</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordflow">if</span> (write_geom&lt;0 .or. write_geom&gt;2) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM: &quot;</span>//&amp;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;         <span class="stringliteral">&quot;WRITE_GEOM must be equal to 0, 1 or 2.&quot;</span>)</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  write_geom_files = ((write_geom==2) .or. ((write_geom==1) .and. &amp;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;     ((dirs%input_filename(1:1)==<span class="stringliteral">&#39;n&#39;</span>) .and. (len_trim(dirs%input_filename)==1))))</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="comment">! Check for inconsistent settings.</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <span class="keywordflow">if</span> (cs%adiabatic .and. cs%use_temperature) <span class="keyword">call </span>mom_error(warning, &amp;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="stringliteral">&quot;MOM: ADIABATIC and ENABLE_THERMODYNAMICS both defined is usually unwise.&quot;</span>)</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  <span class="keywordflow">if</span> (use_eos .and. .not.cs%use_temperature) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="stringliteral">&quot;MOM: ENABLE_THERMODYNAMICS must be defined to use USE_EOS.&quot;</span>)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keywordflow">if</span> (cs%adiabatic .and. cs%bulkmixedlayer) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="stringliteral">&quot;MOM: ADIABATIC and BULKMIXEDLAYER can not both be defined.&quot;</span>)</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="comment">! Allocate the auxiliary non-symmetric domain for debugging or I/O purposes.</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordflow">if</span> (cs%debug .or. g%symmetric) &amp;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keyword">call </span>clone_mom_domain(g%Domain, g%Domain_aux, symmetric=.false.)</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="keyword">call </span>mom_timing_init(cs)</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keyword">call </span>tracer_registry_init(param_file, cs%tracer_Reg)</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="comment">! Copy a common variable from the vertical grid to the horizontal grid.</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  <span class="comment">! Consider removing this later?</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  g%ke = gv%ke</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  is   = g%isc   ; ie   = g%iec  ; js   = g%jsc  ; je   = g%jec ; nz = gv%ke</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  isd  = g%isd   ; ied  = g%ied  ; jsd  = g%jsd  ; jed  = g%jed</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  isdb = g%IsdB  ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="comment">! Allocate and initialize space for primary MOM variables.</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  alloc_(cs%u(isdb:iedb,jsd:jed,nz))   ; cs%u(:,:,:) = 0.0</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  alloc_(cs%v(isd:ied,jsdb:jedb,nz))   ; cs%v(:,:,:) = 0.0</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  alloc_(cs%h(isd:ied,jsd:jed,nz))     ; cs%h(:,:,:) = gv%Angstrom</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  alloc_(cs%uh(isdb:iedb,jsd:jed,nz))  ; cs%uh(:,:,:) = 0.0</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  alloc_(cs%vh(isd:ied,jsdb:jedb,nz))  ; cs%vh(:,:,:) = 0.0</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    alloc_(cs%T(isd:ied,jsd:jed,nz))   ; cs%T(:,:,:) = 0.0</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    alloc_(cs%S(isd:ied,jsd:jed,nz))   ; cs%S(:,:,:) = 0.0</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    cs%tv%T =&gt; cs%T ; cs%tv%S =&gt; cs%S</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    cs%vd_T = var_desc(name=<span class="stringliteral">&quot;T&quot;</span>,units=<span class="stringliteral">&quot;degC&quot;</span>,longname=<span class="stringliteral">&quot;Potential Temperature&quot;</span>, &amp;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                       cmor_field_name=<span class="stringliteral">&quot;thetao&quot;</span>,cmor_units=<span class="stringliteral">&quot;C&quot;</span>,                &amp;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                       conversion=cs%tv%C_p)</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    cs%vd_S = var_desc(name=<span class="stringliteral">&quot;S&quot;</span>,units=<span class="stringliteral">&quot;PPT&quot;</span>,longname=<span class="stringliteral">&quot;Salinity&quot;</span>,&amp;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                       cmor_field_name=<span class="stringliteral">&quot;so&quot;</span>,cmor_units=<span class="stringliteral">&quot;ppt&quot;</span>,   &amp;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                       conversion=0.001)</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <span class="keyword">call </span>register_tracer(cs%tv%T, cs%vd_T, param_file, g%HI, gv, cs%tracer_Reg, cs%vd_T)</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keyword">call </span>register_tracer(cs%tv%S, cs%vd_S, param_file, g%HI, gv, cs%tracer_Reg, cs%vd_S)</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">if</span> (cs%use_frazil) <span class="keywordflow">then</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keyword">allocate</span>(cs%tv%frazil(isd:ied,jsd:jed)) ; cs%tv%frazil(:,:) = 0.0</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="keywordflow">if</span> (cs%bound_salinity) <span class="keywordflow">then</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keyword">allocate</span>(cs%tv%salt_deficit(isd:ied,jsd:jed)) ; cs%tv%salt_deficit(:,:)=0.0</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <span class="keywordflow">if</span> (cs%bulkmixedlayer) <span class="keywordflow">then</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">if</span> (.not.use_eos) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      <span class="stringliteral">&quot;initialize_MOM: A bulk mixed layer can only be used with T &amp; S as &quot;</span>//&amp;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      <span class="stringliteral">&quot;state variables. Add #define USE_EOS.&quot;</span>)</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    gv%nkml = nkml</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    gv%nk_rho_varies = nkml + nkbl</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="keyword">allocate</span>(cs%tv%Hml(isd:ied,jsd:jed)) ; cs%tv%Hml(:,:) = 0.0</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    gv%nkml = 0 ; gv%nk_rho_varies = 0</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;NK_RHO_VARIES&quot;</span>, gv%nk_rho_varies, default=0) <span class="comment">! Will default to nz later... -AJA</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  alloc_(cs%uhtr(isdb:iedb,jsd:jed,nz)) ; cs%uhtr(:,:,:) = 0.0</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  alloc_(cs%vhtr(isd:ied,jsdb:jedb,nz)) ; cs%vhtr(:,:,:) = 0.0</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  cs%dt_trans = 0.0</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordflow">if</span> (cs%debug_truncations) <span class="keywordflow">then</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keyword">allocate</span>(cs%u_prev(isdb:iedb,jsd:jed,nz)) ; cs%u_prev(:,:,:) = 0.0</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="keyword">allocate</span>(cs%v_prev(isd:ied,jsdb:jedb,nz)) ; cs%u_prev(:,:,:) = 0.0</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  mom_internal_state%u =&gt; cs%u ; mom_internal_state%v =&gt; cs%v</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  mom_internal_state%h =&gt; cs%h</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  mom_internal_state%uh =&gt; cs%uh ; mom_internal_state%vh =&gt; cs%vh</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    mom_internal_state%T =&gt; cs%T ; mom_internal_state%S =&gt; cs%S</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  cs%CDp%uh =&gt; cs%uh ; cs%CDp%vh =&gt; cs%vh</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordflow">if</span> (cs%interp_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <span class="keyword">allocate</span>(cs%p_surf_prev(isd:ied,jsd:jed)) ; cs%p_surf_prev(:,:) = 0.0</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  alloc_(cs%ave_ssh(isd:ied,jsd:jed)) ; cs%ave_ssh(:,:) = 0.0</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="comment">! Use the Wright equation of state by default, unless otherwise specified</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  <span class="comment">! Note: this line and the following block ought to be in a separate</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="comment">! initialization routine for tv.</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="keywordflow">if</span> (use_eos) <span class="keyword">call </span>eos_init(param_file,cs%tv%eqn_of_state)</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="keyword">allocate</span>(cs%tv%TempxPmE(isd:ied,jsd:jed))</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    cs%tv%TempxPmE(:,:) = 0.0</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordflow">if</span> (use_geothermal) <span class="keywordflow">then</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <span class="keyword">allocate</span>(cs%tv%internal_heat(isd:ied,jsd:jed))</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      cs%tv%internal_heat(:,:) = 0.0</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;state variables allocated (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="comment">! Set the fields that are needed for bitwise identical restarting</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="comment">! the time stepping scheme.</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="keyword">call </span>restart_init(param_file, cs%restart_CSp)</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="keyword">call </span>set_restart_fields(gv, param_file, cs)</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">if</span> (cs%split) <span class="keywordflow">then</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">if</span> (cs%legacy_split) <span class="keywordflow">then</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keyword">call </span>register_restarts_dyn_legacy_split(g%HI, gv, param_file, &amp;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;               cs%dyn_legacy_split_CSp, cs%restart_CSp, cs%uh, cs%vh)</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <span class="keyword">call </span>register_restarts_dyn_split_rk2(g%HI, gv, param_file, &amp;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;               cs%dyn_split_RK2_CSp, cs%restart_CSp, cs%uh, cs%vh)</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">if</span> (cs%use_RK2) <span class="keywordflow">then</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <span class="keyword">call </span>register_restarts_dyn_unsplit_rk2(g%HI, gv, param_file, &amp;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;             cs%dyn_unsplit_RK2_CSp, cs%restart_CSp)</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keyword">call </span>register_restarts_dyn_unsplit(g%HI, gv, param_file, &amp;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;             cs%dyn_unsplit_CSp, cs%restart_CSp)</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">! This subroutine calls user-specified tracer registration routines.</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="comment">! Additional calls can be added to MOM_tracer_flow_control.F90.</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keyword">call </span>call_tracer_register(g%HI, gv, param_file, cs%tracer_flow_CSp, &amp;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                            cs%tracer_Reg, cs%restart_CSp)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keyword">call </span>meke_alloc_register_restart(g%HI, param_file, cs%MEKE, cs%restart_CSp)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keyword">call </span>set_visc_register_restarts(g%HI, gv, param_file, cs%visc, cs%restart_CSp)</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keyword">call </span>mixedlayer_restrat_register_restarts(g%HI, param_file, cs%mixedlayer_restrat_CSp, cs%restart_CSp)</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="comment">! Initialize fields</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;restart registration complete (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_mom_init)</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <span class="keyword">call </span>mom_initialize_fixed(g, param_file, write_geom_files, dirs%output_directory)</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;returned from MOM_initialize_fixed() (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keyword">call </span>mom_initialize_coord(gv, param_file, write_geom_files, &amp;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                            dirs%output_directory, cs%tv, g%max_depth)</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;returned from MOM_initialize_coord() (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keyword">call </span>ale_init(param_file, gv, g%max_depth, cs%ALE_CSp)</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;returned from ALE_init() (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="keyword">call </span>mom_initialize_state(cs%u, cs%v, cs%h, cs%tv, time, g, gv, param_file, &amp;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                            dirs, cs%restart_CSp, cs%ALE_CSp, cs%tracer_Reg, &amp;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                            cs%sponge_CSp, cs%ALE_sponge_CSp, cs%OBC, time_in)</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_mom_init)</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;returned from MOM_initialize_state() (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  <span class="comment">! From this point, there may be pointers being set, so the final grid type</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <span class="comment">! that will persist through the run has to be used.</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160; </div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="comment">!   Shift from using the temporary dynamic grid type to using the final (potentially</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="comment">! static) ocean grid type.</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="comment">! call clone_MOM_domain(dG%Domain, CS%G%Domain)</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="comment">! call MOM_grid_init(CS%G, param_file)</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="comment">! call copy_dyngrid_to_MOM_grid(dg, CS%G)</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="comment">! Allocate the auxiliary non-symmetric domain for debugging or I/O purposes.</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="comment">! if (CS%debug .or. CS%G%symmetric) &amp;</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="comment">!  call clone_MOM_domain(CS%G%Domain, CS%G%Domain_aux, symmetric=.false.)</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="comment">! ! Copy a common variable from the vertical grid to the horizontal grid.</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="comment">! ! Consider removing this later?</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="comment">! CS%G%ke = GV%ke</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="comment">! G =&gt; CS%G</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">if</span> (test_grid_copy) <span class="keywordflow">then</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="comment">!  Copy the data from the temporary grid to the dyn_hor_grid to CS%G.</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keyword">call </span>create_dyn_horgrid(dg, g%HI)</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keyword">call </span>clone_mom_domain(g%Domain, dg%Domain)</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keyword">call </span>clone_mom_domain(g%Domain, cs%G%Domain)</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keyword">call </span>mom_grid_init(cs%G, param_file)</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keyword">call </span>copy_mom_grid_to_dyngrid(g, dg)</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keyword">call </span>copy_dyngrid_to_mom_grid(dg, cs%G)</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="comment">! Copy a common variable from the vertical grid to the horizontal grid.</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="comment">! Consider removing this later?</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    cs%G%ke = gv%ke</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keyword">call </span>destroy_dyn_horgrid(dg)</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keyword">call </span>mom_grid_end(g) ; <span class="keyword">deallocate</span>(g)</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    g =&gt; cs%G</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keywordflow">if</span> (cs%debug .or. cs%G%symmetric) &amp;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keyword">call </span>clone_mom_domain(cs%G%Domain, cs%G%Domain_aux, symmetric=.false.)</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="comment">! At this point, all user-modified initialization code has been called.  The</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="comment">! remainder of this subroutine is controlled by the parameters that have</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <span class="comment">! have already been set.</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass_init)</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="comment">!--- set up group pass for u,v,T,S and h. pass_uv_T_S_h also is used in step_MOM</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_uv_T_S_h, cs%u, cs%v, g%Domain)</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_uv_T_S_h, cs%tv%T, g%Domain)</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_uv_T_S_h, cs%tv%S, g%Domain)</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_uv_T_S_h, cs%h, g%Domain)</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass_init)</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordflow">if</span> (ale_remap_init_conds(cs%ALE_CSp) .and. .not. query_initialized(cs%h,<span class="stringliteral">&quot;h&quot;</span>,cs%restart_CSp)) <span class="keywordflow">then</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="comment">! This block is controlled by the ALE parameter REMAP_AFTER_INITIALIZATION.</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="comment">! \todo This block exists for legacy reasons and we should phase it out of</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="comment">! all examples.</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <span class="keyword">call </span>uchksum(cs%u,<span class="stringliteral">&quot;Pre ALE adjust init cond u&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="keyword">call </span>vchksum(cs%v,<span class="stringliteral">&quot;Pre ALE adjust init cond v&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keyword">call </span>hchksum(cs%h*gv%H_to_m,<span class="stringliteral">&quot;Pre ALE adjust init cond h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;Calling adjustGridForIntegrity() to remap initial conditions (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="keyword">call </span>adjustgridforintegrity(cs%ALE_CSp, g, gv, cs%h )</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;Calling ALE_main() to remap initial conditions (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keyword">call </span>ale_main( g, gv, cs%h, cs%u, cs%v, cs%tv, cs%tracer_Reg, cs%ALE_CSp )</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass_init)</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_uv_T_S_h, g%Domain)</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass_init)</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keyword">call </span>uchksum(cs%u,<span class="stringliteral">&quot;Post ALE adjust init cond u&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="keyword">call </span>vchksum(cs%v,<span class="stringliteral">&quot;Post ALE adjust init cond v&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="keyword">call </span>hchksum(cs%h*gv%H_to_m, <span class="stringliteral">&quot;Post ALE adjust init cond h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  <span class="keywordflow">if</span> ( cs%use_ALE_algorithm ) <span class="keyword">call </span>ale_updateverticalgridtype( cs%ALE_CSp, gv )</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;   diag    =&gt; cs%diag</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="comment">! Initialize the diag mediator.</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keyword">call </span>diag_mediator_init(g, param_file, diag, doc_file_dir=dirs%output_directory)</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="comment">! Initialize the diagnostics mask arrays.</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  <span class="comment">! This step has to be done after call to MOM_initialize_state</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="comment">! and before MOM_diagnostics_init</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keyword">call </span>diag_masks_set(g, cs%missing, diag)</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  <span class="comment">! Set up a pointers h within diag mediator control structure,</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  <span class="comment">! this needs to occur _after_ CS%h has been allocated.</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="keyword">call </span>diag_set_thickness_ptr(cs%h, diag)</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;  <span class="comment">! This call sets up the diagnostic axes. These are needed,</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;  <span class="comment">! e.g. to generate the target grids below.</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  <span class="keyword">call </span>set_axes_info(g, gv, param_file, diag)</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="comment">! Whenever thickness changes let the diag manager know, target grids</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="comment">! for vertical remapping may need to be regenerated. This needs to</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <span class="keyword">call </span>diag_update_target_grids(diag)</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_mom_init)</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keyword">call </span>ale_writecoordinatefile( cs%ALE_CSp, gv, dirs%output_directory )</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_mom_init)</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;ALE initialized (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  cs%useMEKE = meke_init(time, g, param_file, diag, cs%MEKE_CSp, cs%MEKE, cs%restart_CSp)</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="keyword">call </span>wave_speed_init(time, g, param_file, diag, cs%wave_speed_CSp)</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  <span class="keyword">call </span>varmix_init(time, g, param_file, diag, cs%VarMix, cs%wave_speed_CSp)</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keyword">call </span>set_visc_init(time, g, gv, param_file, diag, cs%visc, cs%set_visc_CSp)</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="keywordflow">if</span> (cs%split) <span class="keywordflow">then</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keyword">allocate</span>(eta(szi_(g),szj_(g))) ; eta(:,:) = 0.0</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span> (cs%legacy_split) <span class="keywordflow">then</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keyword">call </span>initialize_dyn_legacy_split(cs%u, cs%v, cs%h, cs%uh, cs%vh, eta, time, &amp;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                  g, gv, param_file, diag, cs%dyn_legacy_split_CSp, cs%restart_CSp, &amp;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                  cs%dt, cs%ADp, cs%CDp, mom_internal_state, cs%VarMix, cs%MEKE,  &amp;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                  cs%OBC, cs%ALE_CSp, cs%set_visc_CSp, cs%visc, dirs, cs%ntrunc)</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="keyword">call </span>initialize_dyn_split_rk2(cs%u, cs%v, cs%h, cs%uh, cs%vh, eta, time,   &amp;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                  g, gv, param_file, diag, cs%dyn_split_RK2_CSp, cs%restart_CSp, &amp;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                  cs%dt, cs%ADp, cs%CDp, mom_internal_state, cs%VarMix, cs%MEKE, &amp;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                  cs%OBC, cs%ALE_CSp, cs%set_visc_CSp, cs%visc, dirs, cs%ntrunc)</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">if</span> (cs%use_RK2) <span class="keywordflow">then</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keyword">call </span>initialize_dyn_unsplit_rk2(cs%u, cs%v, cs%h, time, g, gv,       &amp;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;              param_file, diag, cs%dyn_unsplit_RK2_CSp, cs%restart_CSp,    &amp;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;              cs%ADp, cs%CDp, mom_internal_state, cs%OBC, cs%ALE_CSp, &amp;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;              cs%set_visc_CSp, cs%visc, dirs, cs%ntrunc)</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="keyword">call </span>initialize_dyn_unsplit(cs%u, cs%v, cs%h, time, g, gv,           &amp;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;              param_file, diag, cs%dyn_unsplit_CSp, cs%restart_CSp,        &amp;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;              cs%ADp, cs%CDp, mom_internal_state, cs%OBC, cs%ALE_CSp, &amp;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;              cs%set_visc_CSp, cs%visc, dirs, cs%ntrunc)</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;dynamics initialized (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="keyword">call </span>thickness_diffuse_init(time, g, gv, param_file, diag, cs%CDp, cs%thickness_diffuse_CSp)</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  cs%mixedlayer_restrat = mixedlayer_restrat_init(time, g, gv, param_file, diag, &amp;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                                                  cs%mixedlayer_restrat_CSp)</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  <span class="keywordflow">if</span> (cs%mixedlayer_restrat) <span class="keywordflow">then</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordflow">if</span> (.not.(cs%bulkmixedlayer .or. cs%use_ALE_algorithm)) &amp;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM: MIXEDLAYER_RESTRAT true requires a boundary layer scheme.&quot;</span>)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="comment">! When DIABATIC_FIRST=False and using CS%visc%ML in mixedlayer_restrat we need to update after a restart</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="keywordflow">if</span> (.not. cs%diabatic_first .and. <span class="keyword">associated</span>(cs%visc%MLD)) <span class="keyword">call </span>pass_var(cs%visc%MLD, g%domain)</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keyword">call </span>mom_diagnostics_init(mom_internal_state, cs%ADp, cs%CDp, time, g, gv, &amp;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;              param_file, diag, cs%diagnostics_CSp, cs%wave_speed_CSp)</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  cs%Z_diag_interval = set_time(int((cs%dt_therm) * &amp;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;       max(1,floor(0.01 + z_diag_int/(cs%dt_therm)))))</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="keyword">call </span>mom_diag_to_z_init(time, g, gv, param_file, diag, cs%diag_to_Z_CSp)</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  cs%Z_diag_time = start_time + cs%Z_diag_interval * (1 + &amp;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    ((time + set_time(int(cs%dt_therm))) - start_time) / cs%Z_diag_interval)</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%sponge_CSp)) &amp;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keyword">call </span>init_sponge_diags(time, g, diag, cs%sponge_CSp)</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%ALE_sponge_CSp)) &amp;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keyword">call </span>init_ale_sponge_diags(time, g, diag, cs%ALE_sponge_CSp)</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  <span class="keywordflow">if</span> (cs%adiabatic) <span class="keywordflow">then</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <span class="keyword">call </span>adiabatic_driver_init(time, g, param_file, diag, cs%diabatic_CSp, &amp;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                               cs%tracer_flow_CSp, cs%diag_to_Z_CSp)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keyword">call </span>diabatic_driver_init(time, g, gv, param_file, cs%use_ALE_algorithm, diag,     &amp;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                              cs%ADp, cs%CDp, cs%diabatic_CSp, cs%tracer_flow_CSp, &amp;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                              cs%sponge_CSp, cs%ALE_sponge_CSp, cs%diag_to_Z_CSp)</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="keyword">call </span>tracer_advect_init(time, g, param_file, diag, cs%tracer_adv_CSp)</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <span class="keyword">call </span>tracer_hor_diff_init(time, g, param_file, diag, cs%tracer_diff_CSp, cs%neutral_diffusion_CSp)</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) &amp;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <span class="keyword">call </span>register_diags_ts_vardec(time, g%HI, gv, param_file, cs)</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  <span class="keyword">call </span>lock_tracer_registry(cs%tracer_Reg)</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;tracer registry now locked (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <span class="comment">! now register some diagnostics since tracer registry is locked</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  <span class="keyword">call </span>register_diags(time, g, gv, cs, cs%ADp)</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="keyword">call </span>register_diags_ts_tendency(time, g, cs)</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keyword">call </span>ale_register_diags(time, g, diag, cs%tv%C_p, cs%tracer_Reg, cs%ALE_CSp)</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="comment">! If need a diagnostic field, then would have been allocated in register_diags.</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keyword">call </span>add_tracer_diagnostics(<span class="stringliteral">&quot;T&quot;</span>, cs%tracer_Reg, cs%T_adx, cs%T_ady, &amp;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                      cs%T_diffx, cs%T_diffy, cs%T_adx_2d, cs%T_ady_2d, &amp;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                      cs%T_diffx_2d, cs%T_diffy_2d, cs%T_advection_xy)</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    <span class="keyword">call </span>add_tracer_diagnostics(<span class="stringliteral">&quot;S&quot;</span>, cs%tracer_Reg, cs%S_adx, cs%S_ady, &amp;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                      cs%S_diffx, cs%S_diffy, cs%S_adx_2d, cs%S_ady_2d, &amp;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                      cs%S_diffx_2d, cs%S_diffy_2d, cs%S_advection_xy)</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keyword">call </span>register_z_tracer(cs%tv%T, <span class="stringliteral">&quot;temp&quot;</span>, <span class="stringliteral">&quot;Potential Temperature&quot;</span>, <span class="stringliteral">&quot;degC&quot;</span>, time,   &amp;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                      g, cs%diag_to_Z_CSp, cmor_field_name=<span class="stringliteral">&quot;thetao&quot;</span>, cmor_units=<span class="stringliteral">&quot;C&quot;</span>, &amp;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                      cmor_standard_name=<span class="stringliteral">&quot;sea_water_potential_temperature&quot;</span>,          &amp;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                      cmor_long_name =<span class="stringliteral">&quot;Sea Water Potential Temperature&quot;</span>)</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keyword">call </span>register_z_tracer(cs%tv%S, <span class="stringliteral">&quot;salt&quot;</span>, <span class="stringliteral">&quot;Salinity&quot;</span>, <span class="stringliteral">&quot;PPT&quot;</span>, time,               &amp;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                      g, cs%diag_to_Z_CSp, cmor_field_name=<span class="stringliteral">&quot;so&quot;</span>, cmor_units=<span class="stringliteral">&quot;ppt&quot;</span>, &amp;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                      cmor_standard_name=<span class="stringliteral">&quot;sea_water_salinity&quot;</span>,                     &amp;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                      cmor_long_name =<span class="stringliteral">&quot;Sea Water Salinity&quot;</span>)</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <span class="comment">! This subroutine initializes any tracer packages.</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  new_sim = ((dirs%input_filename(1:1) == <span class="stringliteral">&#39;n&#39;</span>) .and. &amp;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;             (len_trim(dirs%input_filename) == 1))</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  <span class="keyword">call </span>tracer_flow_control_init(.not.new_sim, time, g, gv, cs%h, param_file, &amp;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;             cs%diag, cs%OBC, cs%tracer_flow_CSp, cs%sponge_CSp, &amp;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;             cs%ALE_sponge_CSp, cs%diag_to_Z_CSp)</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass_init)</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  <span class="keyword">call </span>do_group_pass(cs%pass_uv_T_S_h, g%Domain)</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass_init)</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <span class="keyword">call </span>register_obsolete_diagnostics(param_file, cs%diag)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <span class="keyword">call </span>neutral_diffusion_diag_init(time, g, diag, cs%tv%C_p, cs%tracer_Reg, cs%neutral_diffusion_CSp)</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <span class="keyword">call </span>write_static_fields(g, cs%diag)</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;static fields written (initialize_MOM)&quot;</span>)</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="keywordflow">if</span> (cs%use_frazil) <span class="keywordflow">then</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="keywordflow">if</span> (.not.query_initialized(cs%tv%frazil,<span class="stringliteral">&quot;frazil&quot;</span>,cs%restart_CSp)) &amp;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      cs%tv%frazil(:,:) = 0.0</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordflow">if</span> (cs%interp_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    cs%p_surf_prev_set = &amp;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      query_initialized(cs%p_surf_prev,<span class="stringliteral">&quot;p_surf_prev&quot;</span>,cs%restart_CSp)</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">if</span> (cs%p_surf_prev_set) <span class="keyword">call </span>pass_var(cs%p_surf_prev, g%domain)</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  <span class="keywordflow">if</span> (.not.query_initialized(cs%ave_ssh,<span class="stringliteral">&quot;ave_ssh&quot;</span>,cs%restart_CSp)) <span class="keywordflow">then</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">if</span> (cs%split) <span class="keywordflow">then</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      <span class="keyword">call </span>find_eta(cs%h, cs%tv, g%g_Earth, g, gv, cs%ave_ssh, eta)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      <span class="keyword">call </span>find_eta(cs%h, cs%tv, g%g_Earth, g, gv, cs%ave_ssh)</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordflow">if</span> (cs%split) <span class="keyword">deallocate</span>(eta)</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="comment">! Flag whether to save initial conditions in finish_MOM_initialization() or not.</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  cs%write_IC = save_ic .and. &amp;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                .not.((dirs%input_filename(1:1) == <span class="stringliteral">&#39;r&#39;</span>) .and. &amp;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                      (len_trim(dirs%input_filename) == 1))</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  <span class="comment">! Undocumented parameter: set DO_UNIT_TESTS=True to invoke unitTests s/r</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="comment">! which calls unit tests provided by some modules.</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;DO_UNIT_TESTS&quot;</span>, do_unit_tests, default=.false.)</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <span class="keywordflow">if</span> (do_unit_tests) <span class="keyword">call </span>unittests</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;initialize_MOM()&quot;</span>)</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_init)</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_afebdc0103ad9cbe0ed4a54e522dc4104_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_afebdc0103ad9cbe0ed4a54e522dc4104_icgraph.svg" width="252" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae6dad976fb4be1c7ba7fc1aff809616b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom::mom_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>End of model. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>MOM control structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l03055">3055</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../de/dbc/MOM__driver_8F90_source.html#l00001">mom_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">pointer</span> :: cs<span class="comment">   !&lt; MOM control structure</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <span class="keywordflow">if</span> (cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    <span class="keyword">call </span>ale_end(cs%ALE_CSp)</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  dealloc_(cs%u) ; dealloc_(cs%v) ; dealloc_(cs%h)</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;  dealloc_(cs%uh) ; dealloc_(cs%vh)</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;    dealloc_(cs%T) ; cs%tv%T =&gt; null() ; dealloc_(cs%S) ; cs%tv%S =&gt; null()</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%frazil)) <span class="keyword">deallocate</span>(cs%tv%frazil)</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%salt_deficit)) <span class="keyword">deallocate</span>(cs%tv%salt_deficit)</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%Hml)) <span class="keyword">deallocate</span>(cs%tv%Hml)</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;  <span class="keyword">call </span>tracer_advect_end(cs%tracer_adv_CSp)</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  <span class="keyword">call </span>tracer_hor_diff_end(cs%tracer_diff_CSp)</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;  <span class="keyword">call </span>tracer_registry_end(cs%tracer_Reg)</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;  dealloc_(cs%uhtr) ; dealloc_(cs%vhtr)</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;  <span class="keywordflow">if</span> (cs%split) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (cs%legacy_split) <span class="keywordflow">then</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      <span class="keyword">call </span>end_dyn_legacy_split(cs%dyn_legacy_split_CSp)</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      <span class="keyword">call </span>end_dyn_split_rk2(cs%dyn_split_RK2_CSp)</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="keywordflow">  endif</span> ; <span class="keywordflow">else</span> ; <span class="keywordflow">if</span> (cs%use_RK2) <span class="keywordflow">then</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      <span class="keyword">call </span>end_dyn_unsplit_rk2(cs%dyn_unsplit_RK2_CSp)</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="keyword">call </span>end_dyn_unsplit(cs%dyn_unsplit_CSp)</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="keywordflow">  endif</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;  dealloc_(cs%ave_ssh)</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  <span class="keyword">call </span>verticalgridend(cs%GV)</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  <span class="keyword">call </span>mom_grid_end(cs%G)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;  <span class="keyword">deallocate</span>(cs)</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_ae6dad976fb4be1c7ba7fc1aff809616b_icgraph.svg" width="234" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab57e47834591c651339770f7e51efe57"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::mom_timing_init </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine sets up clock IDs for timing various subroutines. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>control structure set up by initialize_MOM. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">2481</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00399">id_clock_ale</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00390">id_clock_continuity</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00389">id_clock_diabatic</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00393">id_clock_diagnostics</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00386">id_clock_dynamics</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00392">id_clock_ml_restrat</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00396">id_clock_mom_init</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00385">id_clock_ocean</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00400">id_clock_other</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00397">id_clock_pass</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00398">id_clock_pass_init</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00387">id_clock_thermo</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00391">id_clock_thick_diff</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00388">id_clock_tracer</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00394">id_clock_z_diag</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">intent(in)</span> :: cs<span class="comment">  !&lt; control structure set up by initialize_MOM.</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160; id_clock_ocean    = cpu_clock_id(<span class="stringliteral">&#39;Ocean&#39;</span>, grain=clock_component)</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160; id_clock_dynamics = cpu_clock_id(<span class="stringliteral">&#39;Ocean dynamics&#39;</span>, grain=clock_subcomponent)</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160; id_clock_thermo   = cpu_clock_id(<span class="stringliteral">&#39;Ocean thermodynamics and tracers&#39;</span>, grain=clock_subcomponent)</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160; id_clock_other    = cpu_clock_id(<span class="stringliteral">&#39;Ocean Other&#39;</span>, grain=clock_subcomponent)</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160; id_clock_tracer   = cpu_clock_id(<span class="stringliteral">&#39;(Ocean tracer advection)&#39;</span>, grain=clock_module_driver)</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160; <span class="keywordflow">if</span> (.not.cs%adiabatic) &amp;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;   id_clock_diabatic = cpu_clock_id(<span class="stringliteral">&#39;(Ocean diabatic driver)&#39;</span>, grain=clock_module_driver)</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160; id_clock_continuity = cpu_clock_id(<span class="stringliteral">&#39;(Ocean continuity equation *)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160; id_clock_pass       = cpu_clock_id(<span class="stringliteral">&#39;(Ocean message passing *)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160; id_clock_mom_init   = cpu_clock_id(<span class="stringliteral">&#39;(Ocean MOM_initialize_state)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160; id_clock_pass_init  = cpu_clock_id(<span class="stringliteral">&#39;(Ocean init message passing *)&#39;</span>, grain=clock_routine)</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160; <span class="keywordflow">if</span> (cs%thickness_diffuse) &amp;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;   id_clock_thick_diff = cpu_clock_id(<span class="stringliteral">&#39;(Ocean thickness diffusion *)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="comment">!if (CS%mixedlayer_restrat) &amp;</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;   id_clock_ml_restrat = cpu_clock_id(<span class="stringliteral">&#39;(Ocean mixed layer restrat)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160; id_clock_diagnostics  = cpu_clock_id(<span class="stringliteral">&#39;(Ocean collective diagnostics)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160; id_clock_z_diag       = cpu_clock_id(<span class="stringliteral">&#39;(Ocean Z-space diagnostics)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160; id_clock_ale          = cpu_clock_id(<span class="stringliteral">&#39;(Ocean ALE)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_ab57e47834591c651339770f7e51efe57_icgraph.svg" width="430" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a160d32130791ebf4147e5e9d60b242bc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::post_diags_ts_tendency </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Post diagnostics for temp/heat and saln/salt tendencies. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>total time step for T,S update </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02508">2508</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),    <span class="keywordtype">intent(in)</span>    :: g<span class="comment">   !&lt; ocean grid structure</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),  <span class="keywordtype">intent(inout)</span> :: gv<span class="comment">  !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment">  !&lt; control structure</span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;  <span class="keywordtype">real</span>                    , <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">  !&lt; total time step for T,S update</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <span class="keywordtype">real</span>    :: work3d(szi_(g),szj_(g),szk_(g))</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="keywordtype">real</span>    :: work2d(szi_(g),szj_(g))</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <span class="keywordtype">real</span>    :: idt, ppt2mks</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <span class="keywordflow">if</span>(.not. cs%tendency_diagnostics) <span class="keywordflow">return</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;  idt = 0.; <span class="keywordflow">if</span> (dt/=0.) idt = 1.0 / dt <span class="comment">! The &quot;if&quot; is in case the diagnostic is called for a zero length interval</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  ppt2mks       = 0.001</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  work3d(:,:,:) = 0.0</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  work2d(:,:)   = 0.0</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  <span class="comment">! Diagnose tendency of heat from convergence of lateral advective,</span></div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  <span class="comment">! fluxes, where advective transport arises from residual mean velocity.</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;  <span class="keywordflow">if</span> (cs%id_T_advection_xy &gt; 0 .or. cs%id_T_advection_xy_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      work3d(i,j,k) = cs%T_advection_xy(i,j,k) * gv%H_to_kg_m2 * cs%tv%C_p</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="keywordflow">if</span> (cs%id_T_advection_xy    &gt; 0) <span class="keyword">call </span>post_data(cs%id_T_advection_xy, work3d, cs%diag)</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    <span class="keywordflow">if</span> (cs%id_T_advection_xy_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        work2d(i,j) = 0.0</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;          work2d(i,j) = work2d(i,j) + work3d(i,j,k)</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      <span class="keyword">call </span>post_data(cs%id_T_advection_xy_2d, work2d, cs%diag)</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  <span class="comment">! Diagnose tendency of salt from convergence of lateral advective</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  <span class="comment">! fluxes, where advective transport arises from residual mean velocity.</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  <span class="keywordflow">if</span> (cs%id_S_advection_xy &gt; 0 .or. cs%id_S_advection_xy_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      work3d(i,j,k) = cs%S_advection_xy(i,j,k) * gv%H_to_kg_m2 * ppt2mks</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="keywordflow">if</span> (cs%id_S_advection_xy    &gt; 0) <span class="keyword">call </span>post_data(cs%id_S_advection_xy, work3d, cs%diag)</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    <span class="keywordflow">if</span> (cs%id_S_advection_xy_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        work2d(i,j) = 0.0</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;          work2d(i,j) = work2d(i,j) + work3d(i,j,k)</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <span class="keyword">call </span>post_data(cs%id_S_advection_xy_2d, work2d, cs%diag)</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  <span class="comment">! diagnose net tendency for temperature over a time step and update T_prev</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <span class="keywordflow">if</span> (cs%id_T_tendency &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      work3d(i,j,k)    = (cs%tv%T(i,j,k) - cs%T_prev(i,j,k))*idt</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      cs%T_prev(i,j,k) =  cs%tv%T(i,j,k)</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    <span class="keyword">call </span>post_data(cs%id_T_tendency, work3d, cs%diag)</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="comment">! diagnose net tendency for salinity over a time step and update S_prev</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="keywordflow">if</span> (cs%id_S_tendency &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      work3d(i,j,k)    = (cs%tv%S(i,j,k) - cs%S_prev(i,j,k))*idt</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      cs%S_prev(i,j,k) =  cs%tv%S(i,j,k)</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    <span class="keyword">call </span>post_data(cs%id_S_tendency, work3d, cs%diag)</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="comment">! diagnose net tendency for heat content of a grid cell over a time step and update Th_prev</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <span class="keywordflow">if</span> (cs%id_Th_tendency &gt; 0 .or. cs%id_Th_tendency_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      work3d(i,j,k)     = (cs%tv%T(i,j,k)*cs%h(i,j,k) - cs%Th_prev(i,j,k)) * idt * gv%H_to_kg_m2 * cs%tv%C_p</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      cs%Th_prev(i,j,k) =  cs%tv%T(i,j,k)*cs%h(i,j,k)</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="keywordflow">if</span> (cs%id_Th_tendency    &gt; 0) <span class="keyword">call </span>post_data(cs%id_Th_tendency, work3d, cs%diag)</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">if</span> (cs%id_Th_tendency_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        work2d(i,j) = 0.0</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;          work2d(i,j) = work2d(i,j) + work3d(i,j,k)</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;      <span class="keyword">call </span>post_data(cs%id_Th_tendency_2d, work2d, cs%diag)</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  <span class="comment">! diagnose net tendency for salt content of a grid cell over a time step and update Sh_prev</span></div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sh_tendency &gt; 0 .or. cs%id_Sh_tendency_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;      work3d(i,j,k)     = (cs%tv%S(i,j,k)*cs%h(i,j,k) - cs%Sh_prev(i,j,k)) * idt * gv%H_to_kg_m2 * ppt2mks</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;      cs%Sh_prev(i,j,k) =  cs%tv%S(i,j,k)*cs%h(i,j,k)</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="keywordflow">if</span> (cs%id_Sh_tendency    &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sh_tendency, work3d, cs%diag)</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="keywordflow">if</span> (cs%id_Sh_tendency_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        work2d(i,j) = 0.0</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;          work2d(i,j) = work2d(i,j) + work3d(i,j,k)</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <span class="keyword">call </span>post_data(cs%id_Sh_tendency_2d, work2d, cs%diag)</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a160d32130791ebf4147e5e9d60b242bc_icgraph.svg" width="402" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ade4c1552728b358f6ce4114943079214"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::post_diags_ts_vardec </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate and post variance decay diagnostics for temp/salt. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>total time step </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02622">2622</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(in)</span> :: g<span class="comment">        !&lt; ocean grid structure</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; control structure</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">intent(in)</span> :: dt<span class="comment">                        !&lt; total time step</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  <span class="keywordtype">real</span> :: work(szi_(g),szj_(g),szk_(g))</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  <span class="keywordtype">real</span> :: idt</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  idt = 0.; <span class="keywordflow">if</span> (dt/=0.) idt = 1.0 / dt <span class="comment">! The &quot;if&quot; is in case the diagnostic is called for a zero length interval</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="keywordflow">if</span> (cs%id_T_vardec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    work(:,:,:) = (cs%T_squared(:,:,:) - cs%tv%T(:,:,:) ** 2) * idt</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    <span class="keyword">call </span>post_data(cs%id_T_vardec, work, cs%diag)</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <span class="keywordflow">if</span> (cs%id_S_vardec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    work(:,:,:) = (cs%S_squared(:,:,:) - cs%tv%S(:,:,:) ** 2) * idt</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="keyword">call </span>post_data(cs%id_S_vardec, work, cs%diag)</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="keywordflow">  endif</span></div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_ade4c1552728b358f6ce4114943079214_icgraph.svg" width="402" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a353e4f34478972f6c4115a9446e04c09"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::register_diags </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(accel_diag_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>ADp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register the diagnostics. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>current model time</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>ocean grid structu</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>control structure set up by initialize_MOM</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">adp</td><td>structure pointing to accelerations in momentum equation </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02134">2134</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00186">mom_verticalgrid::get_flux_units()</a>, <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00168">mom_verticalgrid::get_thickness_units()</a>, and <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00204">mom_verticalgrid::get_tr_flux_units()</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="keywordtype">type</span>(time_type),           <span class="keywordtype">intent(in)</span>    :: time<span class="comment">  !&lt; current model time</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),     <span class="keywordtype">intent(inout)</span> :: g<span class="comment">     !&lt; ocean grid structu</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),   <span class="keywordtype">intent(inout)</span> :: gv<span class="comment">    !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct),  <span class="keywordtype">pointer</span>       :: cs<span class="comment">    !&lt; control structure set up by initialize_MOM</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;  <span class="keywordtype">type</span>(accel_diag_ptrs),     <span class="keywordtype">intent(inout)</span> :: adp<span class="comment">   !&lt; structure pointing to accelerations in momentum equation</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  <span class="keywordtype">character(len=48)</span> :: thickness_units, flux_units, t_flux_units, s_flux_units</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">pointer</span> :: diag</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, isdb, iedb, jsdb, jedb, nz</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  isd  = g%isd  ; ied  = g%ied  ; jsd  = g%jsd  ; jed  = g%jed ; nz = g%ke</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  diag =&gt; cs%diag</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  thickness_units = get_thickness_units(gv)</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  flux_units      = get_flux_units(gv)</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  t_flux_units    = get_tr_flux_units(gv, <span class="stringliteral">&quot;Celsius&quot;</span>)</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  s_flux_units    = get_tr_flux_units(gv, <span class="stringliteral">&quot;PPT&quot;</span>)</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="comment">!Initialize the diagnostics mask arrays.</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="comment">!This has to be done after MOM_initialize_state call.</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="comment">!call diag_masks_set(G, CS%missing)</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  cs%id_u = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;u&#39;</span>, diag%axesCuL, time,              &amp;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      <span class="stringliteral">&#39;Zonal velocity&#39;</span>, <span class="stringliteral">&#39;meter  second-1&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;uo&#39;</span>, cmor_units=<span class="stringliteral">&#39;m s-1&#39;</span>, &amp;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;sea_water_x_velocity&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Sea Water X Velocity&#39;</span>)</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  cs%id_v = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;v&#39;</span>, diag%axesCvL, time,                  &amp;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="stringliteral">&#39;Meridional velocity&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;vo&#39;</span>, cmor_units=<span class="stringliteral">&#39;m s-1&#39;</span>, &amp;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;sea_water_y_velocity&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Sea Water Y Velocity&#39;</span>)</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  cs%id_h = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;h&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="stringliteral">&#39;Layer Thickness&#39;</span>, thickness_units, v_cell_method=<span class="stringliteral">&#39;sum&#39;</span>)</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  cs%id_volo = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;volo&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      long_name=<span class="stringliteral">&#39;Total volume of liquid ocean&#39;</span>, units=<span class="stringliteral">&#39;m3&#39;</span>,            &amp;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      standard_name=<span class="stringliteral">&#39;sea_water_volume&#39;</span>)</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;  cs%id_zos = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;zos&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      standard_name = <span class="stringliteral">&#39;sea_surface_height_above_geoid&#39;</span>,                   &amp;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      long_name= <span class="stringliteral">&#39;Sea surface height above geoid&#39;</span>, units=<span class="stringliteral">&#39;meter&#39;</span>, missing_value=cs%missing)</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  cs%id_zossq = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;zossq&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      standard_name=<span class="stringliteral">&#39;square_of_sea_surface_height_above_geoid&#39;</span>,             &amp;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      long_name=<span class="stringliteral">&#39;Square of sea surface height above geoid&#39;</span>, units=<span class="stringliteral">&#39;m2&#39;</span>, missing_value=cs%missing)</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  cs%id_ssh = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SSH&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="stringliteral">&#39;Sea Surface Height&#39;</span>, <span class="stringliteral">&#39;meter&#39;</span>, cs%missing)</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  cs%id_ssh_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;ssh_ga&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged sea surface height&#39;</span>, units=<span class="stringliteral">&#39;m&#39;</span>,            &amp;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      standard_name=<span class="stringliteral">&#39;area_averaged_sea_surface_height&#39;</span>)</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  cs%id_ssh_inst = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SSH_inst&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="stringliteral">&#39;Instantaneous Sea Surface Height&#39;</span>, <span class="stringliteral">&#39;meter&#39;</span>, cs%missing)</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  cs%id_ssu = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SSU&#39;</span>, diag%axesCu1, time, &amp;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      <span class="stringliteral">&#39;Sea Surface Zonal Velocity&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>, cs%missing)</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  cs%id_ssv = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SSV&#39;</span>, diag%axesCv1, time, &amp;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="stringliteral">&#39;Sea Surface Meridional Velocity&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>, cs%missing)</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  cs%id_speed = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;speed&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      <span class="stringliteral">&#39;Sea Surface Speed&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>, cs%missing)</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    cs%id_T = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;temp&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="stringliteral">&#39;Potential Temperature&#39;</span>, <span class="stringliteral">&#39;Celsius&#39;</span>,                                 &amp;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;         cmor_field_name=<span class="stringliteral">&quot;thetao&quot;</span>, cmor_units=<span class="stringliteral">&quot;C&quot;</span>,                          &amp;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;         cmor_standard_name=<span class="stringliteral">&quot;sea_water_potential_temperature&quot;</span>,              &amp;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;         cmor_long_name =<span class="stringliteral">&quot;Sea Water Potential Temperature&quot;</span>)</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    cs%id_S = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;salt&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        long_name=<span class="stringliteral">&#39;Salinity&#39;</span>, units=<span class="stringliteral">&#39;PPT&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;so&#39;</span>,            &amp;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Sea Water Salinity&#39;</span>, cmor_units=<span class="stringliteral">&#39;ppt&#39;</span>,              &amp;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;sea_water_salinity&#39;</span>)</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    cs%id_tob = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,<span class="stringliteral">&#39;tob&#39;</span>, diag%axesT1, time,          &amp;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        long_name=<span class="stringliteral">&#39;Sea Water Potential Temperature at Sea Floor&#39;</span>,                    &amp;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        standard_name=<span class="stringliteral">&#39;sea_water_potential_temperature_at_sea_floor&#39;</span>, units=<span class="stringliteral">&#39;degC&#39;</span>)</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    cs%id_sob = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,<span class="stringliteral">&#39;sob&#39;</span>,diag%axesT1, time,           &amp;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        long_name=<span class="stringliteral">&#39;Sea Water Salinity at Sea Floor&#39;</span>,                                 &amp;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        standard_name=<span class="stringliteral">&#39;sea_water_salinity_at_sea_floor&#39;</span>, units=<span class="stringliteral">&#39;ppt&#39;</span>)</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    cs%id_sst = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SST&#39;</span>, diag%axesT1, time,     &amp;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <span class="stringliteral">&#39;Sea Surface Temperature&#39;</span>, <span class="stringliteral">&#39;Celsius&#39;</span>, cs%missing, cmor_field_name=<span class="stringliteral">&#39;tos&#39;</span>, &amp;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Sea Surface Temperature&#39;</span>, cmor_units=<span class="stringliteral">&#39;degC&#39;</span>,             &amp;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;sea_surface_temperature&#39;</span>)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    cs%id_sst_sq = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SST_sq&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        <span class="stringliteral">&#39;Sea Surface Temperature Squared&#39;</span>, <span class="stringliteral">&#39;Celsius**2&#39;</span>, cs%missing, cmor_field_name=<span class="stringliteral">&#39;tossq&#39;</span>, &amp;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Square of Sea Surface Temperature &#39;</span>, cmor_units=<span class="stringliteral">&#39;degC^2&#39;</span>, &amp;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;square_of_sea_surface_temperature&#39;</span>)</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    <span class="keywordflow">if</span> (cs%id_sst_sq &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%SST_sq,isd,ied,jsd,jed)</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    cs%id_sss = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SSS&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="stringliteral">&#39;Sea Surface Salinity&#39;</span>, <span class="stringliteral">&#39;PPT&#39;</span>, cs%missing, cmor_field_name=<span class="stringliteral">&#39;sos&#39;</span>, &amp;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Sea Surface Salinity&#39;</span>, cmor_units=<span class="stringliteral">&#39;ppt&#39;</span>,          &amp;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;sea_surface_salinity&#39;</span>)</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    cs%id_sss_sq = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SSS_sq&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        <span class="stringliteral">&#39;Sea Surface Salinity Squared&#39;</span>, <span class="stringliteral">&#39;ppt**2&#39;</span>, cs%missing, cmor_field_name=<span class="stringliteral">&#39;sossq&#39;</span>, &amp;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Square of Sea Surface Salinity &#39;</span>, cmor_units=<span class="stringliteral">&#39;ppt^2&#39;</span>, &amp;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;square_of_sea_surface_salinity&#39;</span>)</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    <span class="keywordflow">if</span> (cs%id_sss_sq &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%SSS_sq,isd,ied,jsd,jed)</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature .and. cs%use_frazil) <span class="keywordflow">then</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    cs%id_fraz = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;frazil&#39;</span>, diag%axesT1, time,                         &amp;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;          <span class="stringliteral">&#39;Heat from frazil formation&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;hfsifrazil&#39;</span>,                    &amp;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;          cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>, cmor_standard_name=<span class="stringliteral">&#39;heat_flux_into_sea_water_due_to_frazil_ice_formation&#39;</span>, &amp;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;          cmor_long_name=<span class="stringliteral">&#39;Heat Flux into Sea Water due to Frazil Ice Formation&#39;</span>)</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  cs%id_salt_deficit = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;salt_deficit&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;         <span class="stringliteral">&#39;Salt sink in ocean due to ice flux&#39;</span>, <span class="stringliteral">&#39;g Salt meter-2 s-1&#39;</span>)</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  cs%id_Heat_PmE = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;Heat_PmE&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;         <span class="stringliteral">&#39;Heat flux into ocean from mass flux into ocean&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>)</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  cs%id_intern_heat = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;internal_heat&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;         <span class="stringliteral">&#39;Heat flux into ocean from geothermal or other internal sources&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>)</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  <span class="comment">! lateral heat advective and diffusive fluxes</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  cs%id_Tadx = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_adx&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <span class="stringliteral">&#39;Advective (by residual mean) Zonal Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  cs%id_Tady = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_ady&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      <span class="stringliteral">&#39;Advective (by residual mean) Meridional Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  cs%id_Tdiffx = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_diffx&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;      <span class="stringliteral">&#39;Diffusive Zonal Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  cs%id_Tdiffy = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_diffy&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      <span class="stringliteral">&#39;Diffusive Meridional Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tadx   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_adx,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tady   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_ady,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tdiffx &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_diffx,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tdiffy &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_diffy,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="comment">! lateral salt advective and diffusive fluxes</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  cs%id_Sadx = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_adx&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <span class="stringliteral">&#39;Advective (by residual mean) Zonal Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  cs%id_Sady = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_ady&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      <span class="stringliteral">&#39;Advective (by residual mean) Meridional Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  cs%id_Sdiffx = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_diffx&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;      <span class="stringliteral">&#39;Diffusive Zonal Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  cs%id_Sdiffy = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_diffy&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <span class="stringliteral">&#39;Diffusive Meridional Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sadx   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_adx,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sady   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_ady,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sdiffx &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_diffx,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sdiffy &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_diffy,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="comment">! vertically integrated lateral heat advective and diffusive fluxes</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  cs%id_Tadx_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_adx_2d&#39;</span>, diag%axesCu1, time, &amp;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Advective Zonal Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  cs%id_Tady_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_ady_2d&#39;</span>, diag%axesCv1, time, &amp;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Advective Meridional Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  cs%id_Tdiffx_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_diffx_2d&#39;</span>, diag%axesCu1, time, &amp;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Diffusive Zonal Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  cs%id_Tdiffy_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_diffy_2d&#39;</span>, diag%axesCv1, time, &amp;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Diffusive Meridional Flux of Potential Temperature&#39;</span>, t_flux_units)</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tadx_2d   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_adx_2d,isdb,iedb,jsd,jed)</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tady_2d   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_ady_2d,isd,ied,jsdb,jedb)</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tdiffx_2d &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_diffx_2d,isdb,iedb,jsd,jed)</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;  <span class="keywordflow">if</span> (cs%id_Tdiffy_2d &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%T_diffy_2d,isd,ied,jsdb,jedb)</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="comment">! vertically integrated lateral salt advective and diffusive fluxes</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  cs%id_Sadx_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_adx_2d&#39;</span>, diag%axesCu1, time, &amp;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Advective Zonal Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  cs%id_Sady_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_ady_2d&#39;</span>, diag%axesCv1, time, &amp;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Advective Meridional Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  cs%id_Sdiffx_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_diffx_2d&#39;</span>, diag%axesCu1, time, &amp;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Diffusive Zonal Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  cs%id_Sdiffy_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_diffy_2d&#39;</span>, diag%axesCv1, time, &amp;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="stringliteral">&#39;Vertically Integrated Diffusive Meridional Flux of Salinity&#39;</span>, s_flux_units)</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sadx_2d   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_adx_2d,isdb,iedb,jsd,jed)</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sady_2d   &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_ady_2d,isd,ied,jsdb,jedb)</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sdiffx_2d &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_diffx_2d,isdb,iedb,jsd,jed)</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sdiffy_2d &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%S_diffy_2d,isd,ied,jsdb,jedb)</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  <span class="keywordflow">if</span> (cs%debug_truncations) <span class="keywordflow">then</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(adp%du_dt_visc,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(adp%dv_dt_visc,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordflow">if</span> (.not.cs%adiabatic) <span class="keywordflow">then</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <span class="keyword">call </span>safe_alloc_ptr(adp%du_dt_dia,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      <span class="keyword">call </span>safe_alloc_ptr(adp%dv_dt_dia,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="comment">! diagnostics for values prior to diabatic and prior to ALE</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  cs%id_u_predia = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;u_predia&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <span class="stringliteral">&#39;Zonal velocity before diabatic forcing&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;  cs%id_v_predia = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;v_predia&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="stringliteral">&#39;Meridional velocity before diabatic forcing&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;  cs%id_h_predia = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;h_predia&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      <span class="stringliteral">&#39;Layer Thickness before diabatic forcing&#39;</span>, thickness_units, v_cell_method=<span class="stringliteral">&#39;sum&#39;</span>)</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;  cs%id_e_predia = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;e_predia&#39;</span>, diag%axesTi, time, &amp;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      <span class="stringliteral">&#39;Interface Heights before diabatic forcing&#39;</span>, <span class="stringliteral">&#39;meter&#39;</span>)</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordflow">if</span> (cs%diabatic_first .and. (.not. cs%adiabatic)) <span class="keywordflow">then</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    cs%id_u_preale = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;u_preale&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        <span class="stringliteral">&#39;Zonal velocity before remapping&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    cs%id_v_preale = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;v_preale&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="stringliteral">&#39;Meridional velocity before remapping&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    cs%id_h_preale = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;h_preale&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="stringliteral">&#39;Layer Thickness before remapping&#39;</span>, thickness_units, v_cell_method=<span class="stringliteral">&#39;sum&#39;</span>)</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    cs%id_T_preale = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_preale&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        <span class="stringliteral">&#39;Temperature before remapping&#39;</span>, <span class="stringliteral">&#39;degC&#39;</span>)</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    cs%id_S_preale = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_preale&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        <span class="stringliteral">&#39;Salinity before remapping&#39;</span>, <span class="stringliteral">&#39;ppt&#39;</span>)</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    cs%id_e_preale = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;e_preale&#39;</span>, diag%axesTi, time, &amp;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="stringliteral">&#39;Interface Heights before remapping&#39;</span>, <span class="stringliteral">&#39;meter&#39;</span>)</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    cs%id_T_predia = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;temp_predia&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        <span class="stringliteral">&#39;Potential Temperature&#39;</span>, <span class="stringliteral">&#39;Celsius&#39;</span>)</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    cs%id_S_predia = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;salt_predia&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        <span class="stringliteral">&#39;Salinity&#39;</span>, <span class="stringliteral">&#39;PPT&#39;</span>)</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a353e4f34478972f6c4115a9446e04c09_cgraph.svg" width="646" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a353e4f34478972f6c4115a9446e04c09_icgraph.svg" width="419" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9e0ad1ce70f803df140c0ef9f78f2040"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::register_diags_ts_tendency </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize diagnostics for temp/heat and saln/salt tendencies. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>current model time</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>control structure set up by initialize_MOM </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02344">2344</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <span class="keywordtype">type</span>(time_type),           <span class="keywordtype">intent(in)</span>    :: time<span class="comment">  !&lt; current model time</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),     <span class="keywordtype">intent(inout)</span> :: g<span class="comment">     !&lt; ocean grid structure</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct),  <span class="keywordtype">pointer</span>       :: cs<span class="comment">    !&lt; control structure set up by initialize_MOM</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">pointer</span> :: diag</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, nz</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  diag =&gt; cs%diag</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  isd  = g%isd  ; ied  = g%ied  ; jsd  = g%jsd  ; jed  = g%jed ; nz = g%ke</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  is   = g%isc  ; ie   = g%iec  ; js   = g%jsc  ; je   = g%jec</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="comment">! heat tendencies from lateral advection</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  cs%id_T_advection_xy = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_advection_xy&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      <span class="stringliteral">&#39;Horizontal convergence of residual mean heat advective fluxes&#39;</span>, <span class="stringliteral">&#39;W/m2&#39;</span>)</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  cs%id_T_advection_xy_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_advection_xy_2d&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      <span class="stringliteral">&#39;Vertical sum of horizontal convergence of residual mean heat advective fluxes&#39;</span>, <span class="stringliteral">&#39;W/m2&#39;</span>)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="keywordflow">if</span> (cs%id_T_advection_xy &gt; 0 .or. cs%id_T_advection_xy_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%T_advection_xy,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    cs%tendency_diagnostics = .true.</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="comment">! net temperature and heat tendencies</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  cs%id_T_tendency = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_tendency&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="stringliteral">&#39;Net time tendency for temperature&#39;</span>, <span class="stringliteral">&#39;degC/s&#39;</span>)</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  cs%id_Th_tendency = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;Th_tendency&#39;</span>, diag%axesTL, time,        &amp;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <span class="stringliteral">&#39;Net time tendency for heat&#39;</span>, <span class="stringliteral">&#39;W/m2&#39;</span>,                                                       &amp;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      cmor_field_name=<span class="stringliteral">&quot;opottemptend&quot;</span>, cmor_units=<span class="stringliteral">&quot;W m-2&quot;</span>,                                         &amp;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      cmor_standard_name=<span class="stringliteral">&quot;tendency_of_sea_water_potential_temperature_expressed_as_heat_content&quot;</span>, &amp;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      cmor_long_name =<span class="stringliteral">&quot;Tendency of Sea Water Potential Temperature Expressed as Heat Content&quot;</span>,    &amp;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;      v_cell_method=<span class="stringliteral">&#39;sum&#39;</span>)</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  cs%id_Th_tendency_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;Th_tendency_2d&#39;</span>, diag%axesT1, time,              &amp;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <span class="stringliteral">&#39;Vertical sum of net time tendency for heat&#39;</span>, <span class="stringliteral">&#39;W/m2&#39;</span>,                                                   &amp;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      cmor_field_name=<span class="stringliteral">&quot;opottemptend_2d&quot;</span>, cmor_units=<span class="stringliteral">&quot;W m-2&quot;</span>,                                                   &amp;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      cmor_standard_name=<span class="stringliteral">&quot;tendency_of_sea_water_potential_temperature_expressed_as_heat_content_vertical_sum&quot;</span>,&amp;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      cmor_long_name =<span class="stringliteral">&quot;Tendency of Sea Water Potential Temperature Expressed as Heat Content Vertical Sum&quot;</span>)</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  <span class="keywordflow">if</span> (cs%id_T_tendency &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    cs%tendency_diagnostics = .true.</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%T_prev,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;      cs%T_prev(i,j,k) = cs%tv%T(i,j,k)</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <span class="keywordflow">if</span> (cs%id_Th_tendency &gt; 0 .or. cs%id_Th_tendency_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    cs%tendency_diagnostics = .true.</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%Th_prev,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      cs%Th_prev(i,j,k) = cs%tv%T(i,j,k) * cs%h(i,j,k)</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="comment">! salt tendencies from lateral advection</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  cs%id_S_advection_xy = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_advection_xy&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="stringliteral">&#39;Horizontal convergence of residual mean salt advective fluxes&#39;</span>, <span class="stringliteral">&#39;kg/(m2 * s)&#39;</span>)</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  cs%id_S_advection_xy_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_advection_xy_2d&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <span class="stringliteral">&#39;Vertical sum of horizontal convergence of residual mean salt advective fluxes&#39;</span>, <span class="stringliteral">&#39;kg/(m2 * s)&#39;</span>)</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  <span class="keywordflow">if</span> (cs%id_S_advection_xy &gt; 0 .or. cs%id_S_advection_xy_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%S_advection_xy,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    cs%tendency_diagnostics = .true.</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="comment">! net salinity and salt tendencies</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  cs%id_S_tendency = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_tendency&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="stringliteral">&#39;Net time tendency for salinity&#39;</span>, <span class="stringliteral">&#39;PPT/s&#39;</span>)</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  cs%id_Sh_tendency = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;Sh_tendency&#39;</span>, diag%axesTL, time,&amp;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <span class="stringliteral">&#39;Net time tendency for salt&#39;</span>, <span class="stringliteral">&#39;kg/(m2 * s)&#39;</span>,                                        &amp;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      cmor_field_name=<span class="stringliteral">&quot;osalttend&quot;</span>, cmor_units=<span class="stringliteral">&quot;kg m-2 s-1&quot;</span>,                               &amp;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      cmor_standard_name=<span class="stringliteral">&quot;tendency_of_sea_water_salinity_expressed_as_salt_content&quot;</span>,      &amp;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      cmor_long_name =<span class="stringliteral">&quot;Tendency of Sea Water Salinity Expressed as Salt Content&quot;</span>,         &amp;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      v_cell_method=<span class="stringliteral">&#39;sum&#39;</span>)</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  cs%id_Sh_tendency_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;Sh_tendency_2d&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="stringliteral">&#39;Vertical sum of net time tendency for salt&#39;</span>, <span class="stringliteral">&#39;kg/(m2 * s)&#39;</span>,                               &amp;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      cmor_field_name=<span class="stringliteral">&quot;osalttend_2d&quot;</span>, cmor_units=<span class="stringliteral">&quot;kg m-2 s-1&quot;</span>,                                   &amp;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      cmor_standard_name=<span class="stringliteral">&quot;tendency_of_sea_water_salinity_expressed_as_salt_content_vertical_sum&quot;</span>,&amp;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      cmor_long_name =<span class="stringliteral">&quot;Tendency of Sea Water Salinity Expressed as Salt Content Vertical Sum&quot;</span>)</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  <span class="keywordflow">if</span> (cs%id_S_tendency &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    cs%tendency_diagnostics = .true.</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%S_prev,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      cs%S_prev(i,j,k) = cs%tv%S(i,j,k)</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;  <span class="keywordflow">if</span> (cs%id_Sh_tendency &gt; 0 .or. cs%id_Sh_tendency_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    cs%tendency_diagnostics = .true.</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%Sh_prev,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      cs%Sh_prev(i,j,k) = cs%tv%S(i,j,k) * cs%h(i,j,k)</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a9e0ad1ce70f803df140c0ef9f78f2040_icgraph.svg" width="419" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a86a5617dd90efc4f487373d485f670f0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::register_diags_ts_vardec </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize diagnostics for the variance decay of temp/salt across regridding/remapping. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>current model time</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hi</td><td>horizontal index type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>parameter file</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>control structure for MOM </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02443">2443</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00537">mom_io::var_desc()</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  <span class="keywordtype">type</span>(time_type),         <span class="keywordtype">intent(in)</span> :: time<span class="comment">     !&lt; current model time</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),    <span class="keywordtype">intent(in)</span> :: hi<span class="comment">       !&lt; horizontal index type </span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span> :: gv<span class="comment">       !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; parameter file</span></div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">pointer</span> :: cs<span class="comment">   !&lt; control structure for MOM</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, nz</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordtype">type</span>(vardesc) :: vd_tmp</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">pointer</span> :: diag</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  diag =&gt; cs%diag</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;  isd  = hi%isd  ; ied  = hi%ied  ; jsd  = hi%jsd  ; jed  = hi%jed ; nz = gv%ke</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="comment">! variancy decay through ALE operation</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  cs%id_T_vardec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;T_vardec&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      <span class="stringliteral">&#39;ALE variance decay for temperature&#39;</span>, <span class="stringliteral">&#39;degC2 s-1&#39;</span>)</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordflow">if</span> (cs%id_T_vardec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%T_squared,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    cs%T_squared(:,:,:) = 0.</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    vd_tmp = var_desc(name=<span class="stringliteral">&quot;T2&quot;</span>, units=<span class="stringliteral">&quot;degC2&quot;</span>, longname=<span class="stringliteral">&quot;Squared Potential Temperature&quot;</span>)</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keyword">call </span>register_tracer(cs%T_squared, vd_tmp, param_file, hi, gv, cs%tracer_reg)</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  cs%id_S_vardec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;S_vardec&#39;</span>, diag%axesTL, time, &amp;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="stringliteral">&#39;ALE variance decay for salinity&#39;</span>, <span class="stringliteral">&#39;PPT2 s-1&#39;</span>)</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keywordflow">if</span> (cs%id_S_vardec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(cs%S_squared,isd,ied,jsd,jed,nz)</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    cs%S_squared(:,:,:) = 0.</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    vd_tmp = var_desc(name=<span class="stringliteral">&quot;S2&quot;</span>, units=<span class="stringliteral">&quot;PPT2&quot;</span>, longname=<span class="stringliteral">&quot;Squared Salinity&quot;</span>)</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="keyword">call </span>register_tracer(cs%S_squared, vd_tmp, param_file, hi, gv, cs%tracer_reg)</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a86a5617dd90efc4f487373d485f670f0_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a86a5617dd90efc4f487373d485f670f0_icgraph.svg" width="419" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aab33a9c6ab1106414d95ecdd17da5a06"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::set_restart_fields </td>
          <td>(</td>
          <td class="paramtype">type(verticalgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the fields that are needed for bitwise identical restarting the time stepping scheme. In addition to those specified here directly, there may be fields related to the forcing or to the barotropic solver that are needed; these are specified in sub- routines that are called from this one. </p>
<p>This routine should be altered if there are any changes to the time stepping scheme. The CHECK_RESTART facility may be used to confirm that all needed restart fields have been included.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>opened file for parsing to get parameters</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>control structure set up by inialize_MOM </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02763">2763</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00186">mom_verticalgrid::get_flux_units()</a>, <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00168">mom_verticalgrid::get_thickness_units()</a>, and <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00537">mom_io::var_desc()</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),  <span class="keywordtype">intent(inout)</span> :: gv<span class="comment">         !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  <span class="keywordtype">type</span>(param_file_type),    <span class="keywordtype">intent(in)</span> :: param_file<span class="comment">    !&lt; opened file for parsing to get parameters</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">intent(in)</span> :: cs<span class="comment">            !&lt; control structure set up by inialize_MOM</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  <span class="keywordtype">type</span>(vardesc) :: vd</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  <span class="keywordtype">character(len=48)</span> :: thickness_units, flux_units</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  thickness_units = get_thickness_units(gv)</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  flux_units = get_flux_units(gv)</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;Temp&quot;</span>,<span class="stringliteral">&quot;degC&quot;</span>,<span class="stringliteral">&quot;Potential Temperature&quot;</span>)</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <span class="keyword">call </span>register_restart_field(cs%tv%T, vd, .true., cs%restart_CSp)</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;Salt&quot;</span>,<span class="stringliteral">&quot;PPT&quot;</span>,<span class="stringliteral">&quot;Salinity&quot;</span>)</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keyword">call </span>register_restart_field(cs%tv%S, vd, .true., cs%restart_CSp)</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;h&quot;</span>,thickness_units,<span class="stringliteral">&quot;Layer Thickness&quot;</span>)</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%h, vd, .true., cs%restart_CSp)</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;u&quot;</span>,<span class="stringliteral">&quot;meter second-1&quot;</span>,<span class="stringliteral">&quot;Zonal velocity&quot;</span>,<span class="stringliteral">&#39;u&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%u, vd, .true., cs%restart_CSp)</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;v&quot;</span>,<span class="stringliteral">&quot;meter second-1&quot;</span>,<span class="stringliteral">&quot;Meridional velocity&quot;</span>,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%v, vd, .true., cs%restart_CSp)</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="keywordflow">if</span> (cs%use_frazil) <span class="keywordflow">then</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;frazil&quot;</span>,<span class="stringliteral">&quot;J m-2&quot;</span>,<span class="stringliteral">&quot;Frazil heat flux into ocean&quot;</span>,<span class="stringliteral">&#39;h&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>)</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <span class="keyword">call </span>register_restart_field(cs%tv%frazil, vd, .false., cs%restart_CSp)</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;  <span class="keywordflow">if</span> (cs%interp_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;p_surf_prev&quot;</span>,<span class="stringliteral">&quot;Pa&quot;</span>,<span class="stringliteral">&quot;Previous ocean surface pressure&quot;</span>,<span class="stringliteral">&#39;h&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>)</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <span class="keyword">call </span>register_restart_field(cs%p_surf_prev, vd, .false., cs%restart_CSp)</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;ave_ssh&quot;</span>,<span class="stringliteral">&quot;meter&quot;</span>,<span class="stringliteral">&quot;Time average sea surface height&quot;</span>,<span class="stringliteral">&#39;h&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>)</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%ave_ssh, vd, .false., cs%restart_CSp)</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_aab33a9c6ab1106414d95ecdd17da5a06_cgraph.svg" width="100%" height="446"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_aab33a9c6ab1106414d95ecdd17da5a06_icgraph.svg" width="434" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4c8332b095c6d295084089aa6b3b678a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom::step_mom </td>
          <td>(</td>
          <td class="paramtype">type(forcing), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(surface), intent(inout)&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time_interval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d8/dfa/structmom_1_1mom__control__struct.html">mom_control_struct</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine orchestrates the time stepping of MOM. The adiabatic dynamics are stepped by calls to one of the step_MOM_dyn_...routines. The action of lateral processes on tracers occur in calls to advect_tracer and tracer_hordiff. Vertical mixing and possibly remapping occur inside of diabatic. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>pointers to forcing fields</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>surface ocean state</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_start</td><td>starting time of a segment, as a time type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_interval</td><td>time interval</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>control structure from initialize_MOM </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">411</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d6/d34/MOM__diabatic__driver_8F90_source.html#l01405">mom_diabatic_driver::adiabatic()</a>, <a class="el" href="../../df/d59/MOM__dynamics__legacy__split_8F90_source.html#l01054">mom_dynamics_legacy_split::adjustments_dyn_legacy_split()</a>, <a class="el" href="../../db/d10/MOM__lateral__mixing__coeffs_8F90_source.html#l00124">mom_lateral_mixing_coeffs::calc_resoln_function()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02810">calculate_surface_state()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00125">mom_error_handler::calltree_enter()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00146">mom_error_handler::calltree_leave()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00156">mom_error_handler::calltree_waypoint()</a>, <a class="el" href="../../d0/d57/MOM__domains_8F90_source.html#l00840">mom_domains::complete_group_pass()</a>, <a class="el" href="../../dc/dc7/MOM__spatial__means_8F90_source.html#l00061">mom_spatial_means::global_area_integral()</a>, <a class="el" href="../../dc/dc7/MOM__spatial__means_8F90_source.html#l00044">mom_spatial_means::global_area_mean()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00399">id_clock_ale</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00389">id_clock_diabatic</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00393">id_clock_diagnostics</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00386">id_clock_dynamics</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00392">id_clock_ml_restrat</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00385">id_clock_ocean</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00400">id_clock_other</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00397">id_clock_pass</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00387">id_clock_thermo</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00391">id_clock_thick_diff</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00388">id_clock_tracer</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00394">id_clock_z_diag</a>, <a class="el" href="../../d5/ded/MOM__forcing__type_8F90_source.html#l00781">mom_forcing_type::mom_forcing_chksum()</a>, <a class="el" href="../../d3/d5c/MOM__checksum__packages_8F90_source.html#l00122">mom_checksum_packages::mom_thermo_chksum()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02508">post_diags_ts_tendency()</a>, <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02622">post_diags_ts_vardec()</a>, <a class="el" href="../../d0/d57/MOM__domains_8F90_source.html#l00826">mom_domains::start_group_pass()</a>, <a class="el" href="../../dd/d45/MOM__MEKE_8F90_source.html#l00088">mom_meke::step_forward_meke()</a>, and <a class="el" href="../../d2/d6f/MOM__thickness__diffuse_8F90_source.html#l00101">mom_thickness_diffuse::thickness_diffuse()</a>.</p>

<p>Referenced by <a class="el" href="../../de/dbc/MOM__driver_8F90_source.html#l00001">mom_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordtype">type</span>(forcing),    <span class="keywordtype">intent(inout)</span>    :: fluxes<span class="comment">        !&lt; pointers to forcing fields</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordtype">type</span>(surface),    <span class="keywordtype">intent(inout)</span>    :: state<span class="comment">         !&lt; surface ocean state</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">type</span>(time_type),  <span class="keywordtype">intent(in)</span>       :: time_start<span class="comment">    !&lt; starting time of a segment, as a time type</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">real</span>,             <span class="keywordtype">intent(in)</span>       :: time_interval<span class="comment"> !&lt; time interval</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">type</span>(mom_control_struct), <span class="keywordtype">pointer</span>  :: cs<span class="comment">            !&lt; control structure from initialize_MOM</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">! local</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">pointer</span> :: g <span class="comment">! pointer to a structure containing</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                      <span class="comment">! metrics and related information</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),  <span class="keywordtype">pointer</span> :: gv =&gt; null()</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: nt = 1 <span class="comment">! running number of iterations</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordtype">integer</span>       :: ntstep <span class="comment">! time steps between tracer updates or diabatic forcing</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordtype">integer</span>       :: n_max  <span class="comment">! number of steps to take in this call</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz, n</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, isdb, iedb, jsdb, jedb</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordtype">real</span> :: dt              <span class="comment">! baroclinic time step (sec)</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordtype">real</span> :: dtth            <span class="comment">! time step for thickness diffusion (sec)</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordtype">real</span> :: dtdia           <span class="comment">! time step for diabatic processes (sec)</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordtype">real</span> :: dt_therm        <span class="comment">! a limited and quantized version of CS%dt_therm (sec)</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordtype">real</span> :: dtbt_reset_time <span class="comment">! value of CS%rel_time when DTBT was last calculated (sec)</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordtype">real</span> :: wt_end, wt_beg</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordtype">logical</span> :: calc_dtbt                 <span class="comment">! Indicates whether the dynamically adjusted</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                       <span class="comment">! barotropic time step needs to be updated.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordtype">logical</span> :: do_advection              <span class="comment">! If true, it is time to advect tracers.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordtype">logical</span> :: thermo_does_span_coupling <span class="comment">! If true, thermodynamic forcing spans</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                       <span class="comment">! multiple dynamic timesteps.</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(CS%G),SZJ_(CS%G))</span> :: &amp;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    eta_av, &amp;   <span class="comment">! average sea surface height or column mass over a timestep (meter or kg/m2)</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    ssh         <span class="comment">! sea surface height based on eta_av (meter or kg/m2)</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: &amp;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    tmp,              &amp; <span class="comment">! temporary 2d field</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    zos,              &amp; <span class="comment">! dynamic sea lev (zero area mean) from inverse-barometer adjusted ssh (meter)</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    zossq,            &amp; <span class="comment">! square of zos (m^2)</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    sfc_speed,        &amp; <span class="comment">! sea surface speed at h-points (m/s)</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    frazil_ave,       &amp; <span class="comment">! average frazil heat flux required to keep temp above freezing (W/m2)</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    salt_deficit_ave, &amp; <span class="comment">! average salt flux required to keep salinity above 0.01ppt (gSalt m-2 s-1)</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    heat_pme_ave,     &amp; <span class="comment">! average effective heat flux into the ocean due to</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                        <span class="comment">! the exchange of water with other components, times the</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                        <span class="comment">! heat capacity of water, in W m-2.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    intern_heat_ave     <span class="comment">! avg heat flux into ocean from geothermal or</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                        <span class="comment">! other internal heat sources (W/m2)</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span> :: &amp;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    u, &amp; <span class="comment">! u : zonal velocity component (m/s)</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    v, &amp; <span class="comment">! v : meridional velocity component (m/s)</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    h    <span class="comment">! h : layer thickness (meter (Bouss) or kg/m2 (non-Bouss))</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(CS%G),SZJ_(CS%G),SZK_(CS%G)+1)</span> :: eta_predia, eta_preale</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">real</span> :: tot_wt_ssh, itot_wt_ssh, i_time_int</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordtype">real</span> :: zos_area_mean, volo, ssh_ga</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">type</span>(time_type) :: time_local</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">logical</span> :: showcalltree</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordtype">logical</span> :: do_pass_kd_kv_turb <span class="comment">! This is used for a group halo pass.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  g =&gt; cs%G ; gv =&gt; cs%GV</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  is   = g%isc  ; ie   = g%iec  ; js   = g%jsc  ; je   = g%jec ; nz = g%ke</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  isq  = g%IscB ; ieq  = g%IecB ; jsq  = g%JscB ; jeq  = g%JecB</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  isd  = g%isd  ; ied  = g%ied  ; jsd  = g%jsd  ; jed  = g%jed</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  u =&gt; cs%u ; v =&gt; cs%v ; h =&gt; cs%h</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_ocean)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  showcalltree = calltree_showquery()</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;step_MOM(), MOM.F90&quot;</span>)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">! First determine the time step that is consistent with this call.</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">! It is anticipated that the time step will almost always coincide</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">! with dt. In addition, ntstep is determined, subject to the constraint</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">! that ntstep cannot exceed n_max.</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">if</span> (time_interval &lt;= cs%dt) <span class="keywordflow">then</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    n_max = 1</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    n_max = ceiling(time_interval/cs%dt - 0.001)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  dt    = time_interval / <span class="keywordtype">real</span>(n_max)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  dtdia = 0.0</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  thermo_does_span_coupling = (cs%thermo_spans_coupling .and. &amp;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                              (cs%dt_therm &gt; 1.5*time_interval))</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">! Set dt_therm to be an integer multiple of the coupling time step.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    dt_therm = time_interval * floor(cs%dt_therm / time_interval + 0.001)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    ntstep = floor(dt_therm/dt + 0.001)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    ntstep = max(1,min(n_max,floor(cs%dt_therm/dt + 0.001)))</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    dt_therm = dt*ntstep</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  cs%visc%calc_bbl = .true.</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%p_surf)) cs%interp_p_surf = .false.</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="comment">!---------- Begin setup for group halo pass</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_tau_ustar_psurf, fluxes%taux, fluxes%tauy, g%Domain)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%ustar)) &amp;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_tau_ustar_psurf, fluxes%ustar(:,:), g%Domain)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%p_surf)) &amp;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_tau_ustar_psurf, fluxes%p_surf(:,:), g%Domain)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span> (cs%thickness_diffuse .OR. cs%mixedlayer_restrat) &amp;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_h, h, g%Domain)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordflow">if</span> (cs%diabatic_first) <span class="keywordflow">then</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%visc%Ray_u) .and. <span class="keyword">associated</span>(cs%visc%Ray_v)) &amp;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_ray, cs%visc%Ray_u, cs%visc%Ray_v, g%Domain, &amp;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                             to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%visc%kv_bbl_u) .and. <span class="keyword">associated</span>(cs%visc%kv_bbl_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_bbl_thick_kv_bbl, cs%visc%bbl_thick_u, &amp;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                             cs%visc%bbl_thick_v, g%Domain, to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_bbl_thick_kv_bbl, cs%visc%kv_bbl_u, &amp;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                             cs%visc%kv_bbl_v, g%Domain, to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span> (.not.cs%adiabatic .AND. cs%use_ALE_algorithm ) <span class="keywordflow">then</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_T_S_h, cs%tv%T, g%Domain)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_T_S_h, cs%tv%S, g%Domain)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_T_S_h, h, g%Domain)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">if</span> ((cs%adiabatic .OR. cs%diabatic_first) .AND. cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_T_S, cs%tv%T, g%Domain)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_T_S, cs%tv%S, g%Domain)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span> ((cs%visc%Prandtl_turb &gt; 0) .and. <span class="keyword">associated</span>(cs%visc%Kd_turb)) &amp;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_kd_kv_turb, cs%visc%Kd_turb, g%Domain)</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%visc%Kv_turb)) &amp;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_kd_kv_turb, cs%visc%Kv_turb, g%Domain)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">!---------- End setup for group halo pass</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  do_pass_kd_kv_turb = ((cs%visc%Prandtl_turb &gt; 0) .and. <span class="keyword">associated</span>(cs%visc%Kd_turb)) &amp;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                       .OR. <span class="keyword">associated</span>(cs%visc%Kv_turb)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_tau_ustar_psurf, g%Domain)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_tau_ustar_psurf, g%Domain)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%frazil))        cs%tv%frazil(:,:)        = 0.0</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%salt_deficit))  cs%tv%salt_deficit(:,:)  = 0.0</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%TempxPmE))      cs%tv%TempxPmE(:,:)      = 0.0</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%internal_heat)) cs%tv%internal_heat(:,:) = 0.0</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  cs%rel_time = 0.0</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  tot_wt_ssh = 0.0</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; cs%ave_ssh(i,j) = 0.0 ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%VarMix)) <span class="keywordflow">then</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keyword">call </span>enable_averaging(time_interval, time_start+set_time(int(time_interval)), &amp;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                          cs%diag)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keyword">call </span>calc_resoln_function(h, cs%tv, g, gv, cs%VarMix)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_tau_ustar_psurf, g%Domain)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">if</span> (cs%interp_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(cs%p_surf_end))   <span class="keyword">allocate</span>(cs%p_surf_end(isd:ied,jsd:jed))</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(cs%p_surf_begin)) <span class="keyword">allocate</span>(cs%p_surf_begin(isd:ied,jsd:jed))</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span> (.not.cs%p_surf_prev_set) <span class="keywordflow">then</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        cs%p_surf_prev(i,j) = fluxes%p_surf(i,j)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      cs%p_surf_prev_set = .true.</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    cs%p_surf_end  =&gt; fluxes%p_surf</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Before steps &quot;</span>, u, v, h, cs%uh, cs%vh, g, gv)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keyword">call </span>mom_forcing_chksum(<span class="stringliteral">&quot;Before steps&quot;</span>, fluxes, g, haloshift=0)</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Before steps &quot;</span>, u, v, g)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Before steps &quot;</span>, fluxes%taux, fluxes%tauy, g)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">do</span> n=1,n_max</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    nt = nt + 1</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">! Set the universally visible time to the middle of the time step</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    cs%Time = time_start + set_time(int(floor(cs%rel_time+0.5*dt+0.5)))</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    cs%rel_time = cs%rel_time + dt</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">! Set the local time to the end of the time step.</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    time_local = time_start + set_time(int(floor(cs%rel_time+0.5)))</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;DT cycles (step_MOM) n=&quot;</span>,n)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (cs%diabatic_first .and. (cs%dt_trans==0.0)) <span class="keywordflow">then</span> <span class="comment">! do thermodynamics.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        dtdia = dt_therm</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">if</span> ((fluxes%dt_buoy_accum &gt; 0.0) .and. (dtdia &gt; time_interval) .and. &amp;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            (abs(fluxes%dt_buoy_accum - dtdia) &gt; 1e-6*dtdia)) <span class="keywordflow">then</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;step_MOM: Mismatch between long thermodynamic &quot;</span>//&amp;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="stringliteral">&quot;timestep and time over which buoyancy fluxes have been accumulated.&quot;</span>)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM is not yet set up to have restarts that work &quot;</span>//&amp;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          <span class="stringliteral">&quot;with THERMO_SPANS_COUPLING and DIABATIC_FIRST.&quot;</span>)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        dtdia = dt*min(ntstep,n_max-(n-1))</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">! The end-time of the diagnostic interval needs to be set ahead if there</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">! are multiple dynamic time steps worth of dynamics applied here.</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keyword">call </span>enable_averaging(dtdia, time_local + &amp;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                   set_time(int(floor(dtdia-dt+0.5))), cs%diag)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">!   Calculate the BBL properties and store them inside visc (u,h).</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="comment">! This is here so that CS%visc is updated before diabatic() when</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="comment">! DIABATIC_FIRST=True. Otherwise diabatic() is called after the dynamics</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">! and set_viscous_BBL is called as a part of the dynamic stepping.</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keyword">call </span>uchksum(u,<span class="stringliteral">&quot;Pre set_viscous_BBL u&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keyword">call </span>vchksum(v,<span class="stringliteral">&quot;Pre set_viscous_BBL v&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keyword">call </span>hchksum(h*gv%H_to_m,<span class="stringliteral">&quot;Pre set_viscous_BBL h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%T)) <span class="keyword">call </span>hchksum(cs%tv%T, <span class="stringliteral">&quot;Pre set_viscous_BBL T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%S)) <span class="keyword">call </span>hchksum(cs%tv%S, <span class="stringliteral">&quot;Pre set_viscous_BBL S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="comment">!call cpu_clock_begin(id_clock_vertvisc)</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keyword">call </span>set_viscous_bbl(u, v, h, cs%tv, cs%visc, g, gv, cs%set_visc_CSp)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">!call cpu_clock_end(id_clock_vertvisc)</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">if</span>(<span class="keyword">associated</span>(cs%visc%Ray_u) .and. <span class="keyword">associated</span>(cs%visc%Ray_v)) &amp;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keyword">call </span>do_group_pass(cs%pass_ray, g%Domain )</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">if</span>(<span class="keyword">associated</span>(cs%visc%kv_bbl_u) .and. <span class="keyword">associated</span>(cs%visc%kv_bbl_v))  &amp;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keyword">call </span>do_group_pass(cs%pass_bbl_thick_kv_bbl, g%Domain )</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with set_viscous_BBL (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_thermo)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">if</span> (.not.cs%adiabatic) <span class="keywordflow">then</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Pre-dia first &quot;</span>, u, v, h, cs%uhtr, cs%vhtr, g, gv)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;          <span class="keyword">call </span>mom_thermo_chksum(<span class="stringliteral">&quot;Pre-dia first &quot;</span>, cs%tv, g, haloshift=0)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Pre-dia first &quot;</span>, u, v, g)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="keywordflow">if</span> (cs%split .and. cs%legacy_split) <span class="keywordflow">then</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;          <span class="keyword">call </span>adjustments_dyn_legacy_split(u, v, h, dt, g, gv, cs%dyn_legacy_split_CSp)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_diabatic)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keyword">call </span>diabatic(u, v, h, cs%tv, fluxes, cs%visc, cs%ADp, cs%CDp, &amp;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                      dtdia, g, gv, cs%diabatic_CSp)</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        fluxes%fluxes_used = .true.</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_diabatic)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">if</span> (cs%id_u_preale &gt; 0) <span class="keyword">call </span>post_data(cs%id_u_preale, u,       cs%diag)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">if</span> (cs%id_v_preale &gt; 0) <span class="keyword">call </span>post_data(cs%id_v_preale, v,       cs%diag)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">if</span> (cs%id_h_preale &gt; 0) <span class="keyword">call </span>post_data(cs%id_h_preale, h,       cs%diag)</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">if</span> (cs%id_T_preale &gt; 0) <span class="keyword">call </span>post_data(cs%id_T_preale, cs%tv%T, cs%diag)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span> (cs%id_S_preale &gt; 0) <span class="keyword">call </span>post_data(cs%id_S_preale, cs%tv%S, cs%diag)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keywordflow">if</span> (cs%id_e_preale &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keyword">call </span>find_eta(h, cs%tv, g%g_Earth, g, gv, eta_preale)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keyword">call </span>post_data(cs%id_e_preale, eta_preale, cs%diag)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="comment">! Regridding/remapping is done here, at end of thermodynamics time step</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="comment">! (that may comprise several dynamical time steps)</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment">! The routine &#39;ALE_main&#39; can be found in &#39;MOM_ALE.F90&#39;.</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">if</span> ( cs%use_ALE_algorithm ) <span class="keywordflow">then</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">!         call pass_vector(u, v, G%Domain)</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          <span class="keyword">call </span>do_group_pass(cs%pass_T_S_h, g%Domain)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          <span class="comment">! update squared quantities</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%S_squared)) &amp;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            cs%S_squared(:,:,:) = cs%tv%S(:,:,:) ** 2</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%T_squared)) &amp;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            cs%T_squared(:,:,:) = cs%tv%T(:,:,:) ** 2</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;          <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Pre-ALE 1 &quot;</span>, u, v, h, cs%uh, cs%vh, g, gv)</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keyword">call </span>hchksum(cs%tv%T,<span class="stringliteral">&quot;Pre-ALE 1 T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keyword">call </span>hchksum(cs%tv%S,<span class="stringliteral">&quot;Pre-ALE 1 S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Pre-ALE 1 &quot;</span>, u, v, g)</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          <span class="keyword">call </span>cpu_clock_begin(id_clock_ale)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          <span class="keyword">call </span>ale_main(g, gv, h, u, v, cs%tv, cs%tracer_Reg, cs%ALE_CSp, dtdia)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <span class="keyword">call </span>cpu_clock_end(id_clock_ale)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordflow">        endif</span>   <span class="comment">! endif for the block &quot;if ( CS%use_ALE_algorithm )&quot;</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keyword">call </span>do_group_pass(cs%pass_uv_T_S_h, g%Domain)</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">if</span> (cs%debug .and. cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;          <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Post-ALE 1 &quot;</span>, u, v, h, cs%uh, cs%vh, g, gv)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          <span class="keyword">call </span>hchksum(cs%tv%T,<span class="stringliteral">&quot;Post-ALE 1 T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          <span class="keyword">call </span>hchksum(cs%tv%S,<span class="stringliteral">&quot;Post-ALE 1 S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Post-ALE 1 &quot;</span>, u, v, g)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="comment">! Whenever thickness changes let the diag manager know, target grids</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="comment">! for vertical remapping may need to be regenerated.</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keyword">call </span>diag_update_target_grids(cs%diag)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keyword">call </span>post_diags_ts_vardec(g, cs, dtdia)</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          <span class="keyword">call </span>uchksum(u,<span class="stringliteral">&quot;Post-dia first u&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <span class="keyword">call </span>vchksum(v,<span class="stringliteral">&quot;Post-dia first v&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          <span class="keyword">call </span>hchksum(h,<span class="stringliteral">&quot;Post-dia first h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          <span class="keyword">call </span>uchksum(cs%uhtr,<span class="stringliteral">&quot;Post-dia first uh&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          <span class="keyword">call </span>vchksum(cs%vhtr,<span class="stringliteral">&quot;Post-dia first vh&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="comment">! call MOM_state_chksum(&quot;Post-dia first &quot;, u, v, &amp;</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">!                       h, CS%uhtr, CS%vhtr, G, GV, haloshift=1)</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%T)) <span class="keyword">call </span>hchksum(cs%tv%T, <span class="stringliteral">&quot;Post-dia first T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%S)) <span class="keyword">call </span>hchksum(cs%tv%S, <span class="stringliteral">&quot;Post-dia first S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%frazil)) <span class="keyword">call </span>hchksum(cs%tv%frazil, &amp;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                  <span class="stringliteral">&quot;Post-dia first frazil&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%salt_deficit)) <span class="keyword">call </span>hchksum(cs%tv%salt_deficit, &amp;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                  <span class="stringliteral">&quot;Post-dia first salt deficit&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="comment">! call MOM_thermo_chksum(&quot;Post-dia first &quot;, CS%tv, G)</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Post-dia first &quot;</span>, u, v, g)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">else</span>   <span class="comment">! else for block &quot;if (.not.CS%adiabatic)&quot;</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_diabatic)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keyword">call </span>adiabatic(h, cs%tv, fluxes, dtdia, g, gv, cs%diabatic_CSp)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        fluxes%fluxes_used = .true.</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_diabatic)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;          <span class="keyword">call </span>do_group_pass(cs%pass_T_S, g%Domain)</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%T)) <span class="keyword">call </span>hchksum(cs%tv%T, <span class="stringliteral">&quot;Post-dia first T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%S)) <span class="keyword">call </span>hchksum(cs%tv%S, <span class="stringliteral">&quot;Post-dia first S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! endif for the block &quot;if (.not.CS%adiabatic)&quot;</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_thermo)</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished diabatic_first (step_MOM)&quot;</span>)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! end of block &quot;(CS%diabatic_first .and. (CS%dt_trans==0.0))&quot;</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span> (do_pass_kd_kv_turb) <span class="keyword">call </span>do_group_pass(cs%pass_kd_kv_turb, g%Domain)</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_dynamics)</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">if</span> (cs%thickness_diffuse .and. cs%thickness_diffuse_first) <span class="keywordflow">then</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">if</span> (cs%dt_trans == 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;          dtth = dt_therm</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          dtth = dt*min(ntstep,n_max-n+1)</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keyword">call </span>enable_averaging(dtth,time_local+set_time(int(floor(dtth-dt+0.5))), cs%diag)</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_thick_diff)</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%VarMix)) &amp;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <span class="keyword">call </span>calc_slope_functions(h, cs%tv, dt, g, gv, cs%VarMix)</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keyword">call </span>thickness_diffuse(h, cs%uhtr, cs%vhtr, cs%tv, dtth, g, gv, &amp;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                               cs%MEKE, cs%VarMix, cs%CDp, cs%thickness_diffuse_CSp)</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_thick_diff)</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keyword">call </span>do_group_pass(cs%pass_h, g%Domain)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished thickness_diffuse_first (step_MOM)&quot;</span>)</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="comment">! Whenever thickness changes let the diag manager know, target grids</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="comment">! for vertical remapping may need to be regenerated.</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keyword">call </span>diag_update_target_grids(cs%diag)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (cs%interp_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      wt_end = <span class="keywordtype">real(n)</span> / <span class="keywordtype">real</span>(n_max)</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      wt_beg = <span class="keywordtype">real(n-1)</span> / <span class="keywordtype">real</span>(n_max)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        cs%p_surf_end(i,j) = wt_end * fluxes%p_surf(i,j) + &amp;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                        (1.0-wt_end) * cs%p_surf_prev(i,j)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        cs%p_surf_begin(i,j) = wt_beg * fluxes%p_surf(i,j) + &amp;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                        (1.0-wt_beg) * cs%p_surf_prev(i,j)</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span> (cs%visc%calc_bbl) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      cs%visc%bbl_calc_time_interval = dt_therm</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      cs%visc%bbl_calc_time_interval = dt*<span class="keywordtype">real(1+MIN(ntstep-MOD(n,ntstep)</span>,n_max-n))</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="keywordflow">    endif</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%u_prev) .and. <span class="keyword">associated</span>(cs%v_prev)) <span class="keywordflow">then</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isdb,iedb</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        cs%u_prev(i,j,k) = u(i,j,k)</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsdb,jedb ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        cs%v_prev(i,j,k) = u(i,j,k)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">if</span> (cs%do_dynamics .and. cs%split) <span class="keywordflow">then</span> <span class="comment">!--------------------------- start SPLIT</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="comment">! This section uses a split time stepping scheme for the dynamic equations,</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="comment">! basically the stacked shallow water equations with viscosity.</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      calc_dtbt = .false.</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">if</span> ((cs%dtbt_reset_period &gt;= 0.0) .and. &amp;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;          ((n==1) .or. (cs%dtbt_reset_period == 0.0) .or. &amp;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;           (cs%rel_time &gt;= dtbt_reset_time + 0.999*cs%dtbt_reset_period))) <span class="keywordflow">then</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        calc_dtbt = .true.</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        dtbt_reset_time = cs%rel_time</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">if</span> (cs%legacy_split) <span class="keywordflow">then</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keyword">call </span>step_mom_dyn_legacy_split(u, v, h, cs%tv, cs%visc, &amp;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                    time_local, dt, fluxes, cs%p_surf_begin, cs%p_surf_end, &amp;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                    cs%dt_trans, dt_therm, cs%uh, cs%vh, cs%uhtr, cs%vhtr, &amp;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                    eta_av, g, gv, cs%dyn_legacy_split_CSp, calc_dtbt, cs%VarMix, cs%MEKE)</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keyword">call </span>step_mom_dyn_split_rk2(u, v, h, cs%tv, cs%visc, &amp;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                    time_local, dt, fluxes, cs%p_surf_begin, cs%p_surf_end, &amp;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                    cs%dt_trans, dt_therm, cs%uh, cs%vh, cs%uhtr, cs%vhtr, &amp;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                    eta_av, g, gv, cs%dyn_split_RK2_CSp, calc_dtbt, cs%VarMix, cs%MEKE)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished step_MOM_dyn_split (step_MOM)&quot;</span>)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">elseif</span> (cs%do_dynamics) <span class="keywordflow">then</span> <span class="comment">! --------------------------------------------------- not SPLIT</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="comment">!   This section uses an unsplit stepping scheme for the dynamic</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <span class="comment">! equations; basically the stacked shallow water equations with viscosity.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="comment">! Because the time step is limited by CFL restrictions on the external</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="comment">! gravity waves, the unsplit is usually much less efficient that the split</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <span class="comment">! approaches. But because of its simplicity, the unsplit method is very</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="comment">! useful for debugging purposes.</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="keywordflow">if</span> (cs%use_RK2) <span class="keywordflow">then</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keyword">call </span>step_mom_dyn_unsplit_rk2(u, v, h, cs%tv, cs%visc, time_local, dt, fluxes, &amp;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                 cs%p_surf_begin, cs%p_surf_end, cs%uh, cs%vh, cs%uhtr, cs%vhtr, &amp;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                 eta_av, g, gv, cs%dyn_unsplit_RK2_CSp, cs%VarMix, cs%MEKE)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keyword">call </span>step_mom_dyn_unsplit(u, v, h, cs%tv, cs%visc, time_local, dt, fluxes, &amp;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                 cs%p_surf_begin, cs%p_surf_end, cs%uh, cs%vh, cs%uhtr, cs%vhtr, &amp;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                 eta_av, g, gv, cs%dyn_unsplit_CSp, cs%VarMix, cs%MEKE)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished step_MOM_dyn_unsplit (step_MOM)&quot;</span>)</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! -------------------------------------------------- end SPLIT</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">if</span> (cs%thickness_diffuse .and. .not.cs%thickness_diffuse_first) <span class="keywordflow">then</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_thick_diff)</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%VarMix)) &amp;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="keyword">call </span>calc_slope_functions(h, cs%tv, dt, g, gv, cs%VarMix)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keyword">call </span>thickness_diffuse(h, cs%uhtr, cs%vhtr, cs%tv, dt, g, gv, &amp;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                             cs%MEKE, cs%VarMix, cs%CDp, cs%thickness_diffuse_CSp)</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_thick_diff)</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keyword">call </span>do_group_pass(cs%pass_h, g%Domain)</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished thickness_diffuse (step_MOM)&quot;</span>)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="comment">! apply the submesoscale mixed layer restratification parameterization</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">if</span> (cs%mixedlayer_restrat) <span class="keywordflow">then</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keyword">call </span>hchksum(h,<span class="stringliteral">&quot;Pre-mixedlayer_restrat h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keyword">call </span>uchksum(cs%uhtr,<span class="stringliteral">&quot;Pre-mixedlayer_restrat uhtr&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keyword">call </span>vchksum(cs%vhtr,<span class="stringliteral">&quot;Pre-mixedlayer_restrat vhtr&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_ml_restrat)</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keyword">call </span>mixedlayer_restrat(h, cs%uhtr ,cs%vhtr, cs%tv, fluxes, dt, cs%visc%MLD, &amp;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                              g, gv, cs%mixedlayer_restrat_CSp)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_ml_restrat)</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keyword">call </span>do_group_pass(cs%pass_h, g%Domain)</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keyword">call </span>hchksum(h,<span class="stringliteral">&quot;Post-mixedlayer_restrat h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keyword">call </span>uchksum(cs%uhtr,<span class="stringliteral">&quot;Post-mixedlayer_restrat uhtr&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="keyword">call </span>vchksum(cs%vhtr,<span class="stringliteral">&quot;Post-mixedlayer_restrat vhtr&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">if</span> (cs%useMEKE) <span class="keyword">call </span>step_forward_meke(cs%MEKE, h, cs%VarMix%SN_u, cs%VarMix%SN_v, &amp;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                           cs%visc, dt, g, gv, cs%MEKE_CSp, cs%uhtr, cs%vhtr)</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_dynamics)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    cs%dt_trans = cs%dt_trans + dt</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      do_advection = (cs%dt_trans + 0.5*dt &gt; dt_therm)</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      do_advection = ((mod(n,ntstep) == 0) .or. (n==n_max))</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">! do advection and (perhaps) thermodynamics</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">if</span> (do_advection) <span class="keywordflow">then</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keyword">call </span>uchksum(u,<span class="stringliteral">&quot;Pre-advection u&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keyword">call </span>vchksum(v,<span class="stringliteral">&quot;Pre-advection v&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keyword">call </span>hchksum(h*gv%H_to_m,<span class="stringliteral">&quot;Pre-advection h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keyword">call </span>uchksum(cs%uhtr*gv%H_to_m,<span class="stringliteral">&quot;Pre-advection uhtr&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keyword">call </span>vchksum(cs%vhtr*gv%H_to_m,<span class="stringliteral">&quot;Pre-advection vhtr&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <span class="comment">! call MOM_state_chksum(&quot;Pre-advection &quot;, u, v, &amp;</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="comment">!                       h, CS%uhtr, CS%vhtr, G, GV, haloshift=1)</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%T)) <span class="keyword">call </span>hchksum(cs%tv%T, <span class="stringliteral">&quot;Pre-advection T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%S)) <span class="keyword">call </span>hchksum(cs%tv%S, <span class="stringliteral">&quot;Pre-advection S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%frazil)) <span class="keyword">call </span>hchksum(cs%tv%frazil, &amp;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                         <span class="stringliteral">&quot;Pre-advection frazil&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%salt_deficit)) <span class="keyword">call </span>hchksum(cs%tv%salt_deficit, &amp;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                         <span class="stringliteral">&quot;Pre-advection salt deficit&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="comment">! call MOM_thermo_chksum(&quot;Pre-advection &quot;, CS%tv, G)</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Pre-advection &quot;</span>, u, v, g)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_thermo)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keyword">call </span>enable_averaging(cs%dt_trans, time_local, cs%diag)</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_tracer)</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="keyword">call </span>advect_tracer(h, cs%uhtr, cs%vhtr, cs%OBC, cs%dt_trans, g, gv, &amp;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                         cs%tracer_adv_CSp, cs%tracer_Reg)</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="keyword">call </span>tracer_hordiff(h, cs%dt_trans, cs%MEKE, cs%VarMix, g, gv, &amp;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                          cs%tracer_diff_CSp, cs%tracer_Reg, cs%tv)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_tracer)</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished tracer advection/diffusion (step_MOM)&quot;</span>)</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_z_diag)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="keyword">call </span>calculate_z_transport(cs%uhtr, cs%vhtr, h, cs%dt_trans, g, gv, &amp;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                                 cs%diag_to_Z_CSp)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_z_diag)</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keywordflow">if</span> (cs%id_u_predia &gt; 0) <span class="keyword">call </span>post_data(cs%id_u_predia, u, cs%diag)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="keywordflow">if</span> (cs%id_v_predia &gt; 0) <span class="keyword">call </span>post_data(cs%id_v_predia, v, cs%diag)</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">if</span> (cs%id_h_predia &gt; 0) <span class="keyword">call </span>post_data(cs%id_h_predia, h, cs%diag)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="keywordflow">if</span> (cs%id_T_predia &gt; 0) <span class="keyword">call </span>post_data(cs%id_T_predia, cs%tv%T, cs%diag)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">if</span> (cs%id_S_predia &gt; 0) <span class="keyword">call </span>post_data(cs%id_S_predia, cs%tv%S, cs%diag)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">if</span> (cs%id_e_predia &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keyword">call </span>find_eta(h, cs%tv, g%g_Earth, g, gv, eta_predia)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keyword">call </span>post_data(cs%id_e_predia, eta_predia, cs%diag)</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span> (thermo_does_span_coupling .and. (abs(dt_therm - cs%dt_trans) &gt; 1e-6*dt_therm)) <span class="keywordflow">then</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;step_MOM: Mismatch between dt_therm and CS%dt_trans &quot;</span>//&amp;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                       <span class="stringliteral">&quot;before call to diabatic.&quot;</span>)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (.not.cs%diabatic_first) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (.not.cs%adiabatic) <span class="keywordflow">then</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          <span class="keyword">call </span>uchksum(u,<span class="stringliteral">&quot;Pre-diabatic u&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          <span class="keyword">call </span>vchksum(v,<span class="stringliteral">&quot;Pre-diabatic v&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          <span class="keyword">call </span>hchksum(h*gv%H_to_m,<span class="stringliteral">&quot;Pre-diabatic h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;          <span class="keyword">call </span>uchksum(cs%uhtr*gv%H_to_m,<span class="stringliteral">&quot;Pre-diabatic uh&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          <span class="keyword">call </span>vchksum(cs%vhtr*gv%H_to_m,<span class="stringliteral">&quot;Pre-diabatic vh&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">! call MOM_state_chksum(&quot;Pre-diabatic &quot;,u, v, h, CS%uhtr, CS%vhtr, G, GV)</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;          <span class="keyword">call </span>mom_thermo_chksum(<span class="stringliteral">&quot;Pre-diabatic &quot;</span>, cs%tv, g,haloshift=0)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Pre-diabatic &quot;</span>, u, v, g)</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;          <span class="keyword">call </span>mom_forcing_chksum(<span class="stringliteral">&quot;Pre-diabatic&quot;</span>, fluxes, g, haloshift=0)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">if</span> (cs%split .and. cs%legacy_split) <span class="keywordflow">then</span>  <span class="comment">! The dt here is correct. -RWH</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          <span class="keyword">call </span>adjustments_dyn_legacy_split(u, v, h, dt, g, gv, cs%dyn_legacy_split_CSp)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_diabatic)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keyword">call </span>diabatic(u, v, h, cs%tv, fluxes, cs%visc, cs%ADp, cs%CDp, &amp;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                      cs%dt_trans, g, gv, cs%diabatic_CSp)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        fluxes%fluxes_used = .true.</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_diabatic)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="comment">! Regridding/remapping is done here, at the end of the thermodynamics time step</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="comment">! (that may comprise several dynamical time steps)</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="comment">! The routine &#39;ALE_main&#39; can be found in &#39;MOM_ALE.F90&#39;.</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="keywordflow">if</span> ( cs%use_ALE_algorithm ) <span class="keywordflow">then</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">!         call pass_vector(u, v, G%Domain)</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;          <span class="keyword">call </span>do_group_pass(cs%pass_T_S_h, g%Domain)</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          <span class="comment">! update squared quantities</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%S_squared)) &amp;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            cs%S_squared(:,:,:) = cs%tv%S(:,:,:) ** 2</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%T_squared)) &amp;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            cs%T_squared(:,:,:) = cs%tv%T(:,:,:) ** 2</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;          <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Pre-ALE &quot;</span>, u, v, h, cs%uh, cs%vh, g, gv)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keyword">call </span>hchksum(cs%tv%T,<span class="stringliteral">&quot;Pre-ALE T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            <span class="keyword">call </span>hchksum(cs%tv%S,<span class="stringliteral">&quot;Pre-ALE S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Pre-ALE &quot;</span>, u, v, g)</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;          <span class="keyword">call </span>cpu_clock_begin(id_clock_ale)</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;          <span class="keyword">call </span>ale_main(g, gv, h, u, v, cs%tv, cs%tracer_Reg, cs%ALE_CSp, cs%dt_trans)</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;          <span class="keyword">call </span>cpu_clock_end(id_clock_ale)</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="keyword">call </span>do_group_pass(cs%pass_uv_T_S_h, g%Domain)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordflow">if</span> (cs%debug .and.  cs%use_ALE_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;          <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Post-ALE &quot;</span>, u, v, h, cs%uh, cs%vh, g, gv)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          <span class="keyword">call </span>hchksum(cs%tv%T,<span class="stringliteral">&quot;Post-ALE 1 T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;          <span class="keyword">call </span>hchksum(cs%tv%S,<span class="stringliteral">&quot;Post-ALE 1 S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;          <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Post-ALE &quot;</span>, u, v, g)</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="comment">! Whenever thickness changes let the diag manager know, target grids</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="comment">! for vertical remapping may need to be regenerated. This needs to</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="comment">! happen after the H update and before the next post_data.</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keyword">call </span>diag_update_target_grids(cs%diag)</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keyword">call </span>post_diags_ts_vardec(g, cs, cs%dt_trans)</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          <span class="keyword">call </span>uchksum(u,<span class="stringliteral">&quot;Post-diabatic u&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;          <span class="keyword">call </span>vchksum(v,<span class="stringliteral">&quot;Post-diabatic v&quot;</span>, g, haloshift=2)</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          <span class="keyword">call </span>hchksum(h*gv%H_to_m,<span class="stringliteral">&quot;Post-diabatic h&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;          <span class="keyword">call </span>uchksum(cs%uhtr*gv%H_to_m,<span class="stringliteral">&quot;Post-diabatic uh&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;          <span class="keyword">call </span>vchksum(cs%vhtr*gv%H_to_m,<span class="stringliteral">&quot;Post-diabatic vh&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="comment">! call MOM_state_chksum(&quot;Post-diabatic &quot;, u, v, &amp;</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="comment">!                       h, CS%uhtr, CS%vhtr, G, GV, haloshift=1)</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%T)) <span class="keyword">call </span>hchksum(cs%tv%T, <span class="stringliteral">&quot;Post-diabatic T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%S)) <span class="keyword">call </span>hchksum(cs%tv%S, <span class="stringliteral">&quot;Post-diabatic S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%frazil)) <span class="keyword">call </span>hchksum(cs%tv%frazil, &amp;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                                   <span class="stringliteral">&quot;Post-diabatic frazil&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%salt_deficit)) <span class="keyword">call </span>hchksum(cs%tv%salt_deficit, &amp;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                                   <span class="stringliteral">&quot;Post-diabatic salt deficit&quot;</span>, g, haloshift=0)</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="comment">! call MOM_thermo_chksum(&quot;Post-diabatic &quot;, CS%tv, G)</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;          <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Post-diabatic &quot;</span>, u, v, g)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished diabatic (step_MOM)&quot;</span>)</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keywordflow">else</span>   <span class="comment">! complement of &quot;if (.not.CS%adiabatic)&quot;</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="keyword">call </span>cpu_clock_begin(id_clock_diabatic)</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="keyword">call </span>adiabatic(h, cs%tv, fluxes, cs%dt_trans, g, gv, cs%diabatic_CSp)</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        fluxes%fluxes_used = .true.</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        <span class="keyword">call </span>cpu_clock_end(id_clock_diabatic)</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;          <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;          <span class="keyword">call </span>do_group_pass(cs%pass_T_S, g%Domain)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;          <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;          <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%T)) <span class="keyword">call </span>hchksum(cs%tv%T, <span class="stringliteral">&quot;Post-diabatic T&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tv%S)) <span class="keyword">call </span>hchksum(cs%tv%S, <span class="stringliteral">&quot;Post-diabatic S&quot;</span>, g, haloshift=1)</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished adiabatic (step_MOM)&quot;</span>)</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="keywordflow">      endif</span> ; <span class="keywordflow">else</span>  <span class="comment">!  &quot;else branch for if (.not.CS%diabatic_first) then&quot;</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="comment">! Tracers have been advected and diffused, and need halo updates.</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">if</span> (cs%use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;          <span class="keyword">call </span>do_group_pass(cs%pass_T_S, g%Domain)</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="keywordflow">      endif</span> <span class="comment">! close of &quot;if (.not.CS%diabatic_first) then ; if (.not.CS%adiabatic)&quot;</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_thermo)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_diagnostics)</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keyword">call </span>calculate_diagnostic_fields(u, v, h, cs%uh, cs%vh, cs%tv, &amp;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                          cs%ADp, cs%CDp, fluxes, cs%dt_trans, g, gv, cs%diagnostics_CSp)</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished calculate_diagnostic_fields (step_MOM)&quot;</span>)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_diagnostics)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="comment">! post some diagnostics</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <span class="keywordflow">if</span> (cs%id_T &gt; 0) <span class="keyword">call </span>post_data(cs%id_T, cs%tv%T, cs%diag)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <span class="keywordflow">if</span> (cs%id_S &gt; 0) <span class="keyword">call </span>post_data(cs%id_S, cs%tv%S, cs%diag)</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keywordflow">if</span> (cs%id_tob &gt; 0) <span class="keyword">call </span>post_data(cs%id_tob, cs%tv%T(:,:,g%ke), cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      <span class="keywordflow">if</span> (cs%id_sob &gt; 0) <span class="keyword">call </span>post_data(cs%id_sob, cs%tv%S(:,:,g%ke), cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tadx   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tadx,   cs%T_adx,   cs%diag)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tady   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tady,   cs%T_ady,   cs%diag)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tdiffx &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tdiffx, cs%T_diffx, cs%diag)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tdiffy &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tdiffy, cs%T_diffy, cs%diag)</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sadx   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sadx,   cs%S_adx,   cs%diag)</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sady   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sady,   cs%S_ady,   cs%diag)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sdiffx &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sdiffx, cs%S_diffx, cs%diag)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sdiffy &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sdiffy, cs%S_diffy, cs%diag)</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tadx_2d   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tadx_2d,   cs%T_adx_2d,   cs%diag)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tady_2d   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tady_2d,   cs%T_ady_2d,   cs%diag)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tdiffx_2d &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tdiffx_2d, cs%T_diffx_2d, cs%diag)</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordflow">if</span> (cs%id_Tdiffy_2d &gt; 0) <span class="keyword">call </span>post_data(cs%id_Tdiffy_2d, cs%T_diffy_2d, cs%diag)</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sadx_2d   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sadx_2d,   cs%S_adx_2d,   cs%diag)</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sady_2d   &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sady_2d,   cs%S_ady_2d,   cs%diag)</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sdiffx_2d &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sdiffx_2d, cs%S_diffx_2d, cs%diag)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keywordflow">if</span> (cs%id_Sdiffy_2d &gt; 0) <span class="keyword">call </span>post_data(cs%id_Sdiffy_2d, cs%S_diffy_2d, cs%diag)</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keyword">call </span>post_diags_ts_tendency(g,gv,cs,dtdia)</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_z_diag)</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="keywordflow">if</span> (time_local + set_time(int(0.5*dt_therm)) &gt; cs%Z_diag_time) <span class="keywordflow">then</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keyword">call </span>enable_averaging(<span class="keywordtype">real(time_type_to_real(CS%Z_diag_interval))</span>, &amp;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                              cs%z_diag_time, cs%diag)</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keyword">call </span>calculate_z_diag_fields(u, v, h, cs%dt_trans, &amp;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                                     g, gv, cs%diag_to_Z_CSp)</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        cs%Z_diag_time = cs%Z_diag_time + cs%Z_diag_interval</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;finished calculate_Z_diag_fields (step_MOM)&quot;</span>)</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_z_diag)</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_thermo)</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="comment">! Reset the accumulated transports to 0.</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      cs%uhtr(:,:,:) = 0.0</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      cs%vhtr(:,:,:) = 0.0</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      cs%dt_trans = 0.0</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_thermo)</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      cs%visc%calc_bbl = .true.</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="keywordflow">    endif</span>  <span class="comment">! enddo for advection and thermo</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keyword">call </span>enable_averaging(dt,time_local, cs%diag)</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">if</span> (cs%id_u &gt; 0) <span class="keyword">call </span>post_data(cs%id_u, u, cs%diag)</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">if</span> (cs%id_v &gt; 0) <span class="keyword">call </span>post_data(cs%id_v, v, cs%diag)</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keywordflow">if</span> (cs%id_h &gt; 0) <span class="keyword">call </span>post_data(cs%id_h, h, cs%diag)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">! compute ssh, which is either eta_av for Bouss, or</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">! diagnosed ssh for non-Bouss; call &quot;find_eta&quot; for this</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">! purpose.</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    tot_wt_ssh = tot_wt_ssh + dt</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keyword">call </span>find_eta(h, cs%tv, g%g_Earth, g, gv, ssh, eta_av)</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      cs%ave_ssh(i,j) = cs%ave_ssh(i,j) + dt*ssh(i,j)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">if</span> (cs%id_ssh_inst &gt; 0) <span class="keyword">call </span>post_data(cs%id_ssh_inst, ssh, cs%diag)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;DT cycles (step_MOM)&quot;</span>)</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! complete the n loop</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_other)</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  itot_wt_ssh = 1.0/tot_wt_ssh</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    cs%ave_ssh(i,j) = cs%ave_ssh(i,j)*itot_wt_ssh</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="comment">! area mean SSH</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="keywordflow">if</span> (cs%id_ssh_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    ssh_ga = global_area_mean(cs%ave_ssh, g)</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keyword">call </span>post_data(cs%id_ssh_ga, ssh_ga, cs%diag)</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keyword">call </span>enable_averaging(dt*n_max,time_local, cs%diag)</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  i_time_int = 1.0/(dt*n_max)</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="keywordflow">if</span> (cs%id_ssh &gt; 0) &amp;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keyword">call </span>post_data(cs%id_ssh, cs%ave_ssh, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="comment">! post the dynamic sea level, zos, and zossq.</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="comment">! zos is ave_ssh with sea ice inverse barometer removed,</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="comment">! and with zero global area mean.</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keywordflow">if</span>(cs%id_zos &gt; 0 .or. cs%id_zossq &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;     <span class="keyword">allocate</span>(zos(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;     zos(:,:) = 0.0</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;     <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;       zos(i,j) = cs%ave_ssh(i,j)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="keywordflow">     enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;     <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%p_surf)) <span class="keywordflow">then</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;       <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;         zos(i,j) = zos(i,j)+g%mask2dT(i,j)*fluxes%p_surf(i,j)/(gv%Rho0 * g%g_Earth)</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;     zos_area_mean = global_area_mean(zos, g)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;     <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;       zos(i,j) = zos(i,j)-g%mask2dT(i,j)*zos_area_mean</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keywordflow">     enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;     <span class="keywordflow">if</span>(cs%id_zos &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;       <span class="keyword">call </span>post_data(cs%id_zos, zos, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;     <span class="keywordflow">if</span>(cs%id_zossq &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;       <span class="keyword">allocate</span>(zossq(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;       zossq(:,:) = 0.0</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;       <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;         zossq(i,j) = zos(i,j)*zos(i,j)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;       <span class="keyword">call </span>post_data(cs%id_zossq, zossq, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;       <span class="keyword">deallocate</span>(zossq)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;     <span class="keyword">deallocate</span>(zos)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="comment">! post total volume of the liquid ocean</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="keywordflow">if</span>(cs%id_volo &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keyword">allocate</span>(tmp(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      tmp(i,j) = g%mask2dT(i,j)*(cs%ave_ssh(i,j) + g%bathyT(i,j))</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    volo = global_area_integral(tmp, g)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keyword">call </span>post_data(cs%id_volo, volo, cs%diag)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keyword">deallocate</span>(tmp)</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="comment">! post frazil</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%frazil) .and. (cs%id_fraz &gt; 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keyword">allocate</span>(frazil_ave(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      frazil_ave(i,j) = cs%tv%frazil(i,j) * i_time_int</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keyword">call </span>post_data(cs%id_fraz, frazil_ave, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keyword">deallocate</span>(frazil_ave)</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="comment">! post the salt deficit</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%salt_deficit) .and. (cs%id_salt_deficit &gt; 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keyword">allocate</span>(salt_deficit_ave(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      salt_deficit_ave(i,j) = cs%tv%salt_deficit(i,j) * i_time_int</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keyword">call </span>post_data(cs%id_salt_deficit, salt_deficit_ave, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keyword">deallocate</span>(salt_deficit_ave)</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="comment">! post temperature of P-E+R</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%TempxPmE) .and. (cs%id_Heat_PmE &gt; 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keyword">allocate</span>(heat_pme_ave(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      heat_pme_ave(i,j) = cs%tv%TempxPmE(i,j) * (cs%tv%C_p * i_time_int)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keyword">call </span>post_data(cs%id_Heat_PmE, heat_pme_ave, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keyword">deallocate</span>(heat_pme_ave)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">! post geothermal heating or internal heat source/sinks</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%tv%internal_heat) .and. (cs%id_intern_heat &gt; 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keyword">allocate</span>(intern_heat_ave(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      intern_heat_ave(i,j) = cs%tv%internal_heat(i,j) * (cs%tv%C_p * i_time_int)</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keyword">call </span>post_data(cs%id_intern_heat, intern_heat_ave, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keyword">deallocate</span>(intern_heat_ave)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;calling calculate_surface_state (step_MOM)&quot;</span>)</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <span class="keyword">call </span>calculate_surface_state(state, u, v, h, cs%ave_ssh, g, gv, cs, &amp;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                               fluxes%p_surf_SSH)</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keyword">call </span>enable_averaging(dt*n_max,time_local, cs%diag)</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordflow">if</span> (cs%id_sst &gt; 0) &amp;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keyword">call </span>post_data(cs%id_sst, state%SST, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keywordflow">if</span> (cs%id_sst_sq &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      cs%SST_sq(i,j) = state%SST(i,j)*state%SST(i,j)</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keyword">call </span>post_data(cs%id_sst_sq, cs%SST_sq, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="keywordflow">if</span> (cs%id_sss &gt; 0) &amp;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keyword">call </span>post_data(cs%id_sss, state%SSS, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="keywordflow">if</span> (cs%id_sss_sq &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      cs%SSS_sq(i,j) = state%SSS(i,j)*state%SSS(i,j)</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keyword">call </span>post_data(cs%id_sss_sq, cs%SSS_sq, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keywordflow">  endif</span> </div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <span class="keywordflow">if</span> (cs%id_ssu &gt; 0) &amp;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keyword">call </span>post_data(cs%id_ssu, state%u, cs%diag, mask=g%mask2dCu)</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="keywordflow">if</span> (cs%id_ssv &gt; 0) &amp;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keyword">call </span>post_data(cs%id_ssv, state%v, cs%diag, mask=g%mask2dCv)</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordflow">if</span> (cs%id_speed &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="keyword">allocate</span>(sfc_speed(g%isd:g%ied,g%jsd:g%jed))</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      sfc_speed(i,j) = sqrt(0.5*(state%u(i-1,j)**2 + state%u(i,j)**2) + &amp;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                            0.5*(state%v(i,j-1)**2 + state%v(i,j)**2))</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keyword">call </span>post_data(cs%id_speed, sfc_speed, cs%diag, mask=g%mask2dT)</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="keyword">deallocate</span>(sfc_speed)</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_other)</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="keywordflow">if</span> (cs%interp_p_surf) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    cs%p_surf_prev(i,j) = fluxes%p_surf(i,j)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;step_MOM()&quot;</span>)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_ocean)</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a4c8332b095c6d295084089aa6b3b678a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a4c8332b095c6d295084089aa6b3b678a_icgraph.svg" width="236" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6cfc2cd88d60f051fe90e68c2f16b46b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::unittests </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This s/r calls unit tests for other modules. These are NOT normally invoked and so we provide the module use statments here rather than in the module header. This is an exception to our usual coding standards. Note that if a unit test returns true, a FATAL error is triggered. </p>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02116">2116</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>References <a class="el" href="../../d8/da4/MOM__neutral__diffusion_8F90_source.html#l01013">mom_neutral_diffusion::neutraldiffusionunittests()</a>, <a class="el" href="../../db/d8b/MOM__remapping_8F90_source.html#l01528">mom_remapping::remappingunittests()</a>, and <a class="el" href="../../df/ddf/MOM__string__functions_8F90_source.html#l00249">mom_string_functions::stringfunctionsunittests()</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../df/d46/namespacemom__string__functions.html">mom_string_functions</a><span class="keywordtype">,  only</span> : <a class="code" href="../../df/d46/namespacemom__string__functions.html#a0437bd522d041c26aa7175c20ca09fe5">stringfunctionsunittests</a></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../d6/d75/namespacemom__remapping.html">mom_remapping</a><span class="keywordtype">,         only</span> : <a class="code" href="../../d6/d75/namespacemom__remapping.html#aad5ec4e3f91e936e34113503d05deeeb">remappingunittests</a></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../d8/da4/namespacemom__neutral__diffusion.html">mom_neutral_diffusion</a><span class="keywordtype">, only</span> : <a class="code" href="../../d8/da4/namespacemom__neutral__diffusion.html#a72c160fad7066e2837db730c717a9ad1">neutraldiffusionunittests</a></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <span class="keywordflow">if</span> (is_root_pe()) <span class="keywordflow">then</span> <span class="comment">! The following need only be tested on 1 PE</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d46/namespacemom__string__functions.html#a0437bd522d041c26aa7175c20ca09fe5">stringfunctionsunittests</a>()) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;       <span class="stringliteral">&quot;MOM/initialize_MOM/unitTests: stringFunctionsUnitTests FAILED&quot;</span>)</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d75/namespacemom__remapping.html#aad5ec4e3f91e936e34113503d05deeeb">remappingunittests</a>()) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;       <span class="stringliteral">&quot;MOM/initialize_MOM/unitTests: remappingUnitTests FAILED&quot;</span>)</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/da4/namespacemom__neutral__diffusion.html#a72c160fad7066e2837db730c717a9ad1">neutraldiffusionunittests</a>()) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;       <span class="stringliteral">&quot;MOM/initialize_MOM/unitTests: neutralDiffusionUnitTests FAILED&quot;</span>)</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;</div><div class="ttc" id="namespacemom__remapping_html_aad5ec4e3f91e936e34113503d05deeeb"><div class="ttname"><a href="../../d6/d75/namespacemom__remapping.html#aad5ec4e3f91e936e34113503d05deeeb">mom_remapping::remappingunittests</a></div><div class="ttdeci">logical function, public remappingunittests()</div><div class="ttdoc">Runs unit tests on remapping functions. Should only be called from a single/root thread Returns True ...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d8b/MOM__remapping_8F90_source.html#l01528">MOM_remapping.F90:1528</a></div></div>
<div class="ttc" id="namespacemom__remapping_html"><div class="ttname"><a href="../../d6/d75/namespacemom__remapping.html">mom_remapping</a></div><div class="ttdoc">Provides column-wise vertical remapping functions. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d8b/MOM__remapping_8F90_source.html#l00002">MOM_remapping.F90:2</a></div></div>
<div class="ttc" id="namespacemom__string__functions_html_a0437bd522d041c26aa7175c20ca09fe5"><div class="ttname"><a href="../../df/d46/namespacemom__string__functions.html#a0437bd522d041c26aa7175c20ca09fe5">mom_string_functions::stringfunctionsunittests</a></div><div class="ttdeci">logical function, public stringfunctionsunittests()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/ddf/MOM__string__functions_8F90_source.html#l00249">MOM_string_functions.F90:249</a></div></div>
<div class="ttc" id="namespacemom__neutral__diffusion_html"><div class="ttname"><a href="../../d8/da4/namespacemom__neutral__diffusion.html">mom_neutral_diffusion</a></div><div class="ttdoc">A column-wise toolbox for implementing neutral diffusion. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da4/MOM__neutral__diffusion_8F90_source.html#l00002">MOM_neutral_diffusion.F90:2</a></div></div>
<div class="ttc" id="namespacemom__neutral__diffusion_html_a72c160fad7066e2837db730c717a9ad1"><div class="ttname"><a href="../../d8/da4/namespacemom__neutral__diffusion.html#a72c160fad7066e2837db730c717a9ad1">mom_neutral_diffusion::neutraldiffusionunittests</a></div><div class="ttdeci">logical function, public neutraldiffusionunittests()</div><div class="ttdoc">Returns true if unit tests of neutral_diffusion functions fail. Otherwise returns false...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da4/MOM__neutral__diffusion_8F90_source.html#l01013">MOM_neutral_diffusion.F90:1013</a></div></div>
<div class="ttc" id="namespacemom__string__functions_html"><div class="ttname"><a href="../../df/d46/namespacemom__string__functions.html">mom_string_functions</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/ddf/MOM__string__functions_8F90_source.html#l00001">MOM_string_functions.F90:1</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a6cfc2cd88d60f051fe90e68c2f16b46b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a6cfc2cd88d60f051fe90e68c2f16b46b_icgraph.svg" width="391" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a36275a94577312ab6200b1f5ff158805"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom::write_static_fields </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in), target&#160;</td>
          <td class="paramname"><em>diag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Offers the static fields in the ocean grid type for output via the diag_manager. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">diag</td><td>regulates diagnostic output </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02646">2646</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span> :: g<span class="comment">      !&lt; ocean grid structure</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: diag<span class="comment">   !&lt; regulates diagnostic output</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  <span class="comment">! The out_X arrays are needed because some of the elements of the grid</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  <span class="comment">! type may be reduced rank macros.</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;  <span class="keywordtype">real</span>    :: out_h(szi_(g),szj_(g))</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  <span class="keywordtype">integer</span> :: id, i, j, is, ie, js, je</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  out_h(:,:) = 0.0</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolat&#39;</span>, diag%axesT1, &amp;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        <span class="stringliteral">&#39;Latitude of tracer (T) points&#39;</span>, <span class="stringliteral">&#39;degrees_N&#39;</span>)</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLatT, diag, .true.)</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolon&#39;</span>, diag%axesT1, &amp;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        <span class="stringliteral">&#39;Longitude of tracer (T) points&#39;</span>, <span class="stringliteral">&#39;degrees_E&#39;</span>)</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLonT, diag, .true.)</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolat_c&#39;</span>, diag%axesB1, &amp;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        <span class="stringliteral">&#39;Latitude of corner (Bu) points&#39;</span>, <span class="stringliteral">&#39;degrees_N&#39;</span>)</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLatBu, diag, .true.)</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolon_c&#39;</span>, diag%axesB1, &amp;</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;        <span class="stringliteral">&#39;Longitude of corner (Bu) points&#39;</span>, <span class="stringliteral">&#39;degrees_E&#39;</span>)</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLonBu, diag, .true.)</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolat_v&#39;</span>, diag%axesCv1, &amp;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        <span class="stringliteral">&#39;Latitude of meridional velocity (Cv) points&#39;</span>, <span class="stringliteral">&#39;degrees_N&#39;</span>)</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLatCv, diag, .true.)</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolon_v&#39;</span>, diag%axesCv1, &amp;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        <span class="stringliteral">&#39;Longitude of meridional velocity (Cv) points&#39;</span>, <span class="stringliteral">&#39;degrees_E&#39;</span>)</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLonCv, diag, .true.)</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolat_u&#39;</span>, diag%axesCu1, &amp;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;        <span class="stringliteral">&#39;Latitude of zonal velocity (Cu) points&#39;</span>, <span class="stringliteral">&#39;degrees_N&#39;</span>)</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLatCu, diag, .true.)</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geolon_u&#39;</span>, diag%axesCu1, &amp;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        <span class="stringliteral">&#39;Longitude of zonal velocity (Cu) points&#39;</span>, <span class="stringliteral">&#39;degrees_E&#39;</span>)</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%geoLonCu, diag, .true.)</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;area_t&#39;</span>, diag%axesT1,   &amp;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="stringliteral">&#39;Surface area of tracer (T) cells&#39;</span>, <span class="stringliteral">&#39;m2&#39;</span>,                    &amp;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;areacello&#39;</span>, cmor_standard_name=<span class="stringliteral">&#39;cell_area&#39;</span>, &amp;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        cmor_units=<span class="stringliteral">&#39;m2&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Ocean Grid-Cell Area&#39;</span>)</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; out_h(i,j) = g%areaT(i,j) ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <span class="keyword">call </span>post_data(id, out_h, diag, .true.)</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;depth_ocean&#39;</span>, diag%axesT1,  &amp;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="stringliteral">&#39;Depth of the ocean at tracer points&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>,                      &amp;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;        standard_name=<span class="stringliteral">&#39;sea_floor_depth_below_geoid&#39;</span>,                     &amp;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;deptho&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Sea Floor Depth&#39;</span>,      &amp;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        cmor_units=<span class="stringliteral">&#39;m&#39;</span>, cmor_standard_name=<span class="stringliteral">&#39;sea_floor_depth_below_geoid&#39;</span>)</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%bathyT, diag, .true., mask=g%mask2dT)</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;wet&#39;</span>, diag%axesT1, &amp;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        <span class="stringliteral">&#39;0 if land, 1 if ocean at tracer points&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>)</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%mask2dT, diag, .true.)</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;wet_c&#39;</span>, diag%axesB1, &amp;</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <span class="stringliteral">&#39;0 if land, 1 if ocean at corner (Bu) points&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>)</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%mask2dBu, diag, .true.)</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;wet_u&#39;</span>, diag%axesCu1, &amp;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="stringliteral">&#39;0 if land, 1 if ocean at zonal velocity (Cu) points&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>)</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%mask2dCu, diag, .true.)</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;wet_v&#39;</span>, diag%axesCv1, &amp;</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;        <span class="stringliteral">&#39;0 if land, 1 if ocean at meridional velocity (Cv) points&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>)</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%mask2dCv, diag, .true.)</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;Coriolis&#39;</span>, diag%axesB1, &amp;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;        <span class="stringliteral">&#39;Coriolis parameter at corner (Bu) points&#39;</span>, <span class="stringliteral">&#39;s-1&#39;</span>)</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%CoriolisBu, diag, .true.)</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;dxt&#39;</span>, diag%axesT1, &amp;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="stringliteral">&#39;Delta(x) at thickness/tracer points (meter)&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>)</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%dxt, diag, .true.)</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;dyt&#39;</span>, diag%axesT1, &amp;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        <span class="stringliteral">&#39;Delta(y) at thickness/tracer points (meter)&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>)</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%dyt, diag, .true.)</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;dxCu&#39;</span>, diag%axesCu1, &amp;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        <span class="stringliteral">&#39;Delta(x) at u points (meter)&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>)</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%dxCu, diag, .true.)</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;dyCu&#39;</span>, diag%axesCu1, &amp;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <span class="stringliteral">&#39;Delta(y) at u points (meter)&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>)</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%dyCu, diag, .true.)</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;dxCv&#39;</span>, diag%axesCv1, &amp;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <span class="stringliteral">&#39;Delta(x) at v points (meter)&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>)</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%dxCv, diag, .true.)</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;dyCv&#39;</span>, diag%axesCv1, &amp;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        <span class="stringliteral">&#39;Delta(y) at v points (meter)&#39;</span>, <span class="stringliteral">&#39;m&#39;</span>)</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, g%dyCv, diag, .true.)</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../da/d01/namespacemom_a36275a94577312ab6200b1f5ff158805_icgraph.svg" width="435" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a722ed13d0e6d76852e680054a0e3c964"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_ale</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00399">399</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordtype">integer</span> :: id_clock_ale</div></div><!-- fragment -->
</div>
</div>
<a id="aa512b2d8dd73b02634e772701be07a87"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_continuity</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00390">390</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keywordtype">integer</span> :: id_clock_continuity  <span class="comment">! also in dynamics s/r</span></div></div><!-- fragment -->
</div>
</div>
<a id="a50edf00aa5998073d2db0360949253ba"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_diabatic</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00389">389</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keywordtype">integer</span> :: id_clock_diabatic</div></div><!-- fragment -->
</div>
</div>
<a id="aa773fddb51f99098d75304eb271270d4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_diagnostics</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00393">393</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordtype">integer</span> :: id_clock_diagnostics</div></div><!-- fragment -->
</div>
</div>
<a id="ae1cf2d523679b925a5e5baa9d974968c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_dynamics</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00386">386</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordtype">integer</span> :: id_clock_dynamics</div></div><!-- fragment -->
</div>
</div>
<a id="a7cf03c18244d0630616e925bab1841a2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_init</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00395">395</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02072">finish_mom_initialization()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordtype">integer</span> :: id_clock_init</div></div><!-- fragment -->
</div>
</div>
<a id="a41b67fabfc13e52cf3a5d1c337c780eb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_ml_restrat</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00392">392</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordtype">integer</span> :: id_clock_ml_restrat</div></div><!-- fragment -->
</div>
</div>
<a id="a4180eb85bab39df7cbb72bb8e5b19fd4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_mom_init</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00396">396</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordtype">integer</span> :: id_clock_mom_init</div></div><!-- fragment -->
</div>
</div>
<a id="a2e9f4b71ee77ba5bcb3f03a863948db3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_ocean</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00385">385</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordtype">integer</span> :: id_clock_ocean</div></div><!-- fragment -->
</div>
</div>
<a id="a283a5d32d799a3cd11113a05dcae2d56"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_other</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00400">400</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordtype">integer</span> :: id_clock_other</div></div><!-- fragment -->
</div>
</div>
<a id="a7af2f783166f32739569e4ed6ed6a98f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_pass</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00397">397</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordtype">integer</span> :: id_clock_pass       <span class="comment">! also in dynamics d/r</span></div></div><!-- fragment -->
</div>
</div>
<a id="ac4d20612cad32d412dae492fedc2e971"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_pass_init</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00398">398</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">initialize_mom()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keywordtype">integer</span> :: id_clock_pass_init  <span class="comment">! also in dynamics d/r</span></div></div><!-- fragment -->
</div>
</div>
<a id="a052256dfa3e56390f62ef3a826d62617"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_thermo</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00387">387</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordtype">integer</span> :: id_clock_thermo</div></div><!-- fragment -->
</div>
</div>
<a id="a8f5feb87a0cb40d9fcee00456e982b8a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_thick_diff</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00391">391</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordtype">integer</span> :: id_clock_thick_diff</div></div><!-- fragment -->
</div>
</div>
<a id="a0fa4debacd02de6fcd066066c232adf3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_tracer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00388">388</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordtype">integer</span> :: id_clock_tracer</div></div><!-- fragment -->
</div>
</div>
<a id="a09f2ac3470372b9ee233f4cc5a7a0da1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom::id_clock_z_diag</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00394">394</a> of file <a class="el" href="../../d8/da7/MOM_8F90_source.html">MOM.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l02481">mom_timing_init()</a>, and <a class="el" href="../../d8/da7/MOM_8F90_source.html#l00411">step_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordtype">integer</span> :: id_clock_z_diag</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../da/d01/namespacemom.html">mom</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
