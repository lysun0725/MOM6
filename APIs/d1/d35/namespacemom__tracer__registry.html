<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_tracer_registry Module Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,'Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d35/namespacemom__tracer__registry.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">mom_tracer_registry Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module contains the <a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html" title="Type to carry basic tracer information. ">tracer_registry_type</a> and the subroutines that handle registration of tracers and related subroutines. The primary subroutine, register_tracer, is called to indicate the tracers advected and diffused.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type to carry basic tracer information.  <a href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/db1/structmom__tracer__registry_1_1tracer__type.html">tracer_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The tracer type.  <a href="../../d2/db1/structmom__tracer__registry_1_1tracer__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a6a753792521378d63e3dd5ca73f3574a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#a6a753792521378d63e3dd5ca73f3574a">register_tracer</a> (tr1, tr_desc, param_file, HI, GV, Reg, tr_desc_ptr, ad_x, ad_y, df_x, df_y, OBC_inflow, OBC_in_u, OBC_in_v, ad_2d_x, ad_2d_y, df_2d_x, df_2d_y, advection_xy)</td></tr>
<tr class="memdesc:a6a753792521378d63e3dd5ca73f3574a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine registers a tracer to be advected and laterally diffused.  <a href="#a6a753792521378d63e3dd5ca73f3574a">More...</a><br /></td></tr>
<tr class="separator:a6a753792521378d63e3dd5ca73f3574a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9889848c1f3801951b0c79cace52e8d"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#af9889848c1f3801951b0c79cace52e8d">lock_tracer_registry</a> (Reg)</td></tr>
<tr class="memdesc:af9889848c1f3801951b0c79cace52e8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine locks the tracer registry to prevent the addition of more tracers. After locked=.true., can then register common diagnostics.  <a href="#af9889848c1f3801951b0c79cace52e8d">More...</a><br /></td></tr>
<tr class="separator:af9889848c1f3801951b0c79cace52e8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6210b799ee25a114d4b87bdfaa6d0c7a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#a6210b799ee25a114d4b87bdfaa6d0c7a">add_tracer_obc_values</a> (name, Reg, OBC_inflow, OBC_in_u, OBC_in_v)</td></tr>
<tr class="memdesc:a6210b799ee25a114d4b87bdfaa6d0c7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine adds open boundary condition concentrations for a tracer that has previously been registered by a call to register_tracer.  <a href="#a6210b799ee25a114d4b87bdfaa6d0c7a">More...</a><br /></td></tr>
<tr class="separator:a6210b799ee25a114d4b87bdfaa6d0c7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac008525fee272a225a19998ae437b5bf"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#ac008525fee272a225a19998ae437b5bf">add_tracer_diagnostics</a> (name, Reg, ad_x, ad_y, df_x, df_y, ad_2d_x, ad_2d_y, df_2d_x, df_2d_y, advection_xy)</td></tr>
<tr class="memdesc:ac008525fee272a225a19998ae437b5bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine adds diagnostic arrays for a tracer that has previously been registered by a call to register_tracer.  <a href="#ac008525fee272a225a19998ae437b5bf">More...</a><br /></td></tr>
<tr class="separator:ac008525fee272a225a19998ae437b5bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a019450923b54586865d9e77d044c8428"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#a019450923b54586865d9e77d044c8428">tracer_vertdiff</a> (h_old, ea, eb, dt, tr, G, GV, sfc_flux, btm_flux, btm_reservoir, sink_rate)</td></tr>
<tr class="memdesc:a019450923b54586865d9e77d044c8428"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine solves a tridiagonal equation for the final tracer concentrations after the dual-entrainments, and possibly sinking or surface and bottom sources, are applied. The sinking is implemented with an fully implicit upwind advection scheme.  <a href="#a019450923b54586865d9e77d044c8428">More...</a><br /></td></tr>
<tr class="separator:a019450923b54586865d9e77d044c8428"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad350bb834bb3dcfd6e603bb136bd8098"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#ad350bb834bb3dcfd6e603bb136bd8098">mom_tracer_chksum</a> (mesg, Tr, ntr, G)</td></tr>
<tr class="memdesc:ad350bb834bb3dcfd6e603bb136bd8098"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine writes out chksums for thermodynamic state variables.  <a href="#ad350bb834bb3dcfd6e603bb136bd8098">More...</a><br /></td></tr>
<tr class="separator:ad350bb834bb3dcfd6e603bb136bd8098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a452937bf1f9d01a47d1a80793e317b33"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#a452937bf1f9d01a47d1a80793e317b33">tracer_registry_init</a> (param_file, Reg)</td></tr>
<tr class="memdesc:a452937bf1f9d01a47d1a80793e317b33"><td class="mdescLeft">&#160;</td><td class="mdescRight">This routine include declares and sets the variable "version".  <a href="#a452937bf1f9d01a47d1a80793e317b33">More...</a><br /></td></tr>
<tr class="separator:a452937bf1f9d01a47d1a80793e317b33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaca7f6bcdb5f1d8cb247e24719d37df9"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html#aaca7f6bcdb5f1d8cb247e24719d37df9">tracer_registry_end</a> (Reg)</td></tr>
<tr class="memdesc:aaca7f6bcdb5f1d8cb247e24719d37df9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This routine closes the tracer registry module.  <a href="#aaca7f6bcdb5f1d8cb247e24719d37df9">More...</a><br /></td></tr>
<tr class="separator:aaca7f6bcdb5f1d8cb247e24719d37df9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module contains the <a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html" title="Type to carry basic tracer information. ">tracer_registry_type</a> and the subroutines that handle registration of tracers and related subroutines. The primary subroutine, register_tracer, is called to indicate the tracers advected and diffused. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ac008525fee272a225a19998ae437b5bf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::add_tracer_diagnostics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d60/version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_2d_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_2d_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_2d_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_2d_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>advection_xy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine adds diagnostic arrays for a tracer that has previously been registered by a call to register_tracer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>name of the tracer for which the diagnostic points</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to the tracer registry</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_x</td><td>diagnostic x-advective flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_y</td><td>diagnostic y-advective flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_x</td><td>diagnostic x-diffusive flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_y</td><td>diagnostic y-diffusive flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_2d_x</td><td>vert sum of diagnostic x-advect flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_2d_y</td><td>vert sum of diagnostic y-advect flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_2d_x</td><td>vert sum of diagnostic x-diffuse flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_2d_y</td><td>vert sum of diagnostic y-diffuse flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">advection_xy</td><td>convergence of lateral advective tracer fluxes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00209">209</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>References <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>

<p>Referenced by <a class="el" href="../../da/d4f/tracer__example_8F90_source.html#l00207">user_tracer_example::user_initialize_tracer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>              :: name<span class="comment">         !&lt; name of the tracer for which the diagnostic points</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>       :: reg<span class="comment">          !&lt; pointer to the tracer registry</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: ad_x<span class="comment">         !&lt; diagnostic x-advective flux (CONC m3/s or CONC*kg/s) </span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: ad_y<span class="comment">         !&lt; diagnostic y-advective flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: df_x<span class="comment">         !&lt; diagnostic x-diffusive flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: df_y<span class="comment">         !&lt; diagnostic y-diffusive flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: ad_2d_x<span class="comment">      !&lt; vert sum of diagnostic x-advect flux (CONC m3/s or CONC*kg/s) </span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: ad_2d_y<span class="comment">      !&lt; vert sum of diagnostic y-advect flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: df_2d_x<span class="comment">      !&lt; vert sum of diagnostic x-diffuse flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: df_2d_y<span class="comment">      !&lt; vert sum of diagnostic y-diffuse flux (CONC m3/s or CONC*kg/s) </span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span> :: advection_xy<span class="comment"> !&lt; convergence of lateral advective tracer fluxes  </span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordtype">integer</span> :: m</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(reg)) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;add_tracer_diagnostics: &quot;</span>// &amp;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;       <span class="stringliteral">&quot;register_tracer must be called before add_tracer_diagnostics&quot;</span>)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">do</span> m=1,reg%ntr ; <span class="keywordflow">if</span> (reg%Tr(m)%name == trim(name)) <span class="keywordflow">exit</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">if</span> (m &lt;= reg%ntr) <span class="keywordflow">then</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_x)) reg%Tr(m)%ad_x =&gt; ad_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_y)) reg%Tr(m)%ad_y =&gt; ad_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_x)) reg%Tr(m)%df_x =&gt; df_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_y)) reg%Tr(m)%df_y =&gt; df_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_2d_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_2d_x)) reg%Tr(m)%ad2d_x =&gt; ad_2d_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_2d_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_2d_y)) reg%Tr(m)%ad2d_y =&gt; ad_2d_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_2d_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_2d_x)) reg%Tr(m)%df2d_x =&gt; df_2d_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_2d_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_2d_y)) reg%Tr(m)%df2d_y =&gt; df_2d_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(advection_xy)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(advection_xy)) reg%Tr(m)%advection_xy =&gt; advection_xy ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_tracer: register_tracer must be called for &quot;</span>//&amp;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;             trim(name)//<span class="stringliteral">&quot; before add_tracer_diagnostics is called for it.&quot;</span>)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_ac008525fee272a225a19998ae437b5bf_cgraph.svg" width="494" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_ac008525fee272a225a19998ae437b5bf_icgraph.svg" width="323" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6210b799ee25a114d4b87bdfaa6d0c7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::add_tracer_obc_values </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d60/version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>OBC_inflow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>OBC_in_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>OBC_in_v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine adds open boundary condition concentrations for a tracer that has previously been registered by a call to register_tracer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>tracer name for which the diagnostic points</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to the tracer registry</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">obc_inflow</td><td>tracer value for all inflows via the OBC for which OBC_in_u or OBC_in_v are not specified (same units as tracer CONC)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc_in_u</td><td>tracer at inflows through u-face of tracer cells (same units as tracer CONC)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc_in_v</td><td>tracer at inflows through v-face of tracer cells (same units as tracer CONC) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00173">173</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>References <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/da9/MOM__state__initialization_8F90_source.html#l01526">mom_state_initialization::set_open_bdry_conds()</a>, and <a class="el" href="../../da/d4f/tracer__example_8F90_source.html#l00207">user_tracer_example::user_initialize_tracer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>               :: name<span class="comment">        !&lt; tracer name for which the diagnostic points </span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>        :: reg<span class="comment">         !&lt; pointer to the tracer registry</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span>                 :: obc_inflow<span class="comment">  !&lt; tracer value for all inflows via the OBC</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">                                                            !! for which OBC_in_u or OBC_in_v are</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">                                                            !! not specified (same units as tracer CONC) </span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>  :: obc_in_u<span class="comment">    !&lt; tracer at inflows through u-face of tracer cells</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">                                                            !! (same units as tracer CONC)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>  :: obc_in_v<span class="comment">    !&lt; tracer at inflows through v-face of tracer cells</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">                                                            !! (same units as tracer CONC)</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">integer</span> :: m</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(reg)) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;add_tracer_OBC_values :&quot;</span>// &amp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;       <span class="stringliteral">&quot;register_tracer must be called before add_tracer_OBC_values&quot;</span>)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">do</span> m=1,reg%ntr ; <span class="keywordflow">if</span> (reg%Tr(m)%name == trim(name)) <span class="keywordflow">exit</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">if</span> (m &lt;= reg%ntr) <span class="keywordflow">then</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_inflow)) reg%Tr(m)%OBC_inflow_conc = obc_inflow</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_in_u)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc_in_u)) &amp;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                      reg%Tr(m)%OBC_in_u =&gt; obc_in_u ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_in_v)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc_in_v)) &amp;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                      reg%Tr(m)%OBC_in_v =&gt; obc_in_v ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_tracer: register_tracer must be called for &quot;</span>//&amp;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;             trim(name)//<span class="stringliteral">&quot; before add_tracer_OBC_values is called for it.&quot;</span>)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_a6210b799ee25a114d4b87bdfaa6d0c7a_cgraph.svg" width="494" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_a6210b799ee25a114d4b87bdfaa6d0c7a_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="af9889848c1f3801951b0c79cace52e8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::lock_tracer_registry </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine locks the tracer registry to prevent the addition of more tracers. After locked=.true., can then register common diagnostics. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">reg</td><td>pointer to the tracer registry </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00160">160</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>References <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>

<p>Referenced by <a class="el" href="../../d8/da7/MOM_8F90_source.html#l01360">mom::initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>    :: reg<span class="comment">    !&lt; pointer to the tracer registry</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(reg)) <span class="keyword">call </span>mom_error(warning, &amp;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="stringliteral">&quot;lock_tracer_registry called with an unassocaited registry.&quot;</span>)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  reg%locked = .true.</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_af9889848c1f3801951b0c79cace52e8d_cgraph.svg" width="476" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_af9889848c1f3801951b0c79cace52e8d_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad350bb834bb3dcfd6e603bb136bd8098"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::mom_tracer_chksum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d60/version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>mesg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../d2/db1/structmom__tracer__registry_1_1tracer__type.html">tracer_type</a>), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>Tr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ntr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine writes out chksums for thermodynamic state variables. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mesg</td><td>message that appears on the chksum lines</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tr</td><td>array of all of registered tracers</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ntr</td><td>number of registered tracers</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00426">426</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d7/dbb/MOM__tracer__hor__diff_8F90_source.html#l00086">mom_tracer_hor_diff::tracer_hordiff()</a>.</p>
<div class="fragment"><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordtype">character(len=*)</span>,         <span class="keywordtype">intent(in)</span> :: mesg<span class="comment">   !&lt; message that appears on the chksum lines</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordtype">type</span>(tracer_type),        <span class="keywordtype">intent(in)</span> :: tr(:)<span class="comment">  !&lt; array of all of registered tracers</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(in)</span> :: ntr<span class="comment">    !&lt; number of registered tracers</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),    <span class="keywordtype">intent(in)</span> :: g<span class="comment">      !&lt; ocean grid structure </span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je, nz, m</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">do</span> m=1,ntr</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keyword">call </span>hchksum(tr(m)%t, mesg//trim(tr(m)%name), g)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_ad350bb834bb3dcfd6e603bb136bd8098_icgraph.svg" width="310" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6a753792521378d63e3dd5ca73f3574a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::register_tracer </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(hi),szj_(hi),szk_(gv)), target&#160;</td>
          <td class="paramname"><em>tr1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(vardesc), intent(in)&#160;</td>
          <td class="paramname"><em>tr_desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(vardesc), optional, target&#160;</td>
          <td class="paramname"><em>tr_desc_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>OBC_inflow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>OBC_in_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>OBC_in_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_2d_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>ad_2d_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_2d_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>df_2d_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>advection_xy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine registers a tracer to be advected and laterally diffused. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hi</td><td>horizontal index type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tr1</td><td>pointer to the tracer (concentration units)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tr_desc</td><td>metadata about the tracer</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>file to parse for model parameter values</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to the tracer registry</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tr_desc_ptr</td><td>A target that can be used to set a pointer to the stored value of trtr_desc. This target must be an enduring part of the control structure, because the tracer registry will use this memory, but it also means that any updates to this structure in the calling module will be available subsequently to the tracer registry.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_x</td><td>diagnostic x-advective flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_y</td><td>diagnostic y-advective flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_x</td><td>diagnostic x-diffusive flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_y</td><td>diagnostic y-diffusive flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">obc_inflow</td><td>the tracer for all inflows via OBC for which OBC_in_u or OBC_in_v are not specified (units of tracer CONC)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc_in_u</td><td>tracer at inflows through u-faces of tracer cells (units of tracer CONC)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc_in_v</td><td>tracer at inflows through v-faces of tracer cells (units of tracer CONC)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_2d_x</td><td>vert sum of diagnostic x-advect flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ad_2d_y</td><td>vert sum of diagnostic y-advect flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_2d_x</td><td>vert sum of diagnostic x-diffuse flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">df_2d_y</td><td>vert sum of diagnostic y-diffuse flux (CONC m3/s or CONC*kg/s)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">advection_xy</td><td>convergence of lateral advective tracer fluxes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00080">80</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>References <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00616">mom_io::query_vardesc()</a>, and <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00443">tracer_registry_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),           <span class="keywordtype">intent(in)</span>    :: hi<span class="comment">           !&lt; horizontal index type </span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),        <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">           !&lt; ocean vertical grid structure </span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(HI),SZJ_(HI),SZK_(GV))</span>, <span class="keywordtype">target</span> :: tr1<span class="comment">    !&lt; pointer to the tracer (concentration units)</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">type</span>(vardesc),         <span class="keywordtype">intent(in)</span>             :: tr_desc<span class="comment">      !&lt; metadata about the tracer</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordtype">type</span>(param_file_type), <span class="keywordtype">intent(in)</span>             :: param_file<span class="comment">   !&lt; file to parse for  model parameter values</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>           :: reg<span class="comment">          !&lt; pointer to the tracer registry</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">type</span>(vardesc), <span class="keywordtype">target</span>, <span class="keywordtype">optional</span>               :: tr_desc_ptr<span class="comment">  !&lt; A target that can be used to set a pointer to the</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">                                                                !! stored value of tr%tr_desc.  This target must be an</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">                                                                !! enduring part of the control structure, because the tracer</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">                                                                !! registry will use this memory, but it also means that any</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">                                                                !! updates to this structure in the calling module will be</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">                                                                !! available subsequently to the tracer registry.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: ad_x<span class="comment">         !&lt; diagnostic x-advective flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: ad_y<span class="comment">         !&lt; diagnostic y-advective flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: df_x<span class="comment">         !&lt; diagnostic x-diffusive flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: df_y<span class="comment">         !&lt; diagnostic y-diffusive flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">intent(in)</span>,                <span class="keywordtype">optional</span>     :: obc_inflow<span class="comment">   !&lt; the tracer for all inflows via OBC for which OBC_in_u </span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">                                                                !! or OBC_in_v are not specified (units of tracer CONC)</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: obc_in_u<span class="comment">     !&lt; tracer at inflows through u-faces of</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">                                                                !! tracer cells (units of tracer CONC) </span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: obc_in_v<span class="comment">     !&lt; tracer at inflows through v-faces of</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">                                                                !! tracer cells (units of tracer CONC)</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span>     :: ad_2d_x<span class="comment">      !&lt; vert sum of diagnostic x-advect flux (CONC m3/s or CONC*kg/s) </span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span>     :: ad_2d_y<span class="comment">      !&lt; vert sum of diagnostic y-advect flux (CONC m3/s or CONC*kg/s)</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span>     :: df_2d_x<span class="comment">      !&lt; vert sum of diagnostic x-diffuse flux (CONC m3/s or CONC*kg/s)  </span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">pointer</span>, <span class="keywordtype">optional</span>     :: df_2d_y<span class="comment">      !&lt; vert sum of diagnostic y-diffuse flux (CONC m3/s or CONC*kg/s) </span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">optional</span>     :: advection_xy<span class="comment"> !&lt; convergence of lateral advective tracer fluxes  </span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">integer</span> :: ntr</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordtype">type</span>(tracer_type) :: temp</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(reg)) <span class="keyword">call </span>tracer_registry_init(param_file, reg)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (reg%ntr&gt;=max_fields_) <span class="keywordflow">then</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Increase MAX_FIELDS_ in MOM_memory.h to at least &quot;,I3,&quot; to allow for &amp;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral"></span><span class="stringliteral">        &amp;all the tracers being registered via register_tracer.&quot;)&#39;</span>) reg%ntr+1</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM register_tracer: &quot;</span>//mesg)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  reg%ntr = reg%ntr + 1</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  ntr     = reg%ntr</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(tr_desc_ptr)) <span class="keywordflow">then</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    reg%Tr(ntr)%vd =&gt; tr_desc_ptr</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">allocate</span>(reg%Tr(ntr)%vd) ; reg%Tr(ntr)%vd = tr_desc</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keyword">call </span>query_vardesc(reg%Tr(ntr)%vd, name=reg%Tr(ntr)%name)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (reg%locked) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="stringliteral">&quot;MOM register_tracer was called for variable &quot;</span>//trim(reg%Tr(ntr)%name)//&amp;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="stringliteral">&quot; with a locked tracer registry.&quot;</span>)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  reg%Tr(ntr)%t =&gt; tr1</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_x)) reg%Tr(ntr)%ad_x =&gt; ad_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_y)) reg%Tr(ntr)%ad_y =&gt; ad_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_x)) reg%Tr(ntr)%df_x =&gt; df_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_y)) reg%Tr(ntr)%df_y =&gt; df_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_inflow)) reg%Tr(ntr)%OBC_inflow_conc = obc_inflow</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_in_u)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc_in_u)) &amp;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                    reg%Tr(ntr)%OBC_in_u =&gt; obc_in_u ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_in_v)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc_in_v)) &amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                                    reg%Tr(ntr)%OBC_in_v =&gt; obc_in_v ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_2d_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_2d_x)) reg%Tr(ntr)%ad2d_x =&gt; ad_2d_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(ad_2d_y)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ad_2d_y)) reg%Tr(ntr)%ad2d_y =&gt; ad_2d_y ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(df_2d_x)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(df_2d_x)) reg%Tr(ntr)%df2d_x =&gt; df_2d_x ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(advection_xy)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(advection_xy)) reg%Tr(ntr)%advection_xy =&gt; advection_xy ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_a6a753792521378d63e3dd5ca73f3574a_cgraph.svg" width="100%" height="402"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aaca7f6bcdb5f1d8cb247e24719d37df9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::tracer_registry_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This routine closes the tracer registry module. </p>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00470">470</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span> :: reg</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(reg)) <span class="keyword">deallocate</span>(reg)</div></div><!-- fragment -->
</div>
</div>
<a id="a452937bf1f9d01a47d1a80793e317b33"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::tracer_registry_init </td>
          <td>(</td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/df4/structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This routine include declares and sets the variable "version". </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>open file to parse for model parameters</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to tracer registry </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00443">443</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00080">register_tracer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; open file to parse for model parameters</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>    :: reg<span class="comment">        !&lt; pointer to tracer registry </span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: init_calls = 0</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mod = <span class="stringliteral">&quot;MOM_tracer_registry&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(reg)) <span class="keywordflow">then</span> ; <span class="keyword">allocate</span>(reg)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">else</span> ; <span class="keywordflow">return</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">call </span>log_version(param_file, mod, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  init_calls = init_calls + 1</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">if</span> (init_calls &gt; 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;tracer_registry_init called &quot;,I3, &amp;</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="stringliteral"></span><span class="stringliteral">      &amp;&quot; times with different registry pointers.&quot;)&#39;</span>) init_calls</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (is_root_pe()) <span class="keyword">call </span>mom_error(warning,<span class="stringliteral">&quot;MOM_tracer&quot;</span>//mesg)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_a452937bf1f9d01a47d1a80793e317b33_icgraph.svg" width="302" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a019450923b54586865d9e77d044c8428"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_tracer_registry::tracer_vertdiff </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(in)&#160;</td>
          <td class="paramname"><em>h_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(in)&#160;</td>
          <td class="paramname"><em>ea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(in)&#160;</td>
          <td class="paramname"><em>eb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(inout)&#160;</td>
          <td class="paramname"><em>tr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(in), optional&#160;</td>
          <td class="paramname"><em>sfc_flux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(in), optional&#160;</td>
          <td class="paramname"><em>btm_flux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(inout), optional&#160;</td>
          <td class="paramname"><em>btm_reservoir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>sink_rate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine solves a tridiagonal equation for the final tracer concentrations after the dual-entrainments, and possibly sinking or surface and bottom sources, are applied. The sinking is implemented with an fully implicit upwind advection scheme. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_old</td><td>layer thickness before entrainment (m or kg m-2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ea</td><td>amount of fluid entrained from the layer above (units of h_old)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eb</td><td>amount of fluid entrained from the layer below (units of h_old)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tr</td><td>tracer concentration (in concentration units CU)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>amount of time covered by this call (seconds)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sfc_flux</td><td>surface flux of the tracer (in CU * kg m-2 s-1)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">btm_flux</td><td>The (negative upward) bottom flux of the tracer, in units of (CU * kg m-2 s-1)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">btm_reservoir</td><td>amount of tracer in a bottom reservoir (units of CU kg m-2; formerly CU m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sink_rate</td><td>rate at which the tracer sinks, in m s-1 </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html#l00257">257</a> of file <a class="el" href="../../d9/d8f/MOM__tracer__registry_8F90_source.html">MOM_tracer_registry.F90</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d5a/ideal__age__example_8F90_source.html#l00416">ideal_age_example::ideal_age_tracer_column_physics()</a>, and <a class="el" href="../../d1/d2b/MOM__OCMIP2__CFC_8F90_source.html#l00528">mom_ocmip2_cfc::ocmip2_cfc_column_physics()</a>.</p>
<div class="fragment"><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: g<span class="comment">             !&lt; ocean grid structure </span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                   <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">            !&lt; ocean vertical grid structure </span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(in)</span>    :: h_old<span class="comment">         !&lt; layer thickness before entrainment (m or kg m-2)</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(in)</span>    :: ea<span class="comment">            !&lt; amount of fluid entrained from the layer above (units of h_old)</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(in)</span>    :: eb<span class="comment">            !&lt; amount of fluid entrained from the layer below (units of h_old)</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: tr<span class="comment">            !&lt; tracer concentration (in concentration units CU)</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">real</span>,                                      <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">            !&lt; amount of time covered by this call (seconds)</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">optional</span>,<span class="keywordtype">intent(in)</span>    :: sfc_flux<span class="comment">      !&lt; surface flux of the tracer (in CU * kg m-2 s-1)</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">optional</span>,<span class="keywordtype">intent(in)</span>    :: btm_flux<span class="comment">      !&lt; The (negative upward) bottom flux of the tracer,</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">                                                                            !! in units of (CU * kg m-2 s-1)</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">optional</span>,<span class="keywordtype">intent(inout)</span> :: btm_reservoir<span class="comment"> !&lt; amount of tracer in a bottom reservoir (units of CU kg m-2; formerly CU m)</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">real</span>,                             <span class="keywordtype">optional</span>,<span class="keywordtype">intent(in)</span>    :: sink_rate<span class="comment">     !&lt; rate at which the tracer sinks, in m s-1</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordtype">real</span> :: sink_dist <span class="comment">! The distance the tracer sinks in a time step, in m or kg m-2.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    sfc_src, &amp;      <span class="comment">! The time-integrated surface source of the tracer, in</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    <span class="comment">! units of m or kg m-2 times a concentration.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    btm_src         <span class="comment">! The time-integrated bottom source of the tracer, in</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    <span class="comment">! units of m or kg m-2  times a concentration.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span> :: &amp;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    b1, &amp;           <span class="comment">! b1 is used by the tridiagonal solver, in m-1 or m2 kg-1.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    d1              <span class="comment">! d1=1-c1 is used by the tridiagonal solver, nondimensional.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">real</span> :: c1(szi_(g),szk_(gv))    <span class="comment">! c1 is used by the tridiagonal solver, ND.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">real</span> :: h_minus_dsink(szi_(g),szk_(gv)) <span class="comment">! The layer thickness minus the</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="comment">! difference in sinking rates across the layer, in m or kg m-2.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    <span class="comment">! By construction, 0 &lt;= h_minus_dsink &lt; h_old.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">real</span> :: sink(szi_(g),szk_(gv)+1) <span class="comment">! The tracer&#39;s sinking distances at the</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <span class="comment">! interfaces, limited to prevent characteristics from</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    <span class="comment">! crossing within a single timestep, in m or kg m-2.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">real</span> :: b_denom_1 <span class="comment">! The first term in the denominator of b1, in m or kg m-2.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">real</span> :: h_tr      <span class="comment">! h_tr is h at tracer points with a h_neglect added to</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    <span class="comment">! ensure positive definiteness, in m or kg m-2.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">real</span> :: h_neglect <span class="comment">! A thickness that is so small it is usually lost</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                    <span class="comment">! in roundoff and can be neglected, in m.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  h_neglect = gv%H_subroundoff</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  sink_dist = 0.0</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(sink_rate)) sink_dist = (dt*sink_rate) * gv%m_to_H</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!$OMP parallel default(none) shared(is,ie,js,je,sfc_src,btm_src,sfc_flux,dt,G,GV,btm_flux, &amp;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!$OMP                               sink_rate,btm_reservoir,nz,sink_dist,h_old,ea,      &amp;</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">!$OMP                               h_neglect,eb,tr) &amp; </span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">!$OMP                       private(sink,h_minus_dsink,b_denom_1,b1,d1,h_tr,c1)</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">do</span> j=js,je; <span class="keywordflow">do</span> i=is,ie ; sfc_src(i,j) = 0.0 ; btm_src(i,j) = 0.0 ; enddo;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(sfc_flux)) <span class="keywordflow">then</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">!$OMP do </span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;     <span class="keywordflow">do</span> j = js, je; <span class="keywordflow">do</span> i = is,ie</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        sfc_src(i,j) = (sfc_flux(i,j)*dt) * gv%kg_m2_to_H</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="keyword">     end</span>do; enddo</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(btm_flux)) <span class="keywordflow">then</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;     <span class="keywordflow">do</span> j = js, je; <span class="keywordflow">do</span> i = is,ie</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        btm_src(i,j) = (btm_flux(i,j)*dt) * gv%kg_m2_to_H</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keyword">     end</span>do; enddo</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(sink_rate)) <span class="keywordflow">then</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">! Find the sinking rates at all interfaces, limiting them if necesary</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="comment">! so that the characteristics do not cross within a timestep.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">!   If a non-constant sinking rate were used, that would be incorprated</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="comment">! here.</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(btm_reservoir)) <span class="keywordflow">then</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">do</span> i=is,ie ; sink(i,nz+1) = sink_dist ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">do</span> k=2,nz ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;          sink(i,k) = sink_dist ; h_minus_dsink(i,k) = h_old(i,j,k)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">do</span> i=is,ie ; sink(i,nz+1) = 0.0 ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">! Find the limited sinking distance at the interfaces.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">do</span> k=nz,2,-1 ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <span class="keywordflow">if</span> (sink(i,k+1) &gt;= sink_dist) <span class="keywordflow">then</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            sink(i,k) = sink_dist</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            h_minus_dsink(i,k) = h_old(i,j,k) + (sink(i,k+1) - sink(i,k))</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          <span class="keywordflow">elseif</span> (sink(i,k+1) + h_old(i,j,k) &lt; sink_dist) <span class="keywordflow">then</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            sink(i,k) = sink(i,k+1) + h_old(i,j,k)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            h_minus_dsink(i,k) = 0.0</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            sink(i,k) = sink_dist</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            h_minus_dsink(i,k) = (h_old(i,j,k) + sink(i,k+1)) - sink(i,k)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        sink(i,1) = 0.0 ; h_minus_dsink(i,1) = (h_old(i,j,1) + sink(i,2))</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="comment">! Now solve the tridiagonal equation for the tracer concentrations.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        b_denom_1 = h_minus_dsink(i,1) + ea(i,j,1) + h_neglect</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        b1(i) = 1.0 / (b_denom_1 + eb(i,j,1))</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        d1(i) = b_denom_1 * b1(i)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        h_tr = h_old(i,j,1) + h_neglect</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        tr(i,j,1) = b1(i)*(h_tr*tr(i,j,1) + sfc_src(i,j))</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">do</span> k=2,nz-1 ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        c1(i,k) = eb(i,j,k-1) * b1(i)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        b_denom_1 = h_minus_dsink(i,k) + d1(i) * (ea(i,j,k) + sink(i,k)) + &amp;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    h_neglect</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        b1(i) = 1.0 / (b_denom_1 + eb(i,j,k))</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        d1(i) = b_denom_1 * b1(i)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        h_tr = h_old(i,j,k) + h_neglect</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        tr(i,j,k) = b1(i) * (h_tr * tr(i,j,k) + &amp;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                             (ea(i,j,k) + sink(i,k)) * tr(i,j,k-1))</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        c1(i,nz) = eb(i,j,nz-1) * b1(i)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        b_denom_1 = h_minus_dsink(i,nz) + d1(i) * (ea(i,j,nz) + sink(i,nz)) + &amp;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    h_neglect</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        b1(i) = 1.0 / (b_denom_1 + eb(i,j,nz))</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        h_tr = h_old(i,j,nz) + h_neglect</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        tr(i,j,nz) = b1(i) * ((h_tr * tr(i,j,nz) + btm_src(i,j)) + &amp;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                              (ea(i,j,nz) + sink(i,nz)) * tr(i,j,nz-1))</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(btm_reservoir)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        btm_reservoir(i,j) = btm_reservoir(i,j) + &amp;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                             (sink(i,nz+1)*tr(i,j,nz)) * gv%H_to_kg_m2</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keywordflow">do</span> k=nz-1,1,-1 ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        tr(i,j,k) = tr(i,j,k) + c1(i,k+1)*tr(i,j,k+1)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">!$OMP do </span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        h_tr = h_old(i,j,1) + h_neglect</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        b_denom_1 = h_tr + ea(i,j,1)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        b1(i) = 1.0 / (b_denom_1 + eb(i,j,1))</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        d1(i) = b_denom_1 * b1(i)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        tr(i,j,1) = b1(i)*(h_tr*tr(i,j,1) + sfc_src(i,j))</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordflow">       endif</span> </div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">do</span> k=2,nz-1 ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        c1(i,k) = eb(i,j,k-1) * b1(i)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        h_tr = h_old(i,j,k) + h_neglect</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        b_denom_1 = h_tr + d1(i) * ea(i,j,k)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        b1(i) = 1.0 / (b_denom_1 + eb(i,j,k))</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        d1(i) = b_denom_1 * b1(i)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        tr(i,j,k) = b1(i) * (h_tr * tr(i,j,k) + ea(i,j,k) * tr(i,j,k-1))</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        c1(i,nz) = eb(i,j,nz-1) * b1(i)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        h_tr = h_old(i,j,nz) + h_neglect</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        b1(i) = 1.0 / (h_tr + d1(i) * ea(i,j,nz) + eb(i,j,nz))</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        tr(i,j,nz) = b1(i) * ((h_tr * tr(i,j,nz) + btm_src(i,j)) + &amp;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                              ea(i,j,nz) * tr(i,j,nz-1))</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">do</span> k=nz-1,1,-1 ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        tr(i,j,k) = tr(i,j,k) + c1(i,k+1)*tr(i,j,k+1)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">!$OMP end parallel</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d1/d35/namespacemom__tracer__registry_a019450923b54586865d9e77d044c8428_icgraph.svg" width="326" height="132"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d1/d35/namespacemom__tracer__registry.html">mom_tracer_registry</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
