<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_dynamics_split_rk2 Module Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,'Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/dc3/namespacemom__dynamics__split__rk2.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_dynamics_split_rk2 Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Time step the adiabatic dynamic core of MOM using RK2 method.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d35/structmom__dynamics__split__rk2_1_1mom__dyn__split__rk2__cs.html">mom_dyn_split_rk2_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Module control structure.  <a href="../../df/d35/structmom__dynamics__split__rk2_1_1mom__dyn__split__rk2__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a81cce65643a8cf94979d68354a9a1979"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a81cce65643a8cf94979d68354a9a1979">step_mom_dyn_split_rk2</a> (u, v, h, tv, visc, Time_local, dt, fluxes, p_surf_begin, p_surf_end, dt_since_flux, dt_therm, uh, vh, uhtr, vhtr, eta_av, G, GV, CS, calc_dtbt, VarMix, MEKE)</td></tr>
<tr class="memdesc:a81cce65643a8cf94979d68354a9a1979"><td class="mdescLeft">&#160;</td><td class="mdescRight">RK2 splitting for time stepping MOM adiabatic dynamics.  <a href="#a81cce65643a8cf94979d68354a9a1979">More...</a><br /></td></tr>
<tr class="separator:a81cce65643a8cf94979d68354a9a1979"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f889b82fd5ed29a854da99d3c929366"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a9f889b82fd5ed29a854da99d3c929366">register_restarts_dyn_split_rk2</a> (HI, GV, param_file, CS, restart_CS, uh, vh)</td></tr>
<tr class="memdesc:a9f889b82fd5ed29a854da99d3c929366"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine sets up any auxiliary restart variables that are specific to the unsplit time stepping scheme. All variables registered here should have the ability to be recreated if they are not present in a restart file.  <a href="#a9f889b82fd5ed29a854da99d3c929366">More...</a><br /></td></tr>
<tr class="separator:a9f889b82fd5ed29a854da99d3c929366"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bae09afc9136333ab281704dc9d9415"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a3bae09afc9136333ab281704dc9d9415">initialize_dyn_split_rk2</a> (u, v, h, uh, vh, eta, Time, G, GV, param_file, diag, CS, restart_CS, dt, Accel_diag, Cont_diag, MIS, VarMix, MEKE, OBC, ALE_CSp, setVisc_CSp, visc, dirs, ntrunc)</td></tr>
<tr class="memdesc:a3bae09afc9136333ab281704dc9d9415"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine initializes all of the variables that are used by this dynamic core, including diagnostics and the cpu clocks.  <a href="#a3bae09afc9136333ab281704dc9d9415">More...</a><br /></td></tr>
<tr class="separator:a3bae09afc9136333ab281704dc9d9415"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dedc57e0443d33d9713aa987de22564"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a2dedc57e0443d33d9713aa987de22564">end_dyn_split_rk2</a> (CS)</td></tr>
<tr class="memdesc:a2dedc57e0443d33d9713aa987de22564"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close the dyn_split_RK2 module.  <a href="#a2dedc57e0443d33d9713aa987de22564">More...</a><br /></td></tr>
<tr class="separator:a2dedc57e0443d33d9713aa987de22564"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad3884ecee0a084445790d44528ac6dac"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#ad3884ecee0a084445790d44528ac6dac">id_clock_cor</a></td></tr>
<tr class="separator:ad3884ecee0a084445790d44528ac6dac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d8b6d38a0e7724afacfa6913ae739ae"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a9d8b6d38a0e7724afacfa6913ae739ae">id_clock_pres</a></td></tr>
<tr class="separator:a9d8b6d38a0e7724afacfa6913ae739ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfd11d4aebbf6b14f39077090f56ef5b"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#acfd11d4aebbf6b14f39077090f56ef5b">id_clock_vertvisc</a></td></tr>
<tr class="separator:acfd11d4aebbf6b14f39077090f56ef5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a01bde62f65f6600cce148448abdfbe"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a1a01bde62f65f6600cce148448abdfbe">id_clock_horvisc</a></td></tr>
<tr class="separator:a1a01bde62f65f6600cce148448abdfbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ff3a37691e3acc35039962cf6b2fdaa"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a7ff3a37691e3acc35039962cf6b2fdaa">id_clock_mom_update</a></td></tr>
<tr class="separator:a7ff3a37691e3acc35039962cf6b2fdaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86ec3d9ffc9d19a3fd8c552970a9e551"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a86ec3d9ffc9d19a3fd8c552970a9e551">id_clock_continuity</a></td></tr>
<tr class="separator:a86ec3d9ffc9d19a3fd8c552970a9e551"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15db1d2e90277d772fdb192e2137a668"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a15db1d2e90277d772fdb192e2137a668">id_clock_thick_diff</a></td></tr>
<tr class="separator:a15db1d2e90277d772fdb192e2137a668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ce197eb3f285e6c96fcbcf109fa52b4"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a2ce197eb3f285e6c96fcbcf109fa52b4">id_clock_btstep</a></td></tr>
<tr class="separator:a2ce197eb3f285e6c96fcbcf109fa52b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1156e9ac0a7338e196c5eb018cb21262"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a1156e9ac0a7338e196c5eb018cb21262">id_clock_btcalc</a></td></tr>
<tr class="separator:a1156e9ac0a7338e196c5eb018cb21262"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82edb8c495c4b87e86a1536b5e64e0bd"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a82edb8c495c4b87e86a1536b5e64e0bd">id_clock_btforce</a></td></tr>
<tr class="separator:a82edb8c495c4b87e86a1536b5e64e0bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0a9bda16164c51889e836534aa290fa"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#ae0a9bda16164c51889e836534aa290fa">id_clock_pass</a></td></tr>
<tr class="separator:ae0a9bda16164c51889e836534aa290fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39c9d62531c00323c3b2ed559902a460"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html#a39c9d62531c00323c3b2ed559902a460">id_clock_pass_init</a></td></tr>
<tr class="separator:a39c9d62531c00323c3b2ed559902a460"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Time step the adiabatic dynamic core of MOM using RK2 method. </p>
<p>This file time steps the adiabatic dynamic core by splitting between baroclinic and barotropic modes. It uses a pseudo-second order Runge-Kutta time stepping scheme for the baroclinic momentum equation and a forward-backward coupling between the baroclinic momentum and continuity equations. This split time-stepping scheme is described in detail in Hallberg (JCP, 1997). Additional issues related to exact tracer conservation and how to ensure consistency between the barotropic and layered estimates of the free surface height are described in Hallberg and Adcroft (Ocean Modelling, 2009). This was the time stepping code that is used for most GOLD applications, including GFDL's ESM2G Earth system model, and all of the examples provided with the MOM code (although several of these solutions are routinely verified by comparison with the slower unsplit schemes).</p>
<p>The subroutine step_MOM_dyn_split_RK2 actually does the time stepping, while register_restarts_dyn_split_RK2 sets the fields that are found in a full restart file with this scheme, and initialize_dyn_split_RK2 initializes the cpu clocks that are used in this module. For largely historical reasons, this module does not have its own control structure, but shares the same control structure with <a class="el" href="../../d8/da7/MOM_8F90.html">MOM.F90</a> and the other MOM_dynamics_... modules.</p>
<p>Macros written all in capital letters are defined in MOM_memory.h.</p>
<h1><a class="anchor" id="section_gridlayout"></a>
MOM grid layout</h1>
<p>A small fragment of the grid is shown below:</p>
<pre class="fragment">    j+1  x ^ x ^ x

    j+1  &gt; o &gt; o &gt;

    j    x ^ x ^ x

    j    &gt; o &gt; o &gt;

    j-1  x ^ x ^ x

        i-1  i  i+1

           i  i+1</pre><p>Fields at each point</p><ul>
<li>x = q, CoriolisBu</li>
<li>^ = v, PFv, CAv, vh, diffv, tauy, vbt, vhtr</li>
<li>&gt; = u, PFu, CAu, uh, diffu, taux, ubt, uhtr</li>
<li>o = h, bathyT, eta, T, S, tr</li>
</ul>
<p>The boundaries always run through q grid points (x). </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a2dedc57e0443d33d9713aa987de22564"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_dynamics_split_rk2::end_dyn_split_rk2 </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="../../df/d35/structmom__dynamics__split__rk2_1_1mom__dyn__split__rk2__cs.html">mom_dyn_split_rk2_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close the dyn_split_RK2 module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>module control structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01255">1255</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordtype">type</span>(mom_dyn_split_rk2_cs), <span class="keywordtype">pointer</span> :: cs<span class="comment">  !&lt; module control structure</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  dealloc_(cs%diffu) ; dealloc_(cs%diffv)</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  dealloc_(cs%CAu)   ; dealloc_(cs%CAv)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  dealloc_(cs%PFu)   ; dealloc_(cs%PFv)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%taux_bot)) <span class="keyword">deallocate</span>(cs%taux_bot)</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tauy_bot)) <span class="keyword">deallocate</span>(cs%tauy_bot)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  dealloc_(cs%uhbt) ; dealloc_(cs%vhbt)</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  dealloc_(cs%u_accel_bt) ; dealloc_(cs%v_accel_bt)</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  dealloc_(cs%visc_rem_u) ; dealloc_(cs%visc_rem_v)</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  dealloc_(cs%eta) ; dealloc_(cs%eta_PF) ; dealloc_(cs%pbce)</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  dealloc_(cs%h_av) ; dealloc_(cs%u_av) ; dealloc_(cs%v_av)</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keyword">call </span>dealloc_bt_cont_type(cs%BT_cont)</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="keyword">deallocate</span>(cs)</div></div><!-- fragment -->
</div>
</div>
<a id="a3bae09afc9136333ab281704dc9d9415"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_dynamics_split_rk2::initialize_dyn_split_rk2 </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>uh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>vh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>eta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(inout), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/d35/structmom__dynamics__split__rk2_1_1mom__dyn__split__rk2__cs.html">mom_dyn_split_rk2_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(accel_diag_ptrs), intent(inout), target&#160;</td>
          <td class="paramname"><em>Accel_diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(cont_diag_ptrs), intent(inout), target&#160;</td>
          <td class="paramname"><em>Cont_diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_internal_state), intent(inout)&#160;</td>
          <td class="paramname"><em>MIS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(varmix_cs), pointer&#160;</td>
          <td class="paramname"><em>VarMix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(meke_type), pointer&#160;</td>
          <td class="paramname"><em>MEKE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ale_cs), pointer&#160;</td>
          <td class="paramname"><em>ALE_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(set_visc_cs), pointer&#160;</td>
          <td class="paramname"><em>setVisc_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(vertvisc_type), intent(inout)&#160;</td>
          <td class="paramname"><em>visc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(directories), intent(in)&#160;</td>
          <td class="paramname"><em>dirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout), target&#160;</td>
          <td class="paramname"><em>ntrunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine initializes all of the variables that are used by this dynamic core, including diagnostics and the cpu clocks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u</td><td>zonal velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>merid velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>layer thickness (m or kg/m2)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">uh</td><td>zonal volume/mass transport (m3 s-1 or kg s-1)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vh</td><td>merid volume/mass transport (m3 s-1 or kg s-1)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">eta</td><td>free surface height or column mass (m or kg m-2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>current model time</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>parameter file for parsing</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">diag</td><td>to control diagnostics</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>module control structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_cs</td><td>restart control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step (sec)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">accel_diag</td><td>points to momentum equation terms for budget analysis</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cont_diag</td><td>points to terms in continuity equation</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">mis</td><td>"MOM6 internal state" used to pass diagnostic pointers</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">varmix</td><td>points to spatially variable viscosities</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">meke</td><td>points to mesoscale eddy kinetic energy fields</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>points to OBC related fields</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ale_csp</td><td>points to ALE control structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">setvisc_csp</td><td>points to the set_visc control structure.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">visc</td><td>vertical viscosities, bottom drag, and related</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dirs</td><td>contains directory paths</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ntrunc</td><td>A target for the variable that records the number of times the velocity is truncated (this should be 0). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">1008</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>References <a class="el" href="../../d3/de8/MOM__continuity_8F90_source.html#l00079">mom_continuity::continuity()</a>, <a class="el" href="../../d3/de8/MOM__continuity_8F90_source.html#l00166">mom_continuity::continuity_init()</a>, <a class="el" href="../../d9/d5d/MOM__CoriolisAdv_8F90_source.html#l00844">mom_coriolisadv::coriolisadv_init()</a>, <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00186">mom_verticalgrid::get_flux_units()</a>, <a class="el" href="../../d7/d93/MOM__hor__visc_8F90_source.html#l00698">mom_hor_visc::hor_visc_init()</a>, <a class="el" href="../../d7/d93/MOM__hor__visc_8F90_source.html#l00203">mom_hor_visc::horizontal_viscosity()</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">id_clock_btcalc</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">id_clock_btforce</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">id_clock_btstep</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00192">id_clock_continuity</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">id_clock_cor</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00191">id_clock_horvisc</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00191">id_clock_mom_update</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00194">id_clock_pass</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00194">id_clock_pass_init</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">id_clock_pres</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">id_clock_vertvisc</a>, <a class="el" href="../../d9/da4/MOM__PressureForce_8F90_source.html#l00119">mom_pressureforce::pressureforce_init()</a>, <a class="el" href="../../d3/d58/MOM__tidal__forcing_8F90_source.html#l00106">mom_tidal_forcing::tidal_forcing_init()</a>, and <a class="el" href="../../de/d5d/MOM__vert__friction_8F90_source.html#l01540">mom_vert_friction::updatecfltruncationvalue()</a>.</p>
<div class="fragment"><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(inout)</span> :: g<span class="comment">           !&lt; ocean grid structure</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                   <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">          !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">           !&lt; zonal velocity (m/s)</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">           !&lt; merid velocity (m/s)</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span> , <span class="keywordtype">intent(inout)</span> :: h<span class="comment">           !&lt; layer thickness (m or kg/m2)</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: uh<span class="comment">  !&lt; zonal volume/mass transport (m3 s-1 or kg s-1)</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: vh<span class="comment">  !&lt; merid volume/mass transport (m3 s-1 or kg s-1)</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,          <span class="keywordtype">intent(inout)</span> :: eta<span class="comment">         !&lt; free surface height or column mass (m or kg m-2)</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordtype">type</span>(time_type),                   <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span>    :: time<span class="comment">        !&lt; current model time</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordtype">type</span>(param_file_type),                     <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment">  !&lt; parameter file for parsing</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),                   <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: diag<span class="comment">        !&lt; to control diagnostics</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="keywordtype">type</span>(mom_dyn_split_rk2_cs),                <span class="keywordtype">pointer</span>       :: cs<span class="comment">          !&lt; module control structure</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keywordtype">type</span>(mom_restart_cs),                      <span class="keywordtype">pointer</span>       :: restart_cs<span class="comment">  !&lt; restart control structure</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keywordtype">real</span>,                                      <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">          !&lt; time step (sec)</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="keywordtype">type</span>(accel_diag_ptrs),             <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: accel_diag<span class="comment">  !&lt; points to momentum equation terms for budget analysis</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordtype">type</span>(cont_diag_ptrs),              <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: cont_diag<span class="comment">   !&lt; points to terms in continuity equation</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordtype">type</span>(ocean_internal_state),                <span class="keywordtype">intent(inout)</span> :: mis<span class="comment">         !&lt; &quot;MOM6 internal state&quot; used to pass diagnostic pointers</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordtype">type</span>(varmix_cs),                           <span class="keywordtype">pointer</span>       :: varmix<span class="comment">      !&lt; points to spatially variable viscosities</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordtype">type</span>(meke_type),                           <span class="keywordtype">pointer</span>       :: meke<span class="comment">        !&lt; points to mesoscale eddy kinetic energy fields</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordtype">type</span>(ocean_obc_type),                      <span class="keywordtype">pointer</span>       :: obc<span class="comment">         !&lt; points to OBC related fields</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordtype">type</span>(ale_cs),                              <span class="keywordtype">pointer</span>       :: ale_csp<span class="comment">     !&lt; points to ALE control structure</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="keywordtype">type</span>(set_visc_cs),                         <span class="keywordtype">pointer</span>       :: setvisc_csp<span class="comment"> !&lt; points to the set_visc control structure.</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordtype">type</span>(vertvisc_type),                       <span class="keywordtype">intent(inout)</span> :: visc<span class="comment">        !&lt; vertical viscosities, bottom drag, and related</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">type</span>(directories),                         <span class="keywordtype">intent(in)</span>    :: dirs<span class="comment">        !&lt; contains directory paths</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">target</span>,                           <span class="keywordtype">intent(inout)</span> :: ntrunc<span class="comment">      !&lt; A target for the variable that records the number of times</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">                                                                        !! the velocity is truncated (this should be 0).</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span> :: h_tmp</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordtype">character(len=40)</span> :: mod = <span class="stringliteral">&quot;MOM_dynamics_split_RK2&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordtype">character(len=48)</span> :: thickness_units, flux_units</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordtype">type</span>(group_pass_type) :: pass_h_tmp, pass_av_h_uvh</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="keywordtype">logical</span> :: use_tides, debug_truncations</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed, nz</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="keywordtype">integer</span> :: isdb, iedb, jsdb, jedb</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  is   = g%isc  ; ie   = g%iec  ; js   = g%jsc  ; je   = g%jec ; nz = g%ke</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  isd  = g%isd  ; ied  = g%ied  ; jsd  = g%jsd  ; jed  = g%jed</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <span class="stringliteral">&quot;initialize_dyn_split_RK2 called with an unassociated control structure.&quot;</span>)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">if</span> (cs%module_is_initialized) <span class="keywordflow">then</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;initialize_dyn_split_RK2 called with a control &quot;</span>// &amp;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                            <span class="stringliteral">&quot;structure that has already been initialized.&quot;</span>)</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  cs%module_is_initialized = .true.</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  cs%diag =&gt; diag</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;TIDES&quot;</span>, use_tides, &amp;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                 <span class="stringliteral">&quot;If true, apply tidal momentum forcing.&quot;</span>, default=.false.)</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;BE&quot;</span>, cs%be, &amp;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                 <span class="stringliteral">&quot;If SPLIT is true, BE determines the relative weighting \n&quot;</span>//&amp;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                 <span class="stringliteral">&quot;of a  2nd-order Runga-Kutta baroclinic time stepping \n&quot;</span>//&amp;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                 <span class="stringliteral">&quot;scheme (0.5) and a backward Euler scheme (1) that is \n&quot;</span>//&amp;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                 <span class="stringliteral">&quot;used for the Coriolis and inertial terms.  BE may be \n&quot;</span>//&amp;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                 <span class="stringliteral">&quot;from 0.5 to 1, but instability may occur near 0.5. \n&quot;</span>//&amp;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                 <span class="stringliteral">&quot;BE is also applicable if SPLIT is false and USE_RK2 \n&quot;</span>//&amp;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                 <span class="stringliteral">&quot;is true.&quot;</span>, units=<span class="stringliteral">&quot;nondim&quot;</span>, default=0.6)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;BEGW&quot;</span>, cs%begw, &amp;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                 <span class="stringliteral">&quot;If SPILT is true, BEGW is a number from 0 to 1 that \n&quot;</span>//&amp;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                 <span class="stringliteral">&quot;controls the extent to which the treatment of gravity \n&quot;</span>//&amp;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                 <span class="stringliteral">&quot;waves is forward-backward (0) or simulated backward \n&quot;</span>//&amp;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                 <span class="stringliteral">&quot;Euler (1).  0 is almost always used.\n&quot;</span>//&amp;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                 <span class="stringliteral">&quot;If SPLIT is false and USE_RK2 is true, BEGW can be \n&quot;</span>//&amp;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                 <span class="stringliteral">&quot;between 0 and 0.5 to damp gravity waves.&quot;</span>, &amp;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                 units=<span class="stringliteral">&quot;nondim&quot;</span>, default=0.0)</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;SPLIT_BOTTOM_STRESS&quot;</span>, cs%split_bottom_stress, &amp;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                 <span class="stringliteral">&quot;If true, provide the bottom stress calculated by the \n&quot;</span>//&amp;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                 <span class="stringliteral">&quot;vertical viscosity to the barotropic solver.&quot;</span>, default=.false.)</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;BT_USE_LAYER_FLUXES&quot;</span>, cs%BT_use_layer_fluxes, &amp;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                 <span class="stringliteral">&quot;If true, use the summed layered fluxes plus an \n&quot;</span>//&amp;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                 <span class="stringliteral">&quot;adjustment due to the change in the barotropic velocity \n&quot;</span>//&amp;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                 <span class="stringliteral">&quot;in the barotropic continuity equation.&quot;</span>, default=.true.)</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;DEBUG&quot;</span>, cs%debug, &amp;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                 <span class="stringliteral">&quot;If true, write out verbose debugging data.&quot;</span>, default=.false.)</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;DEBUG_TRUNCATIONS&quot;</span>, debug_truncations, &amp;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                 default=.false.)</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keyword">allocate</span>(cs%taux_bot(isdb:iedb,jsd:jed)) ; cs%taux_bot(:,:) = 0.0</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keyword">allocate</span>(cs%tauy_bot(isd:ied,jsdb:jedb)) ; cs%tauy_bot(:,:) = 0.0</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  alloc_(cs%uhbt(isdb:iedb,jsd:jed))          ; cs%uhbt(:,:)         = 0.0</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  alloc_(cs%vhbt(isd:ied,jsdb:jedb))          ; cs%vhbt(:,:)         = 0.0</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  alloc_(cs%visc_rem_u(isdb:iedb,jsd:jed,nz)) ; cs%visc_rem_u(:,:,:) = 0.0</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  alloc_(cs%visc_rem_v(isd:ied,jsdb:jedb,nz)) ; cs%visc_rem_v(:,:,:) = 0.0</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  alloc_(cs%eta_PF(isd:ied,jsd:jed))          ; cs%eta_PF(:,:)       = 0.0</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  alloc_(cs%pbce(isd:ied,jsd:jed,nz))         ; cs%pbce(:,:,:)       = 0.0</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  alloc_(cs%u_accel_bt(isdb:iedb,jsd:jed,nz)) ; cs%u_accel_bt(:,:,:) = 0.0</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  alloc_(cs%v_accel_bt(isd:ied,jsdb:jedb,nz)) ; cs%v_accel_bt(:,:,:) = 0.0</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  mis%diffu      =&gt; cs%diffu</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  mis%diffv      =&gt; cs%diffv</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  mis%PFu        =&gt; cs%PFu</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  mis%PFv        =&gt; cs%PFv</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  mis%CAu        =&gt; cs%CAu</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  mis%CAv        =&gt; cs%CAv</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  mis%pbce       =&gt; cs%pbce</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  mis%u_accel_bt =&gt; cs%u_accel_bt</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  mis%v_accel_bt =&gt; cs%v_accel_bt</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  mis%u_av       =&gt; cs%u_av</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  mis%v_av       =&gt; cs%v_av</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  cs%ADp           =&gt; accel_diag</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  cs%CDp           =&gt; cont_diag</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  accel_diag%diffu =&gt; cs%diffu</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  accel_diag%diffv =&gt; cs%diffv</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  accel_diag%PFu   =&gt; cs%PFu</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  accel_diag%PFv   =&gt; cs%PFv</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  accel_diag%CAu   =&gt; cs%CAu</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  accel_diag%CAv   =&gt; cs%CAv</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">!  Accel_diag%pbce =&gt; CS%pbce</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">!  Accel_diag%u_accel_bt =&gt; CS%u_accel_bt ; Accel_diag%v_accel_bt =&gt; CS%v_accel_bt</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">!  Accel_diag%u_av =&gt; CS%u_av ; Accel_diag%v_av =&gt; CS%v_av</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="keyword">call </span>continuity_init(time, g, gv, param_file, diag, cs%continuity_CSp)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keyword">call </span>coriolisadv_init(time, g, param_file, diag, cs%ADp, cs%CoriolisAdv_CSp)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="keywordflow">if</span> (use_tides) <span class="keyword">call </span>tidal_forcing_init(time, g, param_file, cs%tides_CSp)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="keyword">call </span>pressureforce_init(time, g, gv, param_file, diag, cs%PressureForce_CSp, &amp;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                          cs%tides_CSp)</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keyword">call </span>hor_visc_init(time, g, param_file, diag, cs%hor_visc_CSp)</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keyword">call </span>vertvisc_init(mis, time, g, gv, param_file, diag, cs%ADp, dirs, &amp;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                     ntrunc, cs%vertvisc_CSp)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(setvisc_csp)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="stringliteral">&quot;initialize_dyn_split_RK2 called with setVisc_CSp unassociated.&quot;</span>)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  cs%set_visc_CSp =&gt; setvisc_csp</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keyword">call </span>updatecfltruncationvalue(time, cs%vertvisc_CSp, activate= &amp;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            ((dirs%input_filename(1:1) == <span class="stringliteral">&#39;n&#39;</span>) .and. &amp;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;             (len_trim(dirs%input_filename) == 1))   )</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(ale_csp)) cs%ALE_CSp =&gt; ale_csp</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    cs%OBC =&gt; obc</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keyword">call </span>open_boundary_init(time, g, param_file, diag, cs%open_boundary_CSp)</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordflow">if</span> (.not. query_initialized(cs%eta,<span class="stringliteral">&quot;sfc&quot;</span>,restart_cs))  <span class="keywordflow">then</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="comment">! Estimate eta based on the layer thicknesses - h.  With the Boussinesq</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">! approximation, eta is the free surface height anomaly, while without it</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="comment">! eta is the mass of ocean per unit area.  eta always has the same</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="comment">! dimensions as h, either m or kg m-3.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="comment">!   CS%eta(:,:) = 0.0 already from initialization.</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">if</span> (gv%Boussinesq) <span class="keywordflow">then</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; cs%eta(i,j) = -g%bathyT(i,j) * gv%m_to_H ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;       cs%eta(i,j) = cs%eta(i,j) + h(i,j,k)</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">! Copy eta into an output array.</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; eta(i,j) = cs%eta(i,j) ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keyword">call </span>barotropic_init(u, v, h, cs%eta, time, g, gv, param_file, diag, &amp;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                       cs%barotropic_CSp, restart_cs, cs%BT_cont, cs%tides_CSp)</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">if</span> (.not. query_initialized(cs%diffu,<span class="stringliteral">&quot;diffu&quot;</span>,restart_cs) .or. &amp;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      .not. query_initialized(cs%diffv,<span class="stringliteral">&quot;diffv&quot;</span>,restart_cs)) &amp;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keyword">call </span>horizontal_viscosity(u, v, h, cs%diffu, cs%diffv, meke, varmix, &amp;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                              g, gv, cs%hor_visc_CSp)</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (.not. query_initialized(cs%u_av,<span class="stringliteral">&quot;u2&quot;</span>, restart_cs) .or. &amp;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      .not. query_initialized(cs%u_av,<span class="stringliteral">&quot;v2&quot;</span>, restart_cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    cs%u_av(:,:,:) = u(:,:,:)</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    cs%v_av(:,:,:) = v(:,:,:)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="comment">! This call is just here to initialize uh and vh.</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">if</span> (.not. query_initialized(uh,<span class="stringliteral">&quot;uh&quot;</span>,restart_cs) .or. &amp;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      .not. query_initialized(vh,<span class="stringliteral">&quot;vh&quot;</span>,restart_cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    h_tmp(:,:,:) = h(:,:,:)</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keyword">call </span>continuity(u, v, h, h_tmp, uh, vh, dt, g, gv, cs%continuity_CSp, obc=cs%OBC)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass_init)</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="keyword">call </span>create_group_pass(pass_h_tmp, h_tmp, g%Domain)</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keyword">call </span>do_group_pass(pass_h_tmp, g%Domain)</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass_init)</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    cs%h_av(:,:,:) = 0.5*(h(:,:,:) + h_tmp(:,:,:))</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">if</span> (.not. query_initialized(cs%h_av,<span class="stringliteral">&quot;h2&quot;</span>,restart_cs)) &amp;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      cs%h_av(:,:,:) = h(:,:,:)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass_init)</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keyword">call </span>create_group_pass(pass_av_h_uvh, cs%u_av,cs%v_av, g%Domain)</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keyword">call </span>create_group_pass(pass_av_h_uvh, cs%h_av, g%Domain)</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keyword">call </span>create_group_pass(pass_av_h_uvh, uh, vh, g%Domain)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keyword">call </span>do_group_pass(pass_av_h_uvh, g%Domain)</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass_init)</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  flux_units = get_flux_units(gv)</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  cs%id_uh = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;uh&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="stringliteral">&#39;Zonal Thickness Flux&#39;</span>, flux_units)</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  cs%id_vh = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;vh&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="stringliteral">&#39;Meridional Thickness Flux&#39;</span>, flux_units)</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  cs%id_umo = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;umo&#39;</span>,                       &amp;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      diag%axesCuL, time,<span class="stringliteral">&#39;Zonal Mass Transport (including SGS param)&#39;</span>, <span class="stringliteral">&#39;kg/s&#39;</span>,&amp;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;ocean_mass_x_transport&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Ocean Mass X Transport&#39;</span>)</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  cs%id_vmo = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;vmo&#39;</span>,                            &amp;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      diag%axesCvL, time,<span class="stringliteral">&#39;Meridional Mass Transport (including SGS param)&#39;</span>, <span class="stringliteral">&#39;kg/s&#39;</span>,&amp;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;ocean_mass_y_transport&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Ocean Mass Y Transport&#39;</span>)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  cs%id_umo_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;umo_2d&#39;</span>,                              &amp;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      diag%axesCu1, time,<span class="stringliteral">&#39;Zonal Mass Transport (including SGS param) Vertical Sum&#39;</span>, <span class="stringliteral">&#39;kg/s&#39;</span>,&amp;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;ocean_mass_x_transport_vertical_sum&#39;</span>,                            &amp;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Ocean Mass X Transport Vertical Sum&#39;</span>)</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  cs%id_vmo_2d = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;vmo_2d&#39;</span>,                                   &amp;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      diag%axesCv1, time,<span class="stringliteral">&#39;Meridional Mass Transport (including SGS param) Vertical Sum&#39;</span>, <span class="stringliteral">&#39;kg/s&#39;</span>,&amp;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;ocean_mass_y_transport_vertical_sum&#39;</span>,                                 &amp;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Ocean Mass Y Transport Vertical Sum&#39;</span>)</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  cs%id_CAu = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;CAu&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="stringliteral">&#39;Zonal Coriolis and Advective Acceleration&#39;</span>, <span class="stringliteral">&#39;meter second-2&#39;</span>)</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  cs%id_CAv = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;CAv&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="stringliteral">&#39;Meridional Coriolis and Advective Acceleration&#39;</span>, <span class="stringliteral">&#39;meter second-2&#39;</span>)</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  cs%id_PFu = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;PFu&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="stringliteral">&#39;Zonal Pressure Force Acceleration&#39;</span>, <span class="stringliteral">&#39;meter second-2&#39;</span>)</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  cs%id_PFv = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;PFv&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="stringliteral">&#39;Meridional Pressure Force Acceleration&#39;</span>, <span class="stringliteral">&#39;meter second-2&#39;</span>)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  cs%id_uav = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;uav&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="stringliteral">&#39;Barotropic-step Averaged Zonal Velocity&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  cs%id_vav = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;vav&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="stringliteral">&#39;Barotropic-step Averaged Meridional Velocity&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  cs%id_u_BT_accel = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;u_BT_accel&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="stringliteral">&#39;Barotropic Anomaly Zonal Acceleration&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  cs%id_v_BT_accel = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;v_BT_accel&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="stringliteral">&#39;Barotropic Anomaly Meridional Acceleration&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  id_clock_cor        = cpu_clock_id(<span class="stringliteral">&#39;(Ocean Coriolis &amp; mom advection)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  id_clock_continuity = cpu_clock_id(<span class="stringliteral">&#39;(Ocean continuity equation)&#39;</span>,      grain=clock_module)</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  id_clock_pres       = cpu_clock_id(<span class="stringliteral">&#39;(Ocean pressure force)&#39;</span>,           grain=clock_module)</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  id_clock_vertvisc   = cpu_clock_id(<span class="stringliteral">&#39;(Ocean vertical viscosity)&#39;</span>,       grain=clock_module)</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  id_clock_horvisc    = cpu_clock_id(<span class="stringliteral">&#39;(Ocean horizontal viscosity)&#39;</span>,     grain=clock_module)</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  id_clock_mom_update = cpu_clock_id(<span class="stringliteral">&#39;(Ocean momentum increments)&#39;</span>,      grain=clock_module)</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  id_clock_pass       = cpu_clock_id(<span class="stringliteral">&#39;(Ocean message passing)&#39;</span>,          grain=clock_module)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  id_clock_pass_init  = cpu_clock_id(<span class="stringliteral">&#39;(Ocean init message passing)&#39;</span>,     grain=clock_routine)</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  id_clock_btcalc     = cpu_clock_id(<span class="stringliteral">&#39;(Ocean barotropic mode calc)&#39;</span>,     grain=clock_module)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  id_clock_btstep     = cpu_clock_id(<span class="stringliteral">&#39;(Ocean barotropic mode stepping)&#39;</span>, grain=clock_module)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  id_clock_btforce    = cpu_clock_id(<span class="stringliteral">&#39;(Ocean barotropic forcing calc)&#39;</span>,  grain=clock_module)</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d1/dc3/namespacemom__dynamics__split__rk2_a3bae09afc9136333ab281704dc9d9415_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9f889b82fd5ed29a854da99d3c929366"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_dynamics_split_rk2::register_restarts_dyn_split_rk2 </td>
          <td>(</td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/d35/structmom__dynamics__split__rk2_1_1mom__dyn__split__rk2__cs.html">mom_dyn_split_rk2_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(hi),szj_(hi),szk_(gv)), intent(inout), target&#160;</td>
          <td class="paramname"><em>uh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(hi),szjb_(hi),szk_(gv)), intent(inout), target&#160;</td>
          <td class="paramname"><em>vh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine sets up any auxiliary restart variables that are specific to the unsplit time stepping scheme. All variables registered here should have the ability to be recreated if they are not present in a restart file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hi</td><td>Horizontal index structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>parameter file</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>module control structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_cs</td><td>restart control structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">uh</td><td>zonal volume/mass transport (m3/s or kg/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vh</td><td>merid volume/mass transport (m3/s or kg/s) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00935">935</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>References <a class="el" href="../../d8/d59/MOM__verticalGrid_8F90_source.html#l00186">mom_verticalgrid::get_flux_units()</a>, <a class="el" href="../../df/d57/MOM__barotropic_8F90_source.html#l04287">mom_barotropic::register_barotropic_restarts()</a>, and <a class="el" href="../../d7/dde/MOM__io_8F90_source.html#l00537">mom_io::var_desc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),          <span class="keywordtype">intent(in)</span>    :: hi<span class="comment">         !&lt; Horizontal index structure</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),       <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">         !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordtype">type</span>(param_file_type),         <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; parameter file</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordtype">type</span>(mom_dyn_split_rk2_cs),    <span class="keywordtype">pointer</span>       :: cs<span class="comment">         !&lt; module control structure</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordtype">type</span>(mom_restart_cs),          <span class="keywordtype">pointer</span>       :: restart_cs<span class="comment"> !&lt; restart control structure</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(HI),SZJ_(HI),SZK_(GV))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: uh<span class="comment"> !&lt; zonal volume/mass transport (m3/s or kg/s)</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(HI),SZJB_(HI),SZK_(GV))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: vh<span class="comment"> !&lt; merid volume/mass transport (m3/s or kg/s)</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordtype">type</span>(vardesc)      :: vd</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mod = <span class="stringliteral">&quot;MOM_dynamics_split_RK2&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordtype">character(len=48)</span>  :: thickness_units, flux_units</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, nz, isdb, iedb, jsdb, jedb</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  isd  = hi%isd  ; ied  = hi%ied  ; jsd  = hi%jsd  ; jed  = hi%jed ; nz = gv%ke</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  isdb = hi%IsdB ; iedb = hi%IedB ; jsdb = hi%JsdB ; jedb = hi%JedB</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">! This is where a control structure specific to this module would be allocated.</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;register_restarts_dyn_split_RK2 called with an associated &quot;</span>// &amp;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                             <span class="stringliteral">&quot;control structure.&quot;</span>)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keyword">allocate</span>(cs)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  alloc_(cs%diffu(isdb:iedb,jsd:jed,nz)) ; cs%diffu(:,:,:) = 0.0</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  alloc_(cs%diffv(isd:ied,jsdb:jedb,nz)) ; cs%diffv(:,:,:) = 0.0</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  alloc_(cs%CAu(isdb:iedb,jsd:jed,nz))   ; cs%CAu(:,:,:)   = 0.0</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  alloc_(cs%CAv(isd:ied,jsdb:jedb,nz))   ; cs%CAv(:,:,:)   = 0.0</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  alloc_(cs%PFu(isdb:iedb,jsd:jed,nz))   ; cs%PFu(:,:,:)   = 0.0</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  alloc_(cs%PFv(isd:ied,jsdb:jedb,nz))   ; cs%PFv(:,:,:)   = 0.0</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  alloc_(cs%eta(isd:ied,jsd:jed))       ; cs%eta(:,:)    = 0.0</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  alloc_(cs%u_av(isdb:iedb,jsd:jed,nz)) ; cs%u_av(:,:,:) = 0.0</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  alloc_(cs%v_av(isd:ied,jsdb:jedb,nz)) ; cs%v_av(:,:,:) = 0.0</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  alloc_(cs%h_av(isd:ied,jsd:jed,nz))   ; cs%h_av(:,:,:) = gv%Angstrom</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  thickness_units = get_thickness_units(gv)</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  flux_units = get_flux_units(gv)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;sfc&quot;</span>,thickness_units,<span class="stringliteral">&quot;Free surface Height&quot;</span>,<span class="stringliteral">&#39;h&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>)</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%eta, vd, .false., restart_cs)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;u2&quot;</span>,<span class="stringliteral">&quot;meter second-1&quot;</span>,<span class="stringliteral">&quot;Auxiliary Zonal velocity&quot;</span>,<span class="stringliteral">&#39;u&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%u_av, vd, .false., restart_cs)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;v2&quot;</span>,<span class="stringliteral">&quot;meter second-1&quot;</span>,<span class="stringliteral">&quot;Auxiliary Meridional velocity&quot;</span>,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%v_av, vd, .false., restart_cs)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;h2&quot;</span>,thickness_units,<span class="stringliteral">&quot;Auxiliary Layer Thickness&quot;</span>,<span class="stringliteral">&#39;h&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%h_av, vd, .false., restart_cs)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;uh&quot;</span>,flux_units,<span class="stringliteral">&quot;Zonal thickness flux&quot;</span>,<span class="stringliteral">&#39;u&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keyword">call </span>register_restart_field(uh, vd, .false., restart_cs)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;vh&quot;</span>,flux_units,<span class="stringliteral">&quot;Meridional thickness flux&quot;</span>,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keyword">call </span>register_restart_field(vh, vd, .false., restart_cs)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;diffu&quot;</span>,<span class="stringliteral">&quot;meter second-2&quot;</span>,<span class="stringliteral">&quot;Zonal horizontal viscous acceleration&quot;</span>,<span class="stringliteral">&#39;u&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%diffu, vd, .false., restart_cs)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  vd = var_desc(<span class="stringliteral">&quot;diffv&quot;</span>,<span class="stringliteral">&quot;meter second-2&quot;</span>,<span class="stringliteral">&quot;Meridional horizontal viscous acceleration&quot;</span>,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keyword">call </span>register_restart_field(cs%diffv, vd, .false., restart_cs)</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keyword">call </span>register_barotropic_restarts(hi, gv, param_file, cs%barotropic_CSp, &amp;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                                    restart_cs)</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d1/dc3/namespacemom__dynamics__split__rk2_a9f889b82fd5ed29a854da99d3c929366_cgraph.svg" width="100%" height="459"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a81cce65643a8cf94979d68354a9a1979"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_dynamics_split_rk2::step_mom_dyn_split_rk2 </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(vertvisc_type), intent(inout)&#160;</td>
          <td class="paramname"><em>visc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(forcing), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), pointer&#160;</td>
          <td class="paramname"><em>p_surf_begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), pointer&#160;</td>
          <td class="paramname"><em>p_surf_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt_since_flux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt_therm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>uh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout), target&#160;</td>
          <td class="paramname"><em>vh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>uhtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>vhtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>eta_av</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="../../df/d35/structmom__dynamics__split__rk2_1_1mom__dyn__split__rk2__cs.html">mom_dyn_split_rk2_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>calc_dtbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(varmix_cs), pointer&#160;</td>
          <td class="paramname"><em>VarMix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(meke_type), pointer&#160;</td>
          <td class="paramname"><em>MEKE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RK2 splitting for time stepping MOM adiabatic dynamics. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u</td><td>zonal velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>merid velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>layer thickness (m or kg/m2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>thermodynamic type</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">visc</td><td>vertical visc, bottom drag, and related</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_local</td><td>model time at end of time step</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step (sec)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>forcing fields</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">p_surf_begin</td><td>surf pressure at start of this dynamic time step (Pa)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">p_surf_end</td><td>surf pressure at end of this dynamic time step (Pa)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt_since_flux</td><td>elapesed time since fluxes were applied (sec)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt_therm</td><td>thermodynamic time step (sec)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">uh</td><td>zonal volume/mass transport (m3/s or kg/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vh</td><td>merid volume/mass transport (m3/s or kg/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">uhtr</td><td>accumulatated zonal volume/mass transport since last tracer advection (m3 or kg)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vhtr</td><td>accumulatated merid volume/mass transport since last tracer advection (m3 or kg)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">eta_av</td><td>free surface height or column mass time averaged over time step (m or kg/m2)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>module control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">calc_dtbt</td><td>if true, recalculate barotropic time step</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">varmix</td><td>specify the spatially varying viscosities</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">meke</td><td>related to mesoscale eddy kinetic energy param </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">203</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>References <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00125">mom_error_handler::calltree_enter()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00146">mom_error_handler::calltree_leave()</a>, <a class="el" href="../../d5/d48/MOM__error__handler_8F90_source.html#l00156">mom_error_handler::calltree_waypoint()</a>, <a class="el" href="../../d0/d57/MOM__domains_8F90_source.html#l00840">mom_domains::complete_group_pass()</a>, <a class="el" href="../../d3/de8/MOM__continuity_8F90_source.html#l00079">mom_continuity::continuity()</a>, <a class="el" href="../../d9/d5d/MOM__CoriolisAdv_8F90_source.html#l00167">mom_coriolisadv::coradcalc()</a>, <a class="el" href="../../db/da5/MOM__diag__mediator_8F90_source.html#l00830">mom_diag_mediator::diag_update_target_grids()</a>, <a class="el" href="../../d7/d93/MOM__hor__visc_8F90_source.html#l00203">mom_hor_visc::horizontal_viscosity()</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">id_clock_btcalc</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">id_clock_btforce</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">id_clock_btstep</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00192">id_clock_continuity</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">id_clock_cor</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00191">id_clock_horvisc</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00191">id_clock_mom_update</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00194">id_clock_pass</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">id_clock_pres</a>, <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">id_clock_vertvisc</a>, <a class="el" href="../../d3/d5c/MOM__checksum__packages_8F90_source.html#l00147">mom_checksum_packages::mom_accel_chksum()</a>, <a class="el" href="../../d9/da4/MOM__PressureForce_8F90_source.html#l00081">mom_pressureforce::pressureforce()</a>, <a class="el" href="../../df/d57/MOM__barotropic_8F90_source.html#l02197">mom_barotropic::set_dtbt()</a>, <a class="el" href="../../d8/d50/MOM__set__viscosity_8F90_source.html#l00135">mom_set_visc::set_viscous_bbl()</a>, <a class="el" href="../../d8/d50/MOM__set__viscosity_8F90_source.html#l00865">mom_set_visc::set_viscous_ml()</a>, <a class="el" href="../../d0/d57/MOM__domains_8F90_source.html#l00826">mom_domains::start_group_pass()</a>, and <a class="el" href="../../de/d5d/MOM__vert__friction_8F90_source.html#l01540">mom_vert_friction::updatecfltruncationvalue()</a>.</p>
<div class="fragment"><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(inout)</span> :: g<span class="comment">             !&lt; ocean grid structure</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                   <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">            !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">     !&lt; zonal velocity (m/s)</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">     !&lt; merid velocity (m/s)</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,  <span class="keywordtype">intent(inout)</span> :: h<span class="comment">             !&lt; layer thickness (m or kg/m2)</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                     <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">            !&lt; thermodynamic type</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">type</span>(vertvisc_type),                       <span class="keywordtype">intent(inout)</span> :: visc<span class="comment">          !&lt; vertical visc, bottom drag, and related</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">type</span>(time_type),                           <span class="keywordtype">intent(in)</span>    :: time_local<span class="comment">    !&lt; model time at end of time step</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordtype">real</span>,                                      <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">            !&lt; time step (sec)</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">type</span>(forcing),                             <span class="keywordtype">intent(in)</span>    :: fluxes<span class="comment">        !&lt; forcing fields</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,                      <span class="keywordtype">pointer</span>       :: p_surf_begin<span class="comment">  !&lt; surf pressure at start of this dynamic time step (Pa)</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,                      <span class="keywordtype">pointer</span>       :: p_surf_end<span class="comment">    !&lt; surf pressure at end   of this dynamic time step (Pa)</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordtype">real</span>,                                      <span class="keywordtype">intent(in)</span>    :: dt_since_flux<span class="comment"> !&lt; elapesed time since fluxes were applied (sec)</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordtype">real</span>,                                      <span class="keywordtype">intent(in)</span>    :: dt_therm<span class="comment">      !&lt; thermodynamic time step (sec)</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: uh<span class="comment">    !&lt; zonal volume/mass transport (m3/s or kg/s)</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: vh<span class="comment">    !&lt; merid volume/mass transport (m3/s or kg/s)</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: uhtr<span class="comment">          !&lt; accumulatated zonal volume/mass transport since last tracer advection (m3 or kg)</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: vhtr<span class="comment">          !&lt; accumulatated merid volume/mass transport since last tracer advection (m3 or kg)</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,          <span class="keywordtype">intent(out)</span>   :: eta_av<span class="comment">        !&lt; free surface height or column mass time averaged over time step (m or kg/m2)</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordtype">type</span>(mom_dyn_split_rk2_cs),                <span class="keywordtype">pointer</span>       :: cs<span class="comment">            !&lt; module control structure</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">logical</span>,                                   <span class="keywordtype">intent(in)</span>    :: calc_dtbt<span class="comment">     !&lt; if true, recalculate barotropic time step</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordtype">type</span>(varmix_cs),                           <span class="keywordtype">pointer</span>       :: varmix<span class="comment">        !&lt; specify the spatially varying viscosities</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">type</span>(meke_type),                           <span class="keywordtype">pointer</span>       :: meke<span class="comment">          !&lt; related to mesoscale eddy kinetic energy param</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordtype">real</span> :: dt_pred   <span class="comment">! The time step for the predictor part of the baroclinic time stepping.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span> :: up   <span class="comment">! Predicted zonal velocitiy in m s-1.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span> :: vp   <span class="comment">! Predicted meridional velocitiy in m s-1.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>  :: hp   <span class="comment">! Predicted thickness in m or kg m-2 (H).</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span> :: u_bc_accel</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span> :: v_bc_accel</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">! u_bc_accel and v_bc_accel are the summed baroclinic accelerations of each</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">! layer calculated by the non-barotropic part of the model, both in m s-2.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span> :: uh_in</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span> :: vh_in</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">! uh_in and vh_in are the zonal or meridional mass transports that would be</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">! obtained using the initial velocities, both in m3 s-1 or kg s-1.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span> :: uhbt_out</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span> :: vhbt_out</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">! uhbt_out and vhbt_out are the vertically summed transports from the</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">! barotropic solver based on its final velocities, both in m3 s-1 or kg s-1.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: eta_pred</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">! eta_pred is the predictor value of the free surface height or column mass,</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">! in m or kg m-2.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span> :: u_adj</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span> :: v_adj</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">! u_adj and v_adj are the zonal or meridional velocities after u and v</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">! have been barotropically adjusted so the resulting transports match</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">! uhbt_out and vhbt_out, both in m s-1.</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span> :: u_old_rad_obc</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span> :: v_old_rad_obc</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>  :: h_old_rad_obc</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">! u_old_rad_OBC and v_old_rad_OBC are the starting velocities, which are</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">! saved for use in the Flather open boundary condition code, both in m s-1.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">real</span> :: pa_to_eta <span class="comment">! A factor that converts pressures to the units of eta.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:)</span> :: &amp;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    p_surf =&gt; null(), eta_pf_start =&gt; null(), &amp;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    taux_bot =&gt; null(), tauy_bot =&gt; null(), &amp;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    eta =&gt; null()</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span> :: &amp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    uh_ptr =&gt; null(), u_ptr =&gt; null(),  vh_ptr =&gt; null(), v_ptr =&gt; null(), &amp;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    u_init =&gt; null(), v_init =&gt; null(), &amp; <span class="comment">! Pointers to u and v or u_adj and v_adj.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    u_av, &amp; <span class="comment">! The zonal velocity time-averaged over a time step, in m s-1.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    v_av, &amp; <span class="comment">! The meridional velocity time-averaged over a time step, in m s-1.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    h_av    <span class="comment">! The layer thickness time-averaged over a time step, in m or</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">! kg m-2.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">real</span> :: idt</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">logical</span> :: dyn_p_surf</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">logical</span> :: bt_cont_bt_thick <span class="comment">! If true, use the BT_cont_type to estimate the</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                              <span class="comment">! relative weightings of the layers in calculating</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                              <span class="comment">! the barotropic accelerations.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">!---For group halo pass</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">logical</span> :: do_pass_ray_uv, do_pass_kv_bbl_thick</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">logical</span> :: showcalltree</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">! for diagnostics</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span> :: uwork2d</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span> :: vwork2d</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  is  = g%isc  ; ie  = g%iec  ; js  = g%jsc  ; je  = g%jec ; nz = g%ke</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  u_av =&gt; cs%u_av ; v_av =&gt; cs%v_av ; h_av =&gt; cs%h_av ; eta =&gt; cs%eta</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  idt = 1.0 / dt</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  showcalltree = calltree_showquery()</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;step_MOM_dyn_split_RK2(), MOM_dynamics_split_RK2.F90&quot;</span>)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(nz,G,up,vp,hp,h)</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">do</span> k = 1, nz</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">do</span> j=g%jsd,g%jed   ; <span class="keywordflow">do</span> i=g%isdB,g%iedB ;  up(i,j,k) = 0.0 ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">do</span> j=g%jsdB,g%jedB ; <span class="keywordflow">do</span> i=g%isd,g%ied   ;  vp(i,j,k) = 0.0 ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">do</span> j=g%jsd,g%jed   ; <span class="keywordflow">do</span> i=g%isd,g%ied   ;  hp(i,j,k) = h(i,j,k) ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">! Update CFL truncation value as function of time</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keyword">call </span>updatecfltruncationvalue(time_local, cs%vertvisc_CSp)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Start predictor &quot;</span>, u, v, h, uh, vh, g, gv)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Start predictor u &quot;</span>, u, v, g)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Start predictor uh &quot;</span>, uh, vh, g)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  dyn_p_surf = <span class="keyword">associated</span>(p_surf_begin) .and. <span class="keyword">associated</span>(p_surf_end)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span> (dyn_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    p_surf =&gt; p_surf_end</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">call </span>safe_alloc_ptr(eta_pf_start,g%isd,g%ied,g%jsd,g%jed)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    eta_pf_start(:,:) = 0.0</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    p_surf =&gt; fluxes%p_surf</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%OBC)) <span class="keywordflow">then</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is-2,ie+1</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      u_old_rad_obc(i,j,k) = u(i,j,k)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js-2,je+1 ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      v_old_rad_obc(i,j,k) = v(i,j,k)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js-1,je+1 ; <span class="keywordflow">do</span> i=is-1,ie+1</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      h_old_rad_obc(i,j,k) = h(i,j,k)</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  bt_cont_bt_thick = .false.</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%BT_cont)) bt_cont_bt_thick = &amp;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    (<span class="keyword">associated</span>(cs%BT_cont%h_u) .and. <span class="keyword">associated</span>(cs%BT_cont%h_v))</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">if</span> (cs%split_bottom_stress) <span class="keywordflow">then</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    taux_bot =&gt; cs%taux_bot ; tauy_bot =&gt; cs%tauy_bot</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">!--- begin set up for group halo pass</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  do_pass_ray_uv = .false.</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span> (visc%calc_bbl .AND. <span class="keyword">associated</span>(visc%Ray_u) .and. <span class="keyword">associated</span>(visc%Ray_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_Ray_uv, visc%Ray_u, visc%Ray_v, g%Domain, &amp;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    do_pass_ray_uv = .true.</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  do_pass_kv_bbl_thick = .false.</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (visc%calc_bbl) <span class="keywordflow">then</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(visc%bbl_thick_u) .and. <span class="keyword">associated</span>(visc%bbl_thick_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_kv_bbl_thick, visc%bbl_thick_u, visc%bbl_thick_v, &amp;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                             g%Domain, to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      do_pass_kv_bbl_thick = .true.</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(visc%kv_bbl_u) .and. <span class="keyword">associated</span>(visc%kv_bbl_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">call </span>create_group_pass(cs%pass_kv_bbl_thick, visc%kv_bbl_u, visc%kv_bbl_v, &amp;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                             g%Domain, to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      do_pass_kv_bbl_thick = .true.</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_eta_PF_eta, cs%eta_PF, g%Domain)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_eta_PF_eta, eta, g%Domain)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_visc_rem, cs%visc_rem_u, cs%visc_rem_v, g%Domain, &amp;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                         to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_uvp, up, vp, g%Domain)</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_hp_uv, hp, g%Domain)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_hp_uv, u_av, v_av, g%Domain)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_hp_uv, uh(:,:,:), vh(:,:,:), g%Domain)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">if</span> (cs%begw /= 0.0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_eta_PF, cs%eta_PF, g%Domain)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">if</span> (bt_cont_bt_thick) <span class="keywordflow">then</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">call </span>create_group_pass(cs%pass_huv, cs%BT_cont%h_u, cs%BT_cont%h_v, g%Domain, &amp;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                           to_all+scalar_pair, cgrid_ne)</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_uv, u, v, g%Domain)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_h, h, g%Domain)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_av_uvh, u_av, v_av, g%Domain)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keyword">call </span>create_group_pass(cs%pass_av_uvh, uh(:,:,:), vh(:,:,:), g%Domain)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">!--- end set up for group halo pass</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (visc%calc_bbl) <span class="keywordflow">then</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">! Calculate the BBL properties and store them inside visc (u,h).</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_vertvisc)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keyword">call </span>enable_averaging(visc%bbl_calc_time_interval, &amp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;              time_local+set_time(int(visc%bbl_calc_time_interval-dt)), cs%diag)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keyword">call </span>set_viscous_bbl(u, v, h, tv, visc, g, gv, cs%set_visc_CSp)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_vertvisc)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">if</span> (do_pass_ray_uv) <span class="keyword">call </span>start_group_pass(cs%pass_Ray_uv, g%Domain)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">if</span> (do_pass_kv_bbl_thick) <span class="keyword">call </span>start_group_pass(cs%pass_kv_bbl_thick, g%Domain)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="comment">! visc%calc_bbl will be set to .false. when the message passing is complete.</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">if</span> (do_pass_ray_uv) <span class="keyword">call </span>do_group_pass(cs%pass_Ray_uv, g%Domain)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">if</span> (do_pass_kv_bbl_thick) <span class="keyword">call </span>do_group_pass(cs%pass_kv_bbl_thick, g%Domain)</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      visc%calc_bbl = .false.</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with set_viscous_BBL (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">! PFu = d/dx M(h,T,S)</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">! pbce = dM/deta</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordflow">if</span> (cs%begw == 0.0) <span class="keyword">call </span>enable_averaging(dt, time_local, cs%diag)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pres)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keyword">call </span>pressureforce(h, tv, cs%PFu, cs%PFv, g, gv, cs%PressureForce_CSp, &amp;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                     cs%ALE_CSp, p_surf, cs%pbce, cs%eta_PF)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">call </span>uchksum(cs%PFu,<span class="stringliteral">&quot;After PressureForce CS%PFu&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keyword">call </span>vchksum(cs%PFv,<span class="stringliteral">&quot;After PressureForce CS%PFv&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (dyn_p_surf) <span class="keywordflow">then</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    pa_to_eta = 1.0 / gv%H_to_Pa</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(Isq,Ieq,Jsq,Jeq,eta_PF_start,CS,Pa_to_eta,p_surf_begin,p_surf_end)</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      eta_pf_start(i,j) = cs%eta_PF(i,j) - pa_to_eta * &amp;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                          (p_surf_begin(i,j) - p_surf_end(i,j))</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pres)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with PressureForce (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_eta_PF_eta, g%Domain)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">! CAu = -(f+zeta_av)/h_av vh + d/dx KE_av</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_cor)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keyword">call </span>coradcalc(u_av, v_av, h_av, uh, vh, cs%CAu, cs%CAv, cs%ADp, g, gv, &amp;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                 cs%CoriolisAdv_CSp)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_cor)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with CorAdCalc (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">! u_bc_accel = CAu + PFu + diffu(u[n-1])</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_btforce)</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,u_bc_accel,v_bc_accel,CS)</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      u_bc_accel(i,j,k) = (cs%Cau(i,j,k) + cs%PFu(i,j,k)) + cs%diffu(i,j,k)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      v_bc_accel(i,j,k) = (cs%Cav(i,j,k) + cs%PFv(i,j,k)) + cs%diffv(i,j,k)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_btforce)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;pre-btstep CS%Ca &quot;</span>, cs%Cau, cs%Cav, g)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;pre-btstep CS%PF &quot;</span>, cs%PFu, cs%PFv, g)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;pre-btstep CS%diff &quot;</span>, cs%diffu, cs%diffv, g)</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;pre-btstep u_bc_accel &quot;</span>, u_bc_accel, v_bc_accel, g)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span> (visc%calc_bbl) <span class="keywordflow">then</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordflow">if</span> (do_pass_ray_uv) <span class="keyword">call </span>complete_group_pass(cs%pass_Ray_uv, g%Domain)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">if</span> (do_pass_kv_bbl_thick) <span class="keyword">call </span>complete_group_pass(cs%pass_kv_bbl_thick, g%Domain)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="comment">! visc%calc_bbl is set to .false. now that the message passing is completed.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      visc%calc_bbl = .false.</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_eta_PF_eta, g%Domain)</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_vertvisc)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,up,G,u,dt, &amp;</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">!$OMP                                  u_bc_accel,vp,v,v_bc_accel)</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      up(i,j,k) = g%mask2dCu(i,j) * (u(i,j,k) + dt * u_bc_accel(i,j,k))</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      vp(i,j,k) = g%mask2dCv(i,j) * (v(i,j,k) + dt * v_bc_accel(i,j,k))</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keyword">call </span>enable_averaging(dt, time_local, cs%diag)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">call </span>set_viscous_ml(u, v, h, tv, fluxes, visc, dt, g, gv, &amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                      cs%set_visc_CSp)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keyword">call </span>disable_averaging(cs%diag)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keyword">call </span>uchksum(up,<span class="stringliteral">&quot;before vertvisc: up&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keyword">call </span>vchksum(vp,<span class="stringliteral">&quot;before vertvisc: vp&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keyword">call </span>vertvisc_coef(up, vp, h, fluxes, visc, dt, g, gv, cs%vertvisc_CSp)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keyword">call </span>vertvisc_remnant(visc, cs%visc_rem_u, cs%visc_rem_v, dt, g, gv, cs%vertvisc_CSp)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_vertvisc)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with vertvisc_coef (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_visc_rem, g%Domain)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_eta_PF_eta, g%Domain)</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_visc_rem, g%Domain)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_btcalc)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">! Calculate the relative layer weights for determining barotropic quantities.</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> (.not.bt_cont_bt_thick) &amp;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keyword">call </span>btcalc(h, g, gv, cs%barotropic_CSp)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keyword">call </span>bt_mass_source(h, eta, fluxes, .true., dt_therm, dt_since_flux, &amp;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                      g, gv, cs%barotropic_CSp)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_btcalc)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_visc_rem, g%Domain)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">! u_accel_bt = layer accelerations due to barotropic solver</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%BT_cont) .or. cs%BT_use_layer_fluxes) <span class="keywordflow">then</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_continuity)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keyword">call </span>continuity(u, v, h, hp, uh_in, vh_in, dt, g, gv, &amp;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                    cs%continuity_CSp, obc=cs%OBC, visc_rem_u=cs%visc_rem_u, &amp;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                    visc_rem_v=cs%visc_rem_v, bt_cont=cs%BT_cont)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_continuity)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> (bt_cont_bt_thick) <span class="keywordflow">then</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keyword">call </span>do_group_pass(cs%pass_huv, g%Domain)</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keyword">call </span>btcalc(h, g, gv, cs%barotropic_CSp, cs%BT_cont%h_u, cs%BT_cont%h_v)</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with continuity[BT_cont] (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keywordflow">if</span> (cs%BT_use_layer_fluxes) <span class="keywordflow">then</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    uh_ptr =&gt; uh_in; vh_ptr =&gt; vh_in; u_ptr =&gt; u; v_ptr =&gt; v</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  u_init =&gt; u ; v_init =&gt; v</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_btstep)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">if</span> (calc_dtbt) <span class="keyword">call </span>set_dtbt(g, gv, cs%barotropic_CSp, eta, cs%pbce)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;btstep(), MOM_barotropic.F90&quot;</span>)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">! This is the predictor step call to btstep.</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keyword">call </span>btstep(u, v, eta, dt, u_bc_accel, v_bc_accel, &amp;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;              fluxes, cs%pbce, cs%eta_PF, u_av, v_av, cs%u_accel_bt, &amp;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;              cs%v_accel_bt, eta_pred, cs%uhbt, cs%vhbt, g, gv, cs%barotropic_CSp,&amp;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;              cs%visc_rem_u, cs%visc_rem_v, obc=cs%OBC, &amp;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;              bt_cont = cs%BT_cont, eta_pf_start=eta_pf_start, &amp;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;              taux_bot=taux_bot, tauy_bot=tauy_bot, &amp;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;              uh0=uh_ptr, vh0=vh_ptr, u_uh0=u_ptr, v_vh0=v_ptr)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;btstep()&quot;</span>)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_btstep)</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">! up = u + dt_pred*( u_bc_accel + u_accel_bt )</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  dt_pred = dt * cs%be</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_mom_update)</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,vp,G,v_init, &amp;</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">!$OMP                                  dt_pred,v_bc_accel,CS,up,u_init,u_bc_accel)</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      vp(i,j,k) = g%mask2dCv(i,j) * (v_init(i,j,k) + dt_pred * &amp;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                      (v_bc_accel(i,j,k) + cs%v_accel_bt(i,j,k)))</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      up(i,j,k) = g%mask2dCu(i,j) * (u_init(i,j,k) + dt_pred  * &amp;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                      (u_bc_accel(i,j,k) + cs%u_accel_bt(i,j,k)))</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_mom_update)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keyword">call </span>uchksum(up,<span class="stringliteral">&quot;Predictor 1 u&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keyword">call </span>vchksum(vp,<span class="stringliteral">&quot;Predictor 1 v&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keyword">call </span>hchksum(gv%H_to_kg_m2*h,<span class="stringliteral">&quot;Predictor 1 h&quot;</span>,g,haloshift=1)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keyword">call </span>uchksum(gv%H_to_kg_m2*uh,<span class="stringliteral">&quot;Predictor 1 uh&quot;</span>,g,haloshift=2)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">call </span>vchksum(gv%H_to_kg_m2*vh,<span class="stringliteral">&quot;Predictor 1 vh&quot;</span>,g,haloshift=2)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">!   call MOM_state_chksum(&quot;Predictor 1&quot;, up, vp, h, uh, vh, G, GV, haloshift=1)</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keyword">call </span>mom_accel_chksum(<span class="stringliteral">&quot;Predictor accel&quot;</span>, cs%CAu, cs%CAv, cs%PFu, cs%PFv, &amp;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;             cs%diffu, cs%diffv, g, gv, cs%pbce, cs%u_accel_bt, cs%v_accel_bt)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Predictor 1 init&quot;</span>, u_init, v_init, h, uh, vh, g, gv, haloshift=2)</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Predictor 1 up&quot;</span>, up, vp, g)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Predictor 1 uh&quot;</span>, uh, vh, g)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">! up &lt;- up + dt_pred d/dz visc d/dz up</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">! u_av  &lt;- u_av  + dt_pred d/dz visc d/dz u_av</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_vertvisc)</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keyword">call </span>uchksum(up,<span class="stringliteral">&quot;0 before vertvisc: up&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keyword">call </span>vchksum(vp,<span class="stringliteral">&quot;0 before vertvisc: vp&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keyword">call </span>vertvisc_coef(up, vp, h, fluxes, visc, dt_pred, g, gv, cs%vertvisc_CSp)</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">call </span>vertvisc(up, vp, h, fluxes, visc, dt_pred, cs%OBC, cs%ADp, cs%CDp, g, &amp;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                gv, cs%vertvisc_CSp, cs%taux_bot, cs%tauy_bot)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with vertvisc (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_vertvisc) ; <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_uvp, g%Domain)</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass) ; <span class="keyword">call </span>cpu_clock_begin(id_clock_vertvisc)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keyword">call </span>vertvisc_remnant(visc, cs%visc_rem_u, cs%visc_rem_v, dt_pred, g, gv, cs%vertvisc_CSp)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_vertvisc)</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keyword">call </span>do_group_pass(cs%pass_visc_rem, g%Domain)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_uvp, g%Domain)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_uvp, g%Domain)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="comment">! uh = u_av * h</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">! hp = h + dt * div . uh</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_continuity)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keyword">call </span>continuity(up, vp, h, hp, uh, vh, dt, g, gv, cs%continuity_CSp, &amp;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                  cs%uhbt, cs%vhbt, cs%OBC, cs%visc_rem_u, cs%visc_rem_v, &amp;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                  u_av, v_av, bt_cont=cs%BT_cont)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_continuity)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with continuity (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keyword">call </span>do_group_pass(cs%pass_hp_uv, g%Domain)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_av_uvh, g%Domain)</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%OBC)) <span class="keywordflow">then</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keyword">call </span>radiation_open_bdry_conds(cs%OBC, u_av, u_old_rad_obc, v_av, &amp;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;             v_old_rad_obc, hp, h_old_rad_obc, g, cs%open_boundary_CSp)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">! h_av = (h + hp)/2</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,nz,h_av,h,hp)</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js-2,je+2 ; <span class="keywordflow">do</span> i=is-2,ie+2</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    h_av(i,j,k) = 0.5*(h(i,j,k) + hp(i,j,k))</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="comment">! The correction phase of the time step starts here.</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keyword">call </span>enable_averaging(dt, time_local, cs%diag)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">! Calculate a revised estimate of the free-surface height correction to be</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">! used in the next call to btstep.  This call is at this point so that</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="comment">! hp can be changed if CS%begw /= 0.</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">! eta_cor = ...                 (hidden inside CS%barotropic_CSp)</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_btcalc)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keyword">call </span>bt_mass_source(hp, eta_pred, fluxes, .false., dt_therm, &amp;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                      dt_since_flux+dt, g, gv, cs%barotropic_CSp)</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_btcalc)</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">if</span> (cs%begw /= 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">! hp &lt;- (1-begw)*h_in + begw*hp</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">! Back up hp to the value it would have had after a time-step of</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment">! begw*dt.  hp is not used again until recalculated by continuity.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,nz,hp,CS,h)</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js-1,je+1 ; <span class="keywordflow">do</span> i=is-1,ie+1</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      hp(i,j,k) = (1.0-cs%begw)*h(i,j,k) + cs%begw*hp(i,j,k)</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">! PFu = d/dx M(hp,T,S)</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">! pbce = dM/deta</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pres)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keyword">call </span>pressureforce(hp, tv, cs%PFu, cs%PFv, g, gv, &amp;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                       cs%PressureForce_CSp, cs%ALE_CSp, &amp;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                       p_surf, cs%pbce, cs%eta_PF)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pres)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_eta_PF, g%Domain)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with PressureForce[hp=(1-b).h+b.h] (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_av_uvh, g%Domain)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">if</span> (bt_cont_bt_thick) <span class="keywordflow">then</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_huv, g%Domain)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">call </span>btcalc(h, g, gv, cs%barotropic_CSp, cs%BT_cont%h_u, cs%BT_cont%h_v)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with btcalc[BT_cont_BT_thick] (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Predictor &quot;</span>, up, vp, hp, uh, vh, g, gv)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keyword">call </span>uchksum(u_av,<span class="stringliteral">&quot;Predictor avg u&quot;</span>,g,haloshift=1)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keyword">call </span>vchksum(v_av,<span class="stringliteral">&quot;Predictor avg v&quot;</span>,g,haloshift=1)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keyword">call </span>hchksum(gv%H_to_kg_m2*h_av,<span class="stringliteral">&quot;Predictor avg h&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="comment">! call MOM_state_chksum(&quot;Predictor avg &quot;, u_av, v_av,  h_av,uh, vh, G, GV)</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Predictor up &quot;</span>, up, vp, g)</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;Predictor uh &quot;</span>, uh, vh, g)</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">! diffu = horizontal viscosity terms (u_av)</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_horvisc)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keyword">call </span>horizontal_viscosity(u_av, v_av, h_av, cs%diffu, cs%diffv, &amp;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                            meke, varmix, g, gv, cs%hor_visc_CSp, obc=cs%OBC)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_horvisc)</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with horizontal_viscosity (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">! CAu = -(f+zeta_av)/h_av vh + d/dx KE_av</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_cor)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keyword">call </span>coradcalc(u_av, v_av, h_av, uh, vh, cs%CAu, cs%CAv, cs%ADp, g, gv, &amp;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                 cs%CoriolisAdv_CSp)</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_cor)</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with CorAdCalc (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">! Calculate the momentum forcing terms for the barotropic equations.</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">! u_bc_accel = CAu + PFu + diffu(u[n-1])</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_btforce)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,CS, &amp;</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">!$OMP                                  u_bc_accel,v_bc_accel)</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      u_bc_accel(i,j,k) = (cs%Cau(i,j,k) + cs%PFu(i,j,k)) + cs%diffu(i,j,k)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      v_bc_accel(i,j,k) = (cs%Cav(i,j,k) + cs%PFv(i,j,k)) + cs%diffv(i,j,k)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_btforce)</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;corr pre-btstep CS%Ca &quot;</span>, cs%Cau, cs%Cav, g)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;corr pre-btstep CS%PF &quot;</span>, cs%PFu, cs%PFv, g)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;corr pre-btstep CS%diff &quot;</span>, cs%diffu, cs%diffv, g)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;corr pre-btstep u_bc_accel &quot;</span>, u_bc_accel, v_bc_accel, g)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="comment">! u_accel_bt = layer accelerations due to barotropic solver</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="comment">! pbce = dM/deta</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_btstep)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordflow">if</span> (cs%BT_use_layer_fluxes) <span class="keywordflow">then</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    uh_ptr =&gt; uh ; vh_ptr =&gt; vh ; u_ptr =&gt; u_av ; v_ptr =&gt; v_av</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;btstep(), MOM_barotropic.F90&quot;</span>)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">! This is the corrector step call to btstep.</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keyword">call </span>btstep(u, v, eta, dt, u_bc_accel, v_bc_accel, &amp;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;              fluxes, cs%pbce, cs%eta_PF, u_av, v_av, cs%u_accel_bt, &amp;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;              cs%v_accel_bt, eta_pred, cs%uhbt, cs%vhbt, g, gv, &amp;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;              cs%barotropic_CSp, cs%visc_rem_u, cs%visc_rem_v, &amp;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;              etaav=eta_av, obc=cs%OBC, &amp;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;              bt_cont = cs%BT_cont, eta_pf_start=eta_pf_start, &amp;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;              taux_bot=taux_bot, tauy_bot=tauy_bot, &amp;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;              uh0=uh_ptr, vh0=vh_ptr, u_uh0=u_ptr, v_vh0=v_ptr)</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; eta(i,j) = eta_pred(i,j) ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_btstep)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;btstep()&quot;</span>)</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keyword">call </span>check_redundant(<span class="stringliteral">&quot;u_accel_bt &quot;</span>, cs%u_accel_bt, cs%v_accel_bt, g)</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="comment">! u = u + dt*( u_bc_accel + u_accel_bt )</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_mom_update)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,u,G,u_init, &amp;</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">!$OMP                                  CS,dt,u_bc_accel,v,v_init,v_bc_accel)</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      u(i,j,k) = g%mask2dCu(i,j) * (u_init(i,j,k) + dt * &amp;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                      (u_bc_accel(i,j,k) + cs%u_accel_bt(i,j,k)))</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      v(i,j,k) = g%mask2dCv(i,j) * (v_init(i,j,k) + dt * &amp;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                      (v_bc_accel(i,j,k) + cs%v_accel_bt(i,j,k)))</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_mom_update)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keyword">call </span>uchksum(u,<span class="stringliteral">&quot;Corrector 1 u&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">call </span>vchksum(v,<span class="stringliteral">&quot;Corrector 1 v&quot;</span>,g,haloshift=0)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keyword">call </span>hchksum(gv%H_to_kg_m2*h,<span class="stringliteral">&quot;Corrector 1 h&quot;</span>,g,haloshift=2)</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keyword">call </span>uchksum(gv%H_to_kg_m2*uh,<span class="stringliteral">&quot;Corrector 1 uh&quot;</span>,g,haloshift=2)</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keyword">call </span>vchksum(gv%H_to_kg_m2*vh,<span class="stringliteral">&quot;Corrector 1 vh&quot;</span>,g,haloshift=2)</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">! call MOM_state_chksum(&quot;Corrector 1&quot;, u, v, h, uh, vh, G, GV, haloshift=1)</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keyword">call </span>mom_accel_chksum(<span class="stringliteral">&quot;Corrector accel&quot;</span>, cs%CAu, cs%CAv, cs%PFu, cs%PFv, &amp;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;             cs%diffu, cs%diffv, g, gv, cs%pbce, cs%u_accel_bt, cs%v_accel_bt)</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">! u &lt;- u + dt d/dz visc d/dz u</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">! u_av &lt;- u_av + dt d/dz visc d/dz u_av</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_vertvisc)</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keyword">call </span>vertvisc_coef(u, v, h, fluxes, visc, dt, g, gv, cs%vertvisc_CSp)</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keyword">call </span>vertvisc(u, v, h, fluxes, visc, dt, cs%OBC, cs%ADp, cs%CDp, g, gv, &amp;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                cs%vertvisc_CSp, cs%taux_bot, cs%tauy_bot)</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_vertvisc) ; <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_uv, g%Domain)</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass) ; <span class="keyword">call </span>cpu_clock_begin(id_clock_vertvisc)</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keyword">call </span>vertvisc_remnant(visc, cs%visc_rem_u, cs%visc_rem_v, dt, g, gv, cs%vertvisc_CSp)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_vertvisc)</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with vertvisc (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">! Later, h_av = (h_in + h_out)/2, but for now use h_av to store h_in.</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,nz,h_av,h)</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js-2,je+2 ; <span class="keywordflow">do</span> i=is-2,ie+2</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    h_av(i,j,k) = h(i,j,k)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keyword">call </span>do_group_pass(cs%pass_visc_rem, g%Domain)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_uv, g%Domain)</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_uv, g%Domain)</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">! uh = u_av * h</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">! h  = h + dt * div . uh</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">! u_av and v_av adjusted so their mass transports match uhbt and vhbt.</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_continuity)</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keyword">call </span>continuity(u, v, h, h, uh, vh, dt, g, gv, &amp;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                  cs%continuity_CSp, cs%uhbt, cs%vhbt, cs%OBC, &amp;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                  cs%visc_rem_u, cs%visc_rem_v, u_av, v_av)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_continuity)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keyword">call </span>do_group_pass(cs%pass_h, g%Domain)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="comment">! Whenever thickness changes let the diag manager know, target grids</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="comment">! for vertical remapping may need to be regenerated.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keyword">call </span>diag_update_target_grids(cs%diag)</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_waypoint(<span class="stringliteral">&quot;done with continuity (step_MOM_dyn_split_RK2)&quot;</span>)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keyword">call </span>start_group_pass(cs%pass_av_uvh, g%Domain)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keyword">call </span>do_group_pass(cs%pass_av_uvh, g%domain)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%OBC)) <span class="keywordflow">then</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keyword">call </span>radiation_open_bdry_conds(cs%OBC, u, u_old_rad_obc, v, &amp;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;             v_old_rad_obc, h, h_old_rad_obc, g, cs%open_boundary_CSp)</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">! h_av = (h_in + h_out)/2 . Going in to this line, h_av = h_in.</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,nz,h_av,h)</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js-2,je+2 ; <span class="keywordflow">do</span> i=is-2,ie+2</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    h_av(i,j,k) = 0.5*(h_av(i,j,k) + h(i,j,k))</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordflow">if</span> (g%nonblocking_updates) <span class="keywordflow">then</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_pass)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keyword">call </span>complete_group_pass(cs%pass_av_uvh, g%Domain)</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_pass)</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,uhtr,uh,dt,vhtr,vh)</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">do</span> j=js-2,je+2 ; <span class="keywordflow">do</span> i=isq-2,ieq+2</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      uhtr(i,j,k) = uhtr(i,j,k) + uh(i,j,k)*dt</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">do</span> j=jsq-2,jeq+2 ; <span class="keywordflow">do</span> i=is-2,ie+2</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      vhtr(i,j,k) = vhtr(i,j,k) + vh(i,j,k)*dt</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">!   The time-averaged free surface height has already been set by the last</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">!  call to btstep.</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">!  Here various terms used in to update the momentum equations are</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">!  offered for time averaging.</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordflow">if</span> (cs%id_PFu &gt; 0) <span class="keyword">call </span>post_data(cs%id_PFu, cs%PFu, cs%diag)</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordflow">if</span> (cs%id_PFv &gt; 0) <span class="keyword">call </span>post_data(cs%id_PFv, cs%PFv, cs%diag)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordflow">if</span> (cs%id_CAu &gt; 0) <span class="keyword">call </span>post_data(cs%id_CAu, cs%CAu, cs%diag)</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">if</span> (cs%id_CAv &gt; 0) <span class="keyword">call </span>post_data(cs%id_CAv, cs%CAv, cs%diag)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">! Here the thickness fluxes are offered for time averaging.</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">if</span> (cs%id_uh         &gt; 0) <span class="keyword">call </span>post_data(cs%id_uh , uh,                   cs%diag)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordflow">if</span> (cs%id_vh         &gt; 0) <span class="keyword">call </span>post_data(cs%id_vh , vh,                   cs%diag)</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">if</span> (cs%id_uav        &gt; 0) <span class="keyword">call </span>post_data(cs%id_uav, u_av,                 cs%diag)</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">if</span> (cs%id_vav        &gt; 0) <span class="keyword">call </span>post_data(cs%id_vav, v_av,                 cs%diag)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">if</span> (cs%id_u_BT_accel &gt; 0) <span class="keyword">call </span>post_data(cs%id_u_BT_accel, cs%u_accel_bt, cs%diag)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">if</span> (cs%id_v_BT_accel &gt; 0) <span class="keyword">call </span>post_data(cs%id_v_BT_accel, cs%v_accel_bt, cs%diag)</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordflow">if</span> (cs%id_umo        &gt; 0) <span class="keyword">call </span>post_data(cs%id_umo, uh*gv%H_to_kg_m2,      cs%diag)</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">if</span> (cs%id_vmo        &gt; 0) <span class="keyword">call </span>post_data(cs%id_vmo, vh*gv%H_to_kg_m2,      cs%diag)</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="comment">! depth summed zonal mass transport</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordflow">if</span> (cs%id_umo_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      uwork2d(i,j) = 0.0</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        uwork2d(i,j) = uwork2d(i,j) + uh(i,j,k)*gv%H_to_kg_m2</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keyword">call </span>post_data(cs%id_umo_2d, uwork2d, cs%diag)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="comment">! depth summed merid mass transport</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">if</span> (cs%id_vmo_2d &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      vwork2d(i,j) = 0.0</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        vwork2d(i,j) = vwork2d(i,j) + vh(i,j,k)*gv%H_to_kg_m2</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keyword">call </span>post_data(cs%id_vmo_2d, vwork2d, cs%diag)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">if</span> (cs%debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keyword">call </span>mom_state_chksum(<span class="stringliteral">&quot;Corrector &quot;</span>, u, v, h, uh, vh, g, gv)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keyword">call </span>uchksum(u_av,<span class="stringliteral">&quot;Corrector avg u&quot;</span>,g,haloshift=1)</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keyword">call </span>vchksum(v_av,<span class="stringliteral">&quot;Corrector avg v&quot;</span>,g,haloshift=1)</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keyword">call </span>hchksum(gv%H_to_kg_m2*h_av,<span class="stringliteral">&quot;Corrector avg h&quot;</span>,g,haloshift=1)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; <span class="comment">!  call MOM_state_chksum(&quot;Corrector avg &quot;, u_av, v_av, h_av, uh, vh, G, GV)</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">if</span> (showcalltree) <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;step_MOM_dyn_split_RK2()&quot;</span>)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d1/dc3/namespacemom__dynamics__split__rk2_a81cce65643a8cf94979d68354a9a1979_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1156e9ac0a7338e196c5eb018cb21262"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_btcalc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">193</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>

</div>
</div>
<a id="a82edb8c495c4b87e86a1536b5e64e0bd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_btforce</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">193</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>

</div>
</div>
<a id="a2ce197eb3f285e6c96fcbcf109fa52b4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_btstep</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00193">193</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keywordtype">integer</span> :: id_clock_btstep, id_clock_btcalc, id_clock_btforce</div></div><!-- fragment -->
</div>
</div>
<a id="a86ec3d9ffc9d19a3fd8c552970a9e551"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_continuity</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00192">192</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keywordtype">integer</span> :: id_clock_continuity, id_clock_thick_diff</div></div><!-- fragment -->
</div>
</div>
<a id="ad3884ecee0a084445790d44528ac6dac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_cor</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">190</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keywordtype">integer</span> :: id_clock_cor, id_clock_pres, id_clock_vertvisc</div></div><!-- fragment -->
</div>
</div>
<a id="a1a01bde62f65f6600cce148448abdfbe"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_horvisc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00191">191</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keywordtype">integer</span> :: id_clock_horvisc, id_clock_mom_update</div></div><!-- fragment -->
</div>
</div>
<a id="a7ff3a37691e3acc35039962cf6b2fdaa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_mom_update</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00191">191</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>

</div>
</div>
<a id="ae0a9bda16164c51889e836534aa290fa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_pass</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00194">194</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keywordtype">integer</span> :: id_clock_pass, id_clock_pass_init</div></div><!-- fragment -->
</div>
</div>
<a id="a39c9d62531c00323c3b2ed559902a460"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_pass_init</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00194">194</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>.</p>

</div>
</div>
<a id="a9d8b6d38a0e7724afacfa6913ae739ae"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_pres</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">190</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>

</div>
</div>
<a id="a15db1d2e90277d772fdb192e2137a668"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_thick_diff</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00192">192</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

</div>
</div>
<a id="acfd11d4aebbf6b14f39077090f56ef5b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_dynamics_split_rk2::id_clock_vertvisc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00190">190</a> of file <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html">MOM_dynamics_split_RK2.F90</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l01008">initialize_dyn_split_rk2()</a>, and <a class="el" href="../../dc/d1a/MOM__dynamics__split__RK2_8F90_source.html#l00203">step_mom_dyn_split_rk2()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d1/dc3/namespacemom__dynamics__split__rk2.html">mom_dynamics_split_rk2</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
